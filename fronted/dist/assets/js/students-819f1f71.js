var e=(e,a,l)=>new Promise((t,n)=>{var o=e=>{try{u(l.next(e))}catch(a){n(a)}},r=e=>{try{u(l.throw(e))}catch(a){n(a)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,r);u((l=l.apply(e,a)).next())});import{_ as a,u as l,n as t,o as n}from"./index-c00447c9.js";import{c as o,r,X as u,k as s,z as d,P as i,H as c,L as p,ay as m,ax as f,y as g,A as v,M as _,K as y,u as h,I as b,G as w}from"./vue-core-ad22061d.js";import{D as N,M as k,R as I,S as C,T as V,O as x}from"./icons-3f8828dd.js";import{E as z,u as U,H as S,b as j,F as A,w as R,x as F,G as O,J as P,K as q,_ as D,L as M,M as B,z as E,O as G}from"./element-plus-7067fc91.js";import"./utils-ebe9136b.js";const H={class:"course-students-container"},K={class:"card-header"},L={class:"header-left"},J={key:0,class:"course-info"},T={class:"operation-container"},X={key:0},$={key:1,class:"no-score"},Q={key:1,class:"no-grade"},W={class:"pagination-container"},Y={class:"dialog-footer"},Z=a({__name:"students",setup(a){const Z=m(),ee=f(),ae=o(()=>ee.params.courseId),le=o(()=>ee.params.id),te=l(),ne=r(null),oe=r(null),re=r(!1),ue=r([]),se=r(0),de=r(!1),ie=r(!1),ce=u({courseId:null,courseOfferingId:null,studentNo:"",studentName:"",pageNum:1,pageSize:10}),pe=u({visible:!1,title:"录入成绩"}),me=u({id:null,studentId:null,studentName:"",studentNo:"",score:null,comment:""}),fe={score:[{required:!0,message:"请输入成绩",trigger:"blur"}]},ge=r(null),ve=r(!1);function _e(){ne.value&&ae.value?(re.value=!0,t(ne.value,ae.value,ce).then(e=>{ue.value=e.data.list||[],se.value=e.data.total||0,e.data.courseInfo&&(oe.value=e.data.courseInfo)}).catch(e=>{console.error("获取课程学生列表失败:",e),z.error("获取课程学生列表失败")}).finally(()=>{re.value=!1})):z.warning("参数不完整，无法获取学生列表")}function ye(){ce.pageNum=1,_e()}function he(){ce.studentNo="",ce.studentName="",ye()}function be(e){ce.pageSize=e,_e()}function we(e){ce.pageNum=e,_e()}function Ne(){Z.go(-1)}function ke(){var e;null==(e=ge.value)||e.validate(e=>{if(!e)return;ve.value=!0;const a={studentId:me.studentId,score:me.score,comment:me.comment};n(ne.value,ae.value,a).then(()=>{z.success("成绩提交成功"),pe.visible=!1,_e()}).catch(e=>{console.error("成绩提交失败:",e),z.error("成绩提交失败")}).finally(()=>{ve.value=!1})})}function Ie(){z.info("导入成绩功能待实现")}function Ce(){z.info("导出学生名单功能待实现")}function Ve(){z.info("下载成绩模板功能待实现")}return s(()=>e(this,null,function*(){yield function(){return e(this,null,function*(){try{const e=te.userInfo;e&&e.teacherId?ne.value=e.teacherId:z.warning("获取教师信息失败，请重新登录")}catch(e){console.error("获取教师ID失败:",e),z.error("获取教师信息失败")}})}(),ce.courseId=ae.value,ce.courseOfferingId=le.value,_e()})),(e,a)=>{const l=j,t=A,n=R,o=F,r=O,u=P,s=q,m=D,f=M,z=B,ee=U,te=E,ne=S,_e=G;return g(),d("div",H,[i(ee,{class:"box-card"},{header:c(()=>[v("div",K,[v("div",L,[a[10]||(a[10]=v("span",{class:"header-title"},"课程学生名单",-1)),a[11]||(a[11]=p()),oe.value?(g(),d("span",J,_(oe.value.courseName)+" - "+_(oe.value.semester),1)):y("",!0)]),a[13]||(a[13]=p()),i(t,{onClick:Ne,link:""},{default:c(()=>[i(l,null,{default:c(()=>[i(h(N))]),_:1}),a[12]||(a[12]=p("返回\n          "))]),_:1})])]),default:c(()=>[a[35]||(a[35]=p()),i(r,{model:ce,ref:"queryForm",inline:!0,class:"search-form"},{default:c(()=>[i(o,{label:"学号",prop:"studentNo"},{default:c(()=>[i(n,{modelValue:ce.studentNo,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.studentNo=e),placeholder:"请输入学号",clearable:""},null,8,["modelValue"])]),_:1}),a[17]||(a[17]=p()),i(o,{label:"姓名",prop:"studentName"},{default:c(()=>[i(n,{modelValue:ce.studentName,"onUpdate:modelValue":a[1]||(a[1]=e=>ce.studentName=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1}),a[18]||(a[18]=p()),i(o,null,{default:c(()=>[i(t,{type:"primary",onClick:ye},{default:c(()=>[i(l,null,{default:c(()=>[i(h(k))]),_:1}),a[14]||(a[14]=p("查询\n          "))]),_:1}),a[16]||(a[16]=p()),i(t,{onClick:he},{default:c(()=>[i(l,null,{default:c(()=>[i(h(I))]),_:1}),a[15]||(a[15]=p("重置\n          "))]),_:1})]),_:1})]),_:1},8,["model"]),a[36]||(a[36]=p()),v("div",T,[i(t,{type:"primary",onClick:Ie,loading:de.value},{default:c(()=>[i(l,null,{default:c(()=>[i(h(C))]),_:1}),a[19]||(a[19]=p("导入成绩\n        "))]),_:1},8,["loading"]),a[22]||(a[22]=p()),i(t,{type:"primary",onClick:Ce,loading:ie.value},{default:c(()=>[i(l,null,{default:c(()=>[i(h(V))]),_:1}),a[20]||(a[20]=p("导出学生名单\n        "))]),_:1},8,["loading"]),a[23]||(a[23]=p()),i(t,{type:"primary",onClick:Ve},{default:c(()=>[i(l,null,{default:c(()=>[i(h(x))]),_:1}),a[21]||(a[21]=p("下载成绩模板\n        "))]),_:1})]),a[37]||(a[37]=p()),b((g(),w(f,{data:ue.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:c(()=>[i(u,{type:"index",label:"#",width:"60"}),a[27]||(a[27]=p()),i(u,{prop:"studentNo",label:"学号",width:"120"}),a[28]||(a[28]=p()),i(u,{prop:"studentName",label:"姓名",width:"120"}),a[29]||(a[29]=p()),i(u,{prop:"gender",label:"性别",width:"80",align:"center"},{default:c(e=>[p(_(0===e.row.gender?"男":"女"),1)]),_:1}),a[30]||(a[30]=p()),i(u,{prop:"className",label:"班级",width:"180"}),a[31]||(a[31]=p()),i(u,{prop:"score",label:"成绩",width:"100",align:"center"},{default:c(e=>[null!==e.row.score&&void 0!==e.row.score?(g(),d("span",X,_(e.row.score),1)):(g(),d("span",$,"未录入"))]),_:1}),a[32]||(a[32]=p()),i(u,{prop:"grade",label:"等级",width:"100",align:"center"},{default:c(e=>{return[e.row.grade?(g(),w(s,{key:0,type:(a=e.row.grade,{"A+":"success",A:"success","B+":"success",B:"warning","C+":"warning",C:"warning",D:"danger",F:"danger"}[a]||"info")},{default:c(()=>[p(_(e.row.grade),1)]),_:2},1032,["type"])):(g(),d("span",Q,"-"))];var a}),_:1}),a[33]||(a[33]=p()),i(u,{prop:"attendanceRate",label:"出勤率",width:"100",align:"center"},{default:c(e=>{return[i(m,{percentage:e.row.attendanceRate||0,color:(a=e.row.attendanceRate,null==a?"#909399":a>=90?"#67C23A":a>=80?"#E6A23C":"#F56C6C"),format:e=>`${e}%`},null,8,["percentage","color","format"])];var a}),_:1}),a[34]||(a[34]=p()),i(u,{label:"操作","min-width":"150",fixed:"right"},{default:c(e=>[i(t,{type:"primary",link:"",onClick:a=>{return l=e.row,pe.title="编辑成绩",pe.visible=!0,me.id=l.id,me.studentId=l.studentId,me.studentName=l.studentName,me.studentNo=l.studentNo,me.score=l.score,void(me.comment=l.comment||"");var l}},{default:c(()=>a[24]||(a[24]=[p("\n              编辑成绩\n            ")])),_:2},1032,["onClick"]),a[26]||(a[26]=p()),i(t,{type:"primary",link:"",onClick:a=>{return l=e.row,void Z.push({name:"AttendanceRecord",query:{courseId:ae.value,courseOfferingId:le.value,studentId:l.studentId}});var l}},{default:c(()=>a[25]||(a[25]=[p("\n              考勤记录\n            ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,re.value]]),a[38]||(a[38]=p()),v("div",W,[i(z,{"current-page":ce.pageNum,"onUpdate:currentPage":a[2]||(a[2]=e=>ce.pageNum=e),"page-size":ce.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>ce.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:se.value,onSizeChange:be,onCurrentChange:we},null,8,["current-page","page-size","total"])])]),_:1}),a[46]||(a[46]=p()),i(ne,{modelValue:pe.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>pe.visible=e),title:pe.title,width:"500px","append-to-body":""},{footer:c(()=>[v("div",Y,[i(t,{onClick:a[8]||(a[8]=e=>pe.visible=!1)},{default:c(()=>a[42]||(a[42]=[p("取消")])),_:1}),a[44]||(a[44]=p()),i(t,{type:"primary",onClick:ke,loading:ve.value},{default:c(()=>a[43]||(a[43]=[p("确定")])),_:1},8,["loading"])])]),default:c(()=>[i(r,{ref_key:"gradeFormRef",ref:ge,model:me,rules:fe,"label-width":"80px"},{default:c(()=>[i(o,{label:"学生",prop:"studentName"},{default:c(()=>[i(n,{modelValue:me.studentName,"onUpdate:modelValue":a[4]||(a[4]=e=>me.studentName=e),disabled:""},null,8,["modelValue"])]),_:1}),a[39]||(a[39]=p()),i(o,{label:"学号",prop:"studentNo"},{default:c(()=>[i(n,{modelValue:me.studentNo,"onUpdate:modelValue":a[5]||(a[5]=e=>me.studentNo=e),disabled:""},null,8,["modelValue"])]),_:1}),a[40]||(a[40]=p()),i(o,{label:"成绩",prop:"score"},{default:c(()=>[i(te,{modelValue:me.score,"onUpdate:modelValue":a[6]||(a[6]=e=>me.score=e),min:0,max:100,precision:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a[41]||(a[41]=p()),i(o,{label:"备注",prop:"comment"},{default:c(()=>[i(n,{modelValue:me.comment,"onUpdate:modelValue":a[7]||(a[7]=e=>me.comment=e),type:"textarea",rows:"3",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a[45]||(a[45]=p())]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-2c518a4c"]]);export{Z as default};
