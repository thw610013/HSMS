var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,r=(e,r)=>{for(var o in r||(r={}))a.call(r,o)&&s(e,o,r[o]);if(t)for(var o of t(r))l.call(r,o)&&s(e,o,r[o]);return e};import{_ as o,u as n,x as u,y as i,z as c}from"./index-c00447c9.js";import{_ as d}from"./index-f992b0ab.js";import{_ as m}from"./index-aa3c308e.js";import{r as p,k as v,z as h,P as f,H as g,L as _,n as w,y as b,A as x,I as y,Q as S,a5 as k,O as C,a4 as z,M as A,G as N,C as L,K as E}from"./vue-core-ad22061d.js";import{E as O}from"./utils-ebe9136b.js";import{u as T,H as j,E as F,w as I,x as P,A as V,B as G,F as B,G as U,y as H,C as M,J as R,K as D,_ as K,L as Q,O as W}from"./element-plus-7067fc91.js";import"./icons-3f8828dd.js";const q={class:"app-container"},J={class:"statistic-number"},X={class:"statistic-number"},Y={class:"statistic-number"},Z={class:"statistic-number"},$={key:0},ee={id:"printGradeReport"},te={class:"print-header"},ae={class:"student-info"},le={class:"print-table"},se={class:"summary-info"},re={class:"school-signature"},oe={class:"dialog-footer"},ne=o({__name:"index",setup(e){const t=n();p(t.userId);const a=p(t.userId),l=p(!1),s=p(!0),o=p(0),ne=p([]),ue=p([]),ie=p(!1),ce=p({studentId:"",studentName:"",majorName:"",className:""}),de=p({totalCourses:0,averageScore:0,totalCredits:0,gpa:0}),me=p([{value:"2024-2025-1",label:"2024-2025学年第一学期"},{value:"2024-2025-2",label:"2024-2025学年第二学期"},{value:"2023-2024-1",label:"2023-2024学年第一学期"},{value:"2023-2024-2",label:"2023-2024学年第二学期"}]),pe=p({pageNum:1,pageSize:10,courseName:void 0,semester:void 0,status:void 0});function ve(){l.value=!0,u(a.value,pe.value).then(e=>{if(console.log("成绩查询结果:",e),e&&e.data){let t=[];e.data.records?t=e.data.records||[]:e.data.rows?t=e.data.rows||[]:e.data.list?t=e.data.list||[]:Array.isArray(e.data)&&(t=e.data),void 0!==e.data.total?o.value=parseInt(e.data.total||0):o.value=t.length,ne.value=t.map(e=>{const t=r({},e);return t.course_name||(t.courseName?t.course_name=t.courseName:t.name&&(t.course_name=t.name)),t.course_code||(t.courseCode?t.course_code=t.courseCode:t.code&&(t.course_code=t.code)),!t.credits&&t.credit&&(t.credits=t.credit),t.teacher_name||(t.teacherName?t.teacher_name=t.teacherName:t.teacher&&(t.teacher_name=t.teacher)),!t.examTime&&t.exam_time&&(t.examTime=t.exam_time),t.ranking||0===t.ranking||null===t.ranking||t.rank&&(t.ranking=t.rank),!t.totalStudents&&t.total_students&&(t.totalStudents=t.total_students),t.status_text||(t.statusText?t.status_text=t.statusText:0===t.status?t.status_text="待评分":1===t.status?t.status_text="已评分":2===t.status?t.status_text="已取消":t.status_text="未知"),t}),ne.value.sort((e,t)=>{var a,l;return e.semester!==t.semester?(null==(a=t.semester)?void 0:a.localeCompare(e.semester||""))||0:(null==(l=e.course_name||"")?void 0:l.localeCompare(t.course_name||""))||0}),ne.value&&ne.value.length>0?(console.log("成绩列表数据:",ne.value),w(()=>{(function(){const e=document.getElementById("gradeChart");if(!e)return;const t=O(e),a=[],l=[],s=[];if(!ne.value||0===ne.value.length){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const r=[...ne.value].sort((e,t)=>e.semester&&t.semester?e.semester.localeCompare(t.semester):0),o={};if(r.forEach(e=>{if(e.semester&&(o[e.semester]||(o[e.semester]={scores:[],gps:[],credits:[]}),null!==e.score&&void 0!==e.score)){const t=parseFloat(e.score);o[e.semester].scores.push(t),o[e.semester].gps.push(parseFloat(he(t))),o[e.semester].credits.push(parseFloat(e.credits||0))}}),Object.keys(o).forEach(e=>{a.push(e);const t=o[e].scores,r=o[e].gps,n=o[e].credits;if(0===t.length)return l.push(0),void s.push(0);const u=t.reduce((e,t,a)=>e+t*n[a],0),i=n.reduce((e,t)=>e+t,0),c=i>0?(u/i).toFixed(2):0,d=r.reduce((e,t,a)=>e+t*n[a],0),m=i>0?(d/i).toFixed(2):0;l.push(c),s.push(m)}),0===a.length){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const n={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["平均分","GPA"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a},yAxis:[{type:"value",name:"分数",min:0,max:100,interval:10,axisLabel:{formatter:"{value}"}},{type:"value",name:"GPA",min:0,max:4,interval:.5,axisLabel:{formatter:"{value}"}}],series:[{name:"平均分",type:"bar",data:l,itemStyle:{color:"#3498db"}},{name:"GPA",type:"line",yAxisIndex:1,data:s,symbolSize:8,itemStyle:{color:"#e74c3c"}}]};t.setOption(n),window.addEventListener("resize",()=>{t.resize()})})(),function(){const e=document.getElementById("distributionChart");if(!e)return;const t=O(e);if(!ne.value||0===ne.value.length){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const a=[{name:"90-100分",range:[90,100],count:0,color:"#67C23A"},{name:"80-89分",range:[80,89],count:0,color:"#409EFF"},{name:"70-79分",range:[70,79],count:0,color:"#E6A23C"},{name:"60-69分",range:[60,69],count:0,color:"#F56C6C"},{name:"0-59分",range:[0,59],count:0,color:"#909399"}];let l=0;if(ne.value.forEach(e=>{if(null!==e.score&&void 0!==e.score){l++;const t=parseFloat(e.score);console.log("处理成绩分布: 课程=",e.course_name,"分数=",t);for(const e of a)if(t>=e.range[0]&&t<=e.range[1]){e.count++,console.log("  分配到区间:",e.name,"当前数量:",e.count);break}}}),console.log("成绩分布统计结果:",a),0===l){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const s={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center"},series:[{name:"成绩分布",type:"pie",radius:["50%","70%"],center:["40%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c}门"},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:a.map(e=>({value:e.count,name:e.name,itemStyle:{color:e.color}}))}]};t.setOption(s),window.addEventListener("resize",()=>{t.resize()})}()})):console.log("没有成绩数据")}else ne.value=[],o.value=0;l.value=!1}).catch(e=>{console.error("获取成绩数据失败:",e),ne.value=[],o.value=0,l.value=!1}),i(a.value).then(e=>{console.log("成绩统计数据:",e),de.value=e.data||{},de.value.totalCourses||(de.value.totalCourses=0),de.value.averageScore||(de.value.averageScore=0),de.value.totalCredits||(de.value.totalCredits=0),de.value.gpa||(de.value.gpa=0)}).catch(e=>{console.error("获取成绩统计数据失败:",e),de.value={totalCourses:0,averageScore:0,totalCredits:0,gpa:0}})}function he(e){return e>=90?"4.0":e>=85?"3.7":e>=80?"3.3":e>=75?"3.0":e>=70?"2.7":e>=65?"2.3":e>=60?"2.0":"0.0"}function fe(e){return e>=90?"A":e>=85?"A-":e>=80?"B+":e>=75?"B":e>=70?"B-":e>=65?"C+":e>=60?"C":"F"}function ge(e){return""}function _e(e,t){if(!e||!t||0===t)return"#409eff";const a=100-e/t*100;return a>=90?"#67c23a":a>=60?"#409eff":a>=30?"#e6a23c":"#f56c6c"}function we(){l.value=!0,u(a.value,{pageSize:9999}).then(e=>{if(e&&e.data){let t=[];e.data.records?t=e.data.records||[]:e.data.rows?t=e.data.rows||[]:e.data.list?t=e.data.list||[]:Array.isArray(e.data)&&(t=e.data),ue.value=t.map(e=>{const t=r({},e);return t.course_name||(t.courseName?t.course_name=t.courseName:t.name&&(t.course_name=t.name)),t.course_code||(t.courseCode?t.course_code=t.courseCode:t.code&&(t.course_code=t.code)),!t.credits&&t.credit&&(t.credits=t.credit),t.teacher_name||(t.teacherName?t.teacher_name=t.teacherName:t.teacher&&(t.teacher_name=t.teacher)),!t.examTime&&t.exam_time&&(t.examTime=t.exam_time),t.ranking||0===t.ranking||null===t.ranking||t.rank&&(t.ranking=t.rank),!t.totalStudents&&t.total_students&&(t.totalStudents=t.total_students),t.status_text||(t.statusText?t.status_text=t.statusText:0===t.status?t.status_text="待评分":1===t.status?t.status_text="已评分":2===t.status?t.status_text="已取消":t.status_text="未知"),t}),ie.value=!0}else F.warning("没有可打印的成绩数据");l.value=!1}).catch(e=>{console.error("获取打印成绩数据失败:",e),l.value=!1,F.error("获取成绩数据失败")})}function be(){const e=document.getElementById("printGradeReport").innerHTML,t=document.body.innerHTML;document.body.innerHTML=e,window.print(),document.body.innerHTML=t,ie.value=!1,setTimeout(()=>{location.reload()},100)}function xe(){pe.value.pageNum=1,ve()}function ye(){pe.value={pageNum:1,pageSize:10,courseName:void 0,semester:void 0,status:void 0},xe()}return v(()=>{ve(),c(a.value).then(e=>{ce.value=e.data})}),(e,t)=>{const a=I,r=P,n=V,u=G,i=B,c=U,p=H,v=m,w=M,O=T,F=R,Se=D,ke=K,Ce=Q,ze=d,Ae=j,Ne=W;return b(),h("div",q,[f(O,{class:"box-card"},{header:g(()=>t[8]||(t[8]=[x("div",{class:"card-header"},[x("span",null,"我的成绩")],-1)])),default:g(()=>[t[40]||(t[40]=_()),y(f(c,{model:pe.value,ref:"queryForm",inline:!0},{default:g(()=>[f(r,{label:"课程名称",prop:"courseName"},{default:g(()=>[f(a,{modelValue:pe.value.courseName,"onUpdate:modelValue":t[0]||(t[0]=e=>pe.value.courseName=e),placeholder:"请输入课程名称",clearable:"",onKeyup:k(xe,["enter"])},null,8,["modelValue"])]),_:1}),t[13]||(t[13]=_()),f(r,{label:"学期",prop:"semester"},{default:g(()=>[f(u,{modelValue:pe.value.semester,"onUpdate:modelValue":t[1]||(t[1]=e=>pe.value.semester=e),placeholder:"请选择学期",clearable:""},{default:g(()=>[(b(!0),h(C,null,z(me.value,e=>(b(),N(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t[14]||(t[14]=_()),f(r,{label:"成绩状态",prop:"status"},{default:g(()=>[f(u,{modelValue:pe.value.status,"onUpdate:modelValue":t[2]||(t[2]=e=>pe.value.status=e),placeholder:"请选择成绩状态",clearable:""},{default:g(()=>[f(n,{label:"已公布",value:1}),t[9]||(t[9]=_()),f(n,{label:"未公布",value:0})]),_:1},8,["modelValue"])]),_:1}),t[15]||(t[15]=_()),f(r,null,{default:g(()=>[f(i,{type:"primary",icon:"Search",onClick:xe},{default:g(()=>t[10]||(t[10]=[_("搜索")])),_:1}),t[12]||(t[12]=_()),f(i,{icon:"Refresh",onClick:ye},{default:g(()=>t[11]||(t[11]=[_("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[S,s.value]]),t[41]||(t[41]=_()),f(w,{gutter:10,class:"mb8"},{default:g(()=>[f(p,{span:1.5},{default:g(()=>[f(i,{type:"success",plain:"",icon:"Printer",onClick:we},{default:g(()=>t[16]||(t[16]=[_("打印成绩单")])),_:1})]),_:1}),t[17]||(t[17]=_()),f(v,{showSearch:s.value,"onUpdate:showSearch":t[3]||(t[3]=e=>s.value=e),onQueryTable:ve},null,8,["showSearch"])]),_:1}),t[42]||(t[42]=_()),f(w,{gutter:20,class:"mb20"},{default:g(()=>[f(p,{span:6},{default:g(()=>[f(O,{shadow:"hover",class:"statistic-card"},{default:g(()=>[t[18]||(t[18]=x("div",{class:"statistic-title"},"总课程数",-1)),t[19]||(t[19]=_()),x("div",J,A(de.value.totalCourses),1)]),_:1})]),_:1}),t[26]||(t[26]=_()),f(p,{span:6},{default:g(()=>[f(O,{shadow:"hover",class:"statistic-card"},{default:g(()=>[t[20]||(t[20]=x("div",{class:"statistic-title"},"平均分",-1)),t[21]||(t[21]=_()),x("div",X,A(de.value.averageScore),1)]),_:1})]),_:1}),t[27]||(t[27]=_()),f(p,{span:6},{default:g(()=>[f(O,{shadow:"hover",class:"statistic-card"},{default:g(()=>[t[22]||(t[22]=x("div",{class:"statistic-title"},"获得学分",-1)),t[23]||(t[23]=_()),x("div",Y,A(de.value.totalCredits),1)]),_:1})]),_:1}),t[28]||(t[28]=_()),f(p,{span:6},{default:g(()=>[f(O,{shadow:"hover",class:"statistic-card"},{default:g(()=>[t[24]||(t[24]=x("div",{class:"statistic-title"},"GPA",-1)),t[25]||(t[25]=_()),x("div",Z,A(de.value.gpa),1)]),_:1})]),_:1})]),_:1}),t[43]||(t[43]=_()),y((b(),N(Ce,{data:ne.value,style:{width:"100%"}},{default:g(()=>[f(F,{label:"学期",align:"center",prop:"semester",width:"140"}),t[31]||(t[31]=_()),f(F,{label:"课程名称",align:"center",prop:"course_name","min-width":"140","show-overflow-tooltip":!0}),t[32]||(t[32]=_()),f(F,{label:"课程编码",align:"center",prop:"course_code",width:"120"}),t[33]||(t[33]=_()),f(F,{label:"学分",align:"center",width:"80"},{default:g(e=>[_(A(e.row.credits||e.row.credit||"-"),1)]),_:1}),t[34]||(t[34]=_()),f(F,{label:"教师",align:"center",prop:"teacher_name",width:"100"}),t[35]||(t[35]=_()),f(F,{label:"总评成绩",align:"center",prop:"score",width:"100"},{default:g(e=>{return[null!==e.row.score&&void 0!==e.row.score?(b(),h("span",{key:0,class:L((t=e.row.score,null==t?"score-pending":t>=90?"score-excellent":t>=80?"score-good":t>=70?"score-normal":t>=60?"score-pass":"score-fail"))},A(e.row.score),3)):(b(),N(Se,{key:1,type:"info",size:"small"},{default:g(()=>[_(A(e.row.status_text||"待评分"),1)]),_:2},1024))];var t}),_:1}),t[36]||(t[36]=_()),f(F,{label:"绩点",align:"center",width:"80"},{default:g(e=>[null!==e.row.score&&void 0!==e.row.score?(b(),h(C,{key:0},[_(A(he(e.row.score)),1)],64)):(b(),h(C,{key:1},[_("\n              -\n            ")],64))]),_:1}),t[37]||(t[37]=_()),f(F,{label:"等级",align:"center",width:"100"},{default:g(e=>{return[null!==e.row.score&&void 0!==e.row.score?(b(),N(Se,{key:0,type:(a=e.row.score,null==a?"info":a>=90?"success":a>=80?"primary":a>=70?"":a>=60?"warning":"danger"),"disable-transitions":""},{default:g(()=>[_(A(fe(e.row.score)),1)]),_:2},1032,["type"])):(b(),N(Se,{key:1,type:"info","disable-transitions":""},{default:g(()=>t[29]||(t[29]=[_("未评分")])),_:1}))];var a}),_:1}),t[38]||(t[38]=_()),f(F,{label:"考试时间",align:"center",width:"160"},{default:g(e=>[e.row.examTime?(b(),h(C,{key:0},[_(A(e.row.examTime),1)],64)):(b(),h(C,{key:1},[_("\n              -\n            ")],64))]),_:1}),t[39]||(t[39]=_()),f(F,{label:"排名",align:"center",width:"120"},{default:g(e=>{return[null!==e.row.score&&void 0!==e.row.score&&e.row.ranking?(b(),h(C,{key:0},[_(A(e.row.ranking),1),e.row.totalStudents?(b(),h("span",$,"/"+A(e.row.totalStudents),1)):E("",!0),t[30]||(t[30]=_()),f(ke,{percentage:(a=e.row.ranking,l=e.row.totalStudents||100,a&&l&&0!==l?100-a/l*100:0),format:ge,color:_e(e.row.ranking,e.row.totalStudents||100),style:{width:"80px",display:"inline-block","margin-left":"10px"}},null,8,["percentage","color"])],64)):(b(),h(C,{key:1},[_("-")],64))];var a,l}),_:1})]),_:1},8,["data"])),[[Ne,l.value]]),t[44]||(t[44]=_()),y(f(ze,{total:o.value,page:pe.value.pageNum,"onUpdate:page":t[4]||(t[4]=e=>pe.value.pageNum=e),limit:pe.value.pageSize,"onUpdate:limit":t[5]||(t[5]=e=>pe.value.pageSize=e),onPagination:ve},null,8,["total","page","limit"]),[[S,o.value>0]])]),_:1}),t[86]||(t[86]=_()),f(O,{class:"box-card",style:{"margin-top":"20px"}},{header:g(()=>t[45]||(t[45]=[x("div",{class:"card-header"},[x("span",null,"成绩趋势分析")],-1)])),default:g(()=>[t[46]||(t[46]=_()),t[47]||(t[47]=x("div",{id:"gradeChart",style:{width:"100%",height:"400px"}},null,-1))]),_:1}),t[87]||(t[87]=_()),f(O,{class:"box-card",style:{"margin-top":"20px"}},{header:g(()=>t[48]||(t[48]=[x("div",{class:"card-header"},[x("span",null,"成绩分布统计")],-1)])),default:g(()=>[t[49]||(t[49]=_()),t[50]||(t[50]=x("div",{id:"distributionChart",style:{width:"100%",height:"400px"}},null,-1))]),_:1}),t[88]||(t[88]=_()),f(Ae,{title:"成绩单预览",modelValue:ie.value,"onUpdate:modelValue":t[7]||(t[7]=e=>ie.value=e),width:"800px"},{footer:g(()=>[x("div",oe,[f(i,{onClick:t[6]||(t[6]=e=>ie.value=!1)},{default:g(()=>t[82]||(t[82]=[_("取消")])),_:1}),t[84]||(t[84]=_()),f(i,{type:"primary",onClick:be},{default:g(()=>t[83]||(t[83]=[_("打印")])),_:1})])]),default:g(()=>[x("div",ee,[x("div",te,[t[58]||(t[58]=x("h2",null,"学生成绩单",-1)),t[59]||(t[59]=_()),x("div",ae,[x("p",null,[t[51]||(t[51]=x("span",null,"学号：",-1)),_(A(ce.value.studentId),1)]),t[55]||(t[55]=_()),x("p",null,[t[52]||(t[52]=x("span",null,"姓名：",-1)),_(A(ce.value.studentName),1)]),t[56]||(t[56]=_()),x("p",null,[t[53]||(t[53]=x("span",null,"专业：",-1)),_(A(ce.value.majorName),1)]),t[57]||(t[57]=_()),x("p",null,[t[54]||(t[54]=x("span",null,"班级：",-1)),_(A(ce.value.className),1)])])]),t[79]||(t[79]=_()),x("table",le,[t[66]||(t[66]=x("thead",null,[x("tr",null,[x("th",null,"学期"),_(),x("th",null,"课程名称"),_(),x("th",null,"课程编码"),_(),x("th",null,"学分"),_(),x("th",null,"成绩"),_(),x("th",null,"绩点"),_(),x("th",null,"等级")])],-1)),t[67]||(t[67]=_()),x("tbody",null,[(b(!0),h(C,null,z(ue.value,(e,a)=>(b(),h("tr",{key:a},[x("td",null,A(e.semester),1),t[60]||(t[60]=_()),x("td",null,A(e.course_name||e.courseName||e.name),1),t[61]||(t[61]=_()),x("td",null,A(e.course_code||e.courseCode||e.code),1),t[62]||(t[62]=_()),x("td",null,A(e.credits||e.credit),1),t[63]||(t[63]=_()),x("td",null,A(1===e.status?e.score:"未公布"),1),t[64]||(t[64]=_()),x("td",null,A(1===e.status?he(e.score):"-"),1),t[65]||(t[65]=_()),x("td",null,A(1===e.status?fe(e.score):"-"),1)]))),128))])]),t[80]||(t[80]=_()),x("div",se,[x("p",null,[t[68]||(t[68]=x("span",null,"总修学分：",-1)),_(A(de.value.totalCredits),1)]),t[73]||(t[73]=_()),x("p",null,[t[69]||(t[69]=x("span",null,"课程数：",-1)),_(A(de.value.totalCourses),1)]),t[74]||(t[74]=_()),x("p",null,[t[70]||(t[70]=x("span",null,"平均分：",-1)),_(A(de.value.averageScore),1)]),t[75]||(t[75]=_()),x("p",null,[t[71]||(t[71]=x("span",null,"GPA：",-1)),_(A(de.value.gpa),1)]),t[76]||(t[76]=_()),x("p",null,[t[72]||(t[72]=x("span",null,"打印时间：",-1)),_(A((new Date).toLocaleString()),1)])]),t[81]||(t[81]=_()),x("div",re,[t[77]||(t[77]=x("p",null,"学校（盖章）",-1)),t[78]||(t[78]=_()),x("p",null,A((new Date).toLocaleDateString()),1)])]),t[85]||(t[85]=_())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-ac9b35d7"]]);export{ne as default};
