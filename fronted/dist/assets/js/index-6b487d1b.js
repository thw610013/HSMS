var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,l,r)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[l]=r;import{_ as t,G as o,H as u,I as d,J as n,K as p,L as i,M as m}from"./index-c00447c9.js";import{M as c,R as b,B as f}from"./icons-3f8828dd.js";import{E as h,u as g,H as w,a as y,w as v,x as V,A as _,B as k,b as U,F as T,G as C,J as x,K as I,n as P,L as j,M as z,Q as N,p as q,O}from"./element-plus-7067fc91.js";import{r as S,X as B,k as F,z as M,P as $,H as D,L as E,y as G,u as H,A as K,I as L,G as R,M as A,K as J}from"./vue-core-ad22061d.js";import"./utils-ebe9136b.js";const Q={class:"user-container"},X={class:"card-header"},W={class:"header-buttons"},Y={style:{display:"flex","align-items":"center","justify-content":"center",gap:"8px"}},Z={class:"pagination-container"},ee={class:"dialog-footer"},ae={class:"dialog-footer"},le=t({__name:"index",setup(e){const t=S([]),le=S(0),re=S(!1),se=B({pageNum:1,pageSize:10,username:"",name:"",phone:"",status:null}),te=S(null),oe=B({visible:!1,title:"",type:""}),ue=B({userId:void 0,username:"",name:"",userType:0,email:"",phone:"",password:"",status:0}),de={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3到20个字符之间",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],userType:[{required:!0,message:"请选择用户类型",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],email:[{pattern:/^[\w.-]+@[\w.-]+\.\w+$/,message:"邮箱格式不正确",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}]},ne=S(null),pe=B({visible:!1,userId:void 0}),ie=B({userId:void 0,username:"",password:"",confirmPassword:""}),me={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==ie.password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]};F(()=>{ce()});const ce=()=>{re.value=!0,o(se).then(e=>{t.value=e.data.list||[],le.value=e.data.total||0}).catch(e=>{console.error("获取用户列表失败:",e),h.error("获取用户列表失败")}).finally(()=>{re.value=!1})},be=()=>{se.pageNum=1,ce()},fe=()=>{se.username="",se.name="",se.phone="",se.status=null,be()},he=e=>{se.pageNum=e,ce()},ge=e=>{se.pageSize=e,ce()},we=()=>{Ve(),oe.visible=!0,oe.title="新增用户",oe.type="add"},ye=()=>{ne.value.validate(e=>{if(!e)return;const a={userId:Number(ie.userId),password:ie.password};n(a).then(()=>{h.success("重置密码成功"),pe.visible=!1}).catch(e=>{console.error("重置密码失败:",e),h.error("重置密码失败")})})},ve=()=>{te.value.validate(e=>{if(!e)return;const t=((e,t)=>{for(var o in t||(t={}))l.call(t,o)&&s(e,o,t[o]);if(a)for(var o of a(t))r.call(t,o)&&s(e,o,t[o]);return e})({},ue);t.userType=Number(t.userType),t.status=Number(t.status),"update"===oe.type&&(t.id=t.userId,delete t.userId),"add"===oe.type?i(t).then(()=>{h.success("添加成功"),oe.visible=!1,ce()}).catch(e=>{console.error("添加用户失败:",e),h.error("添加用户失败")}):m(t).then(()=>{h.success("修改成功"),oe.visible=!1,ce()}).catch(e=>{console.error("修改用户失败:",e),h.error("修改用户失败")})})},Ve=()=>{ue.userId=void 0,ue.username="",ue.name="",ue.userType=0,ue.email="",ue.phone="",ue.password="",ue.status=0},_e=e=>{switch(e){case 0:return"管理员";case 1:return"教师";case 2:return"学生";default:return"未知"}},ke=e=>{switch(e){case 0:return"danger";case 1:return"warning";case 2:return"success";default:return"info"}};return(e,a)=>{const l=v,r=V,s=_,o=k,n=U,i=T,m=C,S=g,B=x,F=I,Ue=P,Te=j,Ce=z,xe=N,Ie=q,Pe=w,je=O;return G(),M("div",Q,[$(S,{class:"search-card",shadow:"hover"},{default:D(()=>[$(m,{model:se,ref:"queryForm",inline:!0},{default:D(()=>[$(r,{label:"用户名",prop:"username"},{default:D(()=>[$(l,{modelValue:se.username,"onUpdate:modelValue":a[0]||(a[0]=e=>se.username=e),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),a[27]||(a[27]=E()),$(r,{label:"姓名",prop:"name"},{default:D(()=>[$(l,{modelValue:se.name,"onUpdate:modelValue":a[1]||(a[1]=e=>se.name=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1}),a[28]||(a[28]=E()),$(r,{label:"手机号",prop:"phone"},{default:D(()=>[$(l,{modelValue:se.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>se.phone=e),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),a[29]||(a[29]=E()),$(r,{label:"状态",prop:"status"},{default:D(()=>[$(o,{modelValue:se.status,"onUpdate:modelValue":a[3]||(a[3]=e=>se.status=e),placeholder:"请选择状态",clearable:"",style:{width:"240px"}},{default:D(()=>[$(s,{label:"正常",value:0}),a[21]||(a[21]=E()),$(s,{label:"禁用",value:1})]),_:1},8,["modelValue"])]),_:1}),a[30]||(a[30]=E()),$(r,{label:"用户类型",prop:"userType"},{default:D(()=>[$(o,{modelValue:se.userType,"onUpdate:modelValue":a[4]||(a[4]=e=>se.userType=e),placeholder:"请选择用户类型",clearable:"",style:{width:"240px"}},{default:D(()=>[$(s,{label:"管理员",value:0}),a[22]||(a[22]=E()),$(s,{label:"教师",value:1}),a[23]||(a[23]=E()),$(s,{label:"学生",value:2})]),_:1},8,["modelValue"])]),_:1}),a[31]||(a[31]=E()),$(r,null,{default:D(()=>[$(i,{type:"primary",onClick:be},{default:D(()=>[$(n,null,{default:D(()=>[$(H(c))]),_:1}),a[24]||(a[24]=E("查询\n          "))]),_:1}),a[26]||(a[26]=E()),$(i,{onClick:fe},{default:D(()=>[$(n,null,{default:D(()=>[$(H(b))]),_:1}),a[25]||(a[25]=E("重置\n          "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a[72]||(a[72]=E()),$(S,{class:"table-card",shadow:"hover"},{header:D(()=>[K("div",X,[a[33]||(a[33]=K("span",{class:"header-title"},"用户列表",-1)),a[34]||(a[34]=E()),K("div",W,[$(i,{type:"primary",onClick:we},{default:D(()=>[$(n,null,{default:D(()=>[$(H(f))]),_:1}),a[32]||(a[32]=E("新增\n            "))]),_:1})])])]),default:D(()=>[a[49]||(a[49]=E()),L((G(),R(Te,{data:t.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:D(()=>[$(B,{prop:"id",label:"用户ID",width:"80"}),a[41]||(a[41]=E()),$(B,{prop:"username",label:"用户名",width:"120"}),a[42]||(a[42]=E()),$(B,{prop:"name",label:"姓名",width:"100"}),a[43]||(a[43]=E()),$(B,{prop:"userType",label:"用户类型",width:"100"},{default:D(e=>[$(F,{type:ke(e.row.userType)},{default:D(()=>[E(A(_e(e.row.userType)),1)]),_:2},1032,["type"])]),_:1}),a[44]||(a[44]=E()),$(B,{prop:"phone",label:"手机号码",width:"120"}),a[45]||(a[45]=E()),$(B,{prop:"email",label:"邮箱","min-width":"180"}),a[46]||(a[46]=E()),$(B,{prop:"statusDesc",label:"状态",width:"120",align:"center"},{default:D(e=>[K("div",Y,[K("span",null,A(e.row.statusDesc),1),a[35]||(a[35]=E()),$(Ue,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":0,"inactive-value":1,onChange:a=>(e=>{const a={userId:e.id,status:e.status};p(a).then(()=>{h.success(`已${0===e.status?"启用":"禁用"}用户`)}).catch(a=>{console.error("修改用户状态失败:",a),h.error("修改用户状态失败"),e.status=0===e.status?1:0})})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),a[47]||(a[47]=E()),$(B,{prop:"createTime",label:"创建时间",width:"160"}),a[48]||(a[48]=E()),$(B,{label:"操作",fixed:"right",width:"220"},{default:D(e=>[$(i,{type:"primary",link:"",onClick:a=>{return l=e.row,Ve(),oe.visible=!0,oe.title="编辑用户",oe.type="update",void u(l.id).then(e=>{const a=e.data;ue.userId=a.id,ue.username=a.username,ue.name=a.name,ue.userType=a.userType,ue.email=a.email,ue.phone=a.phone,ue.status=a.status}).catch(e=>{console.error("获取用户详情失败:",e),h.error("获取用户详情失败")});var l}},{default:D(()=>a[36]||(a[36]=[E("\n              编辑\n            ")])),_:2},1032,["onClick"]),a[39]||(a[39]=E()),$(i,{type:"primary",link:"",onClick:a=>{return l=e.row,ie.userId=l.id,ie.username=l.username,ie.password="",ie.confirmPassword="",void(pe.visible=!0);var l}},{default:D(()=>a[37]||(a[37]=[E("\n              重置密码\n            ")])),_:2},1032,["onClick"]),a[40]||(a[40]=E()),$(i,{type:"danger",link:"",onClick:a=>{return l=e.row,void y.confirm(`确定要删除用户 ${l.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d(l.id).then(()=>{h.success("删除成功"),ce()}).catch(e=>{console.error("删除用户失败:",e),h.error("删除用户失败")})}).catch(()=>{});var l}},{default:D(()=>a[38]||(a[38]=[E("\n              删除\n            ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[je,re.value]]),a[50]||(a[50]=E()),K("div",Z,[$(Ce,{"current-page":se.pageNum,"onUpdate:currentPage":a[5]||(a[5]=e=>se.pageNum=e),"page-size":se.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>se.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:le.value,onSizeChange:ge,onCurrentChange:he},null,8,["current-page","page-size","total"])])]),_:1}),a[73]||(a[73]=E()),$(Pe,{title:oe.title,modelValue:oe.visible,"onUpdate:modelValue":a[15]||(a[15]=e=>oe.visible=e),width:"600px","append-to-body":"","destroy-on-close":""},{footer:D(()=>[K("div",ee,[$(i,{onClick:a[14]||(a[14]=e=>oe.visible=!1)},{default:D(()=>a[62]||(a[62]=[E("取消")])),_:1}),a[64]||(a[64]=E()),$(i,{type:"primary",onClick:ve},{default:D(()=>a[63]||(a[63]=[E("确定")])),_:1})])]),default:D(()=>[$(m,{ref_key:"userFormRef",ref:te,model:ue,rules:de,"label-width":"80px"},{default:D(()=>[$(r,{label:"用户名",prop:"username"},{default:D(()=>[$(l,{modelValue:ue.username,"onUpdate:modelValue":a[7]||(a[7]=e=>ue.username=e),placeholder:"请输入用户名",disabled:"update"===oe.type},null,8,["modelValue","disabled"])]),_:1}),a[56]||(a[56]=E()),$(r,{label:"姓名",prop:"name"},{default:D(()=>[$(l,{modelValue:ue.name,"onUpdate:modelValue":a[8]||(a[8]=e=>ue.name=e),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),a[57]||(a[57]=E()),$(r,{label:"用户类型",prop:"userType"},{default:D(()=>[$(o,{modelValue:ue.userType,"onUpdate:modelValue":a[9]||(a[9]=e=>ue.userType=e),placeholder:"请选择用户类型",style:{width:"100%"}},{default:D(()=>[$(s,{label:"管理员",value:0}),a[51]||(a[51]=E()),$(s,{label:"教师",value:1}),a[52]||(a[52]=E()),$(s,{label:"学生",value:2})]),_:1},8,["modelValue"])]),_:1}),a[58]||(a[58]=E()),$(r,{label:"邮箱",prop:"email"},{default:D(()=>[$(l,{modelValue:ue.email,"onUpdate:modelValue":a[10]||(a[10]=e=>ue.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a[59]||(a[59]=E()),$(r,{label:"手机号",prop:"phone"},{default:D(()=>[$(l,{modelValue:ue.phone,"onUpdate:modelValue":a[11]||(a[11]=e=>ue.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a[60]||(a[60]=E()),"add"===oe.type?(G(),R(r,{key:0,label:"密码",prop:"password"},{default:D(()=>[$(l,{modelValue:ue.password,"onUpdate:modelValue":a[12]||(a[12]=e=>ue.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})):J("",!0),a[61]||(a[61]=E()),$(r,{label:"状态",prop:"status"},{default:D(()=>[$(Ie,{modelValue:ue.status,"onUpdate:modelValue":a[13]||(a[13]=e=>ue.status=e)},{default:D(()=>[$(xe,{label:0},{default:D(()=>a[53]||(a[53]=[E("正常")])),_:1}),a[55]||(a[55]=E()),$(xe,{label:1},{default:D(()=>a[54]||(a[54]=[E("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),a[65]||(a[65]=E())]),_:1},8,["title","modelValue"]),a[74]||(a[74]=E()),$(Pe,{title:"重置密码",modelValue:pe.visible,"onUpdate:modelValue":a[20]||(a[20]=e=>pe.visible=e),width:"500px","append-to-body":""},{footer:D(()=>[K("div",ae,[$(i,{onClick:a[19]||(a[19]=e=>pe.visible=!1)},{default:D(()=>a[68]||(a[68]=[E("取消")])),_:1}),a[70]||(a[70]=E()),$(i,{type:"primary",onClick:ye},{default:D(()=>a[69]||(a[69]=[E("确定")])),_:1})])]),default:D(()=>[$(m,{ref_key:"resetPwdFormRef",ref:ne,model:ie,rules:me,"label-width":"80px"},{default:D(()=>[$(r,{label:"用户名"},{default:D(()=>[$(l,{modelValue:ie.username,"onUpdate:modelValue":a[16]||(a[16]=e=>ie.username=e),disabled:""},null,8,["modelValue"])]),_:1}),a[66]||(a[66]=E()),$(r,{label:"新密码",prop:"password"},{default:D(()=>[$(l,{modelValue:ie.password,"onUpdate:modelValue":a[17]||(a[17]=e=>ie.password=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a[67]||(a[67]=E()),$(r,{label:"确认密码",prop:"confirmPassword"},{default:D(()=>[$(l,{modelValue:ie.confirmPassword,"onUpdate:modelValue":a[18]||(a[18]=e=>ie.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a[71]||(a[71]=E())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-a9921c38"]]);export{le as default};
