var e=(e,a,l)=>new Promise((t,s)=>{var r=e=>{try{n(l.next(e))}catch(a){s(a)}},o=e=>{try{n(l.throw(e))}catch(a){s(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);n((l=l.apply(e,a)).next())});import{s as a,_ as l}from"./index-c00447c9.js";import{M as t,R as s,T as r}from"./icons-3f8828dd.js";import{E as o}from"./utils-ebe9136b.js";import{l as n}from"./manage-ed44f4cc.js";import{E as d,u as c,C as u,a as i,B as v,x as p,b as m,F as f,G as h,y as b,J as g,L as x,O as y,A as _}from"./element-plus-7067fc91.js";import{r as S,X as w,k as R,S as C,z as F,P as I,H as A,L,y as k,O as E,a4 as V,u as j,A as U,M as W,I as B,G as O}from"./vue-core-ad22061d.js";const T={class:"app-container"},P={class:"card-body"},z={class:"statistic-value"},D={class:"card-body"},M={class:"statistic-value"},G={class:"card-body"},N={class:"statistic-value"},H={class:"card-body"},J={class:"statistic-value"},X={class:"report-actions"},$=l({__name:"stats",setup(l){const $=S([]),q=S([]),K=S([]);let Q=null,Y=null;const Z=w({semester:"",courseId:void 0,classId:void 0}),ee=S(!1),ae=S({}),le=S([]);R(()=>{te(),se(),re(),oe(),ne()}),C(()=>{Q&&(Q.dispose(),Q=null),Y&&(Y.dispose(),Y=null)});const te=()=>e(this,null,function*(){try{const e=yield n();if(200===e.code){const a={value:"all",label:"全部学期"};$.value=[a,...e.data],Z.semester="all"}}catch(e){console.error("获取学期选项失败",e),d.error("获取学期选项失败")}}),se=()=>e(this,null,function*(){try{const e=yield a({url:"/grade/course-options",method:"get"});200===e.code&&(q.value=e.data)}catch(e){console.error("获取课程选项失败",e),d.error("获取课程选项失败")}}),re=()=>e(this,null,function*(){try{const e=yield a({url:"/grade/class-options",method:"get"});200===e.code&&(K.value=e.data)}catch(e){console.error("获取班级选项失败",e),d.error("获取班级选项失败")}}),oe=()=>{Q=o(document.getElementById("scoreDistributionChart")),Y=o(document.getElementById("classAverageChart")),window.addEventListener("resize",()=>{Q&&Q.resize(),Y&&Y.resize()})},ne=()=>e(this,null,function*(){ee.value=!0;try{const l=yield(e=Z,a({url:"/grade/stats",method:"get",params:e}));if(200===l.code){ae.value=l.data.overview||{},ae.value.totalWithScore&&ae.value.totalWithScore>0?(ae.value.passRate=ae.value.passCount/ae.value.totalWithScore,ae.value.excellentRate=ae.value.excellentCount/ae.value.totalWithScore):(ae.value.passRate=0,ae.value.excellentRate=0);const e=l.data.classStats||[];le.value=e.map(e=>(e.totalStudents&&e.totalStudents>0?(e.passRate=e.passCount/e.totalStudents,e.excellentRate=e.excellentCount/e.totalStudents):(e.passRate=0,e.excellentRate=0),e)),de(l.data.scoreDistribution||[]),ce(l.data.classStats||[])}else d.error(l.msg||"获取统计数据失败")}catch(l){console.error("获取统计数据失败",l),d.error("获取统计数据失败")}finally{ee.value=!1}var e}),de=e=>{const a=[{range:"0-59",label:"<60",color:"#F56C6C"},{range:"60-69",label:"60-69",color:"#E6A23C"},{range:"70-79",label:"70-79",color:"#409EFF"},{range:"80-89",label:"80-89",color:"#67C23A"},{range:"90-100",label:"90-100",color:"#31C27C"}],l=a.map(a=>{const l=e.find(e=>e.scoreRange===a.range);return{value:l?l.count:0,itemStyle:{color:a.color}}}),t={title:{text:"成绩分布",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a.map(e=>e.label),axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"学生数"},series:[{name:"成绩分布",type:"bar",barWidth:"60%",data:l}]};Q.setOption(t)},ce=e=>{const a={title:{text:"班级平均分对比",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(e=>e.className),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"平均分",min:function(e){return Math.floor(Math.max(0,e.min-5))}},series:[{name:"平均分",type:"bar",barWidth:"60%",data:e.map(e=>e.averageScore),itemStyle:{color:"#409EFF"},label:{show:!0,position:"top",formatter:"{c}"}}]};Y.setOption(a)},ue=()=>{ne()},ie=()=>{Z.courseId=void 0,Z.classId=void 0,Z.semester="all",ne()},ve=()=>{i.confirm("是否确认导出成绩统计报告?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e;(e=Z,a({url:"/grade/export-report",method:"get",params:e,responseType:"blob"})).then(e=>{const a=new Blob([e.data],{type:"application/vnd.ms-excel"}),l=`成绩统计报告_${(new Date).getTime()}.xlsx`,t=document.createElement("a");t.href=URL.createObjectURL(a),t.download=l,t.click(),URL.revokeObjectURL(t.href),d.success("导出成功")}).catch(e=>{console.error("导出失败",e),d.error("导出失败")})})};return(e,a)=>{const l=_,o=v,n=p,d=m,i=f,S=h,w=c,R=b,C=u,Q=g,Y=x,te=y;return k(),F("div",T,[I(w,{class:"search-card"},{default:A(()=>[I(S,{model:Z,ref:"searchForm",inline:!0},{default:A(()=>[I(n,{label:"学期",prop:"semester"},{default:A(()=>[I(o,{modelValue:Z.semester,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.semester=e),placeholder:"选择学期",clearable:""},{default:A(()=>[(k(!0),F(E,null,V($.value,e=>(k(),O(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[6]||(a[6]=L()),I(n,{label:"课程",prop:"courseId"},{default:A(()=>[I(o,{modelValue:Z.courseId,"onUpdate:modelValue":a[1]||(a[1]=e=>Z.courseId=e),placeholder:"选择课程",clearable:"",filterable:""},{default:A(()=>[(k(!0),F(E,null,V(q.value,e=>(k(),O(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[7]||(a[7]=L()),I(n,{label:"班级",prop:"classId"},{default:A(()=>[I(o,{modelValue:Z.classId,"onUpdate:modelValue":a[2]||(a[2]=e=>Z.classId=e),placeholder:"选择班级",clearable:"",filterable:""},{default:A(()=>[(k(!0),F(E,null,V(K.value,e=>(k(),O(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[8]||(a[8]=L()),I(n,null,{default:A(()=>[I(i,{type:"primary",onClick:ue},{default:A(()=>[I(d,null,{default:A(()=>[I(j(t))]),_:1}),a[3]||(a[3]=L("查询\n          "))]),_:1}),a[5]||(a[5]=L()),I(i,{onClick:ie},{default:A(()=>[I(d,null,{default:A(()=>[I(j(s))]),_:1}),a[4]||(a[4]=L("重置\n          "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a[46]||(a[46]=L()),I(C,{gutter:20,class:"mt-2"},{default:A(()=>[I(R,{span:6},{default:A(()=>[I(w,null,{header:A(()=>a[9]||(a[9]=[U("div",{class:"card-header"},[U("span",null,"总人数")],-1)])),default:A(()=>[a[12]||(a[12]=L()),U("div",P,[U("div",z,W(ae.value.totalStudents||0),1),a[10]||(a[10]=L()),a[11]||(a[11]=U("div",{class:"statistic-label"},"参与课程学生总数",-1))])]),_:1})]),_:1}),a[25]||(a[25]=L()),I(R,{span:6},{default:A(()=>[I(w,null,{header:A(()=>a[13]||(a[13]=[U("div",{class:"card-header"},[U("span",null,"平均分")],-1)])),default:A(()=>[a[16]||(a[16]=L()),U("div",D,[U("div",M,W(ae.value.averageScore?ae.value.averageScore.toFixed(2):"0.00"),1),a[14]||(a[14]=L()),a[15]||(a[15]=U("div",{class:"statistic-label"},"课程平均成绩",-1))])]),_:1})]),_:1}),a[26]||(a[26]=L()),I(R,{span:6},{default:A(()=>[I(w,null,{header:A(()=>a[17]||(a[17]=[U("div",{class:"card-header"},[U("span",null,"及格率")],-1)])),default:A(()=>[a[20]||(a[20]=L()),U("div",G,[U("div",N,W(ae.value.passRate?(100*ae.value.passRate).toFixed(2)+"%":"0.00%"),1),a[18]||(a[18]=L()),a[19]||(a[19]=U("div",{class:"statistic-label"},"60分以上占比",-1))])]),_:1})]),_:1}),a[27]||(a[27]=L()),I(R,{span:6},{default:A(()=>[I(w,null,{header:A(()=>a[21]||(a[21]=[U("div",{class:"card-header"},[U("span",null,"优秀率")],-1)])),default:A(()=>[a[24]||(a[24]=L()),U("div",H,[U("div",J,W(ae.value.excellentRate?(100*ae.value.excellentRate).toFixed(2)+"%":"0.00%"),1),a[22]||(a[22]=L()),a[23]||(a[23]=U("div",{class:"statistic-label"},"90分以上占比",-1))])]),_:1})]),_:1})]),_:1}),a[47]||(a[47]=L()),I(C,{gutter:20,class:"mt-2"},{default:A(()=>[I(R,{span:12},{default:A(()=>[I(w,null,{header:A(()=>a[28]||(a[28]=[U("div",{class:"card-header"},[U("span",null,"成绩分布")],-1)])),default:A(()=>[a[29]||(a[29]=L()),a[30]||(a[30]=U("div",{class:"chart-container"},[U("div",{id:"scoreDistributionChart",style:{width:"100%",height:"400px"}})],-1))]),_:1})]),_:1}),a[34]||(a[34]=L()),I(R,{span:12},{default:A(()=>[I(w,null,{header:A(()=>a[31]||(a[31]=[U("div",{class:"card-header"},[U("span",null,"班级平均分对比")],-1)])),default:A(()=>[a[32]||(a[32]=L()),a[33]||(a[33]=U("div",{class:"chart-container"},[U("div",{id:"classAverageChart",style:{width:"100%",height:"400px"}})],-1))]),_:1})]),_:1})]),_:1}),a[48]||(a[48]=L()),I(C,{gutter:20,class:"mt-2"},{default:A(()=>[I(R,{span:24},{default:A(()=>[I(w,null,{header:A(()=>a[35]||(a[35]=[U("div",{class:"card-header"},[U("span",null,"班级成绩分析")],-1)])),default:A(()=>[a[42]||(a[42]=L()),B((k(),O(Y,{data:le.value,stripe:"",border:"",style:{width:"100%"}},{default:A(()=>[I(Q,{prop:"className",label:"班级",align:"center"}),a[36]||(a[36]=L()),I(Q,{prop:"totalStudents",label:"学生人数",align:"center"}),a[37]||(a[37]=L()),I(Q,{prop:"averageScore",label:"平均分",align:"center"},{default:A(e=>[L(W(null!==e.row.averageScore?e.row.averageScore.toFixed(2):"--"),1)]),_:1}),a[38]||(a[38]=L()),I(Q,{prop:"maxScore",label:"最高分",align:"center"},{default:A(e=>[L(W(null!==e.row.maxScore?e.row.maxScore.toFixed(1):"--"),1)]),_:1}),a[39]||(a[39]=L()),I(Q,{prop:"minScore",label:"最低分",align:"center"},{default:A(e=>[L(W(null!==e.row.minScore?e.row.minScore.toFixed(1):"--"),1)]),_:1}),a[40]||(a[40]=L()),I(Q,{label:"及格率",align:"center"},{default:A(e=>{return[L(W((a=e.row,null!==a.passRate?(100*a.passRate).toFixed(2)+"%":"--")),1)];var a}),_:1}),a[41]||(a[41]=L()),I(Q,{label:"优秀率",align:"center"},{default:A(e=>{return[L(W((a=e.row,null!==a.excellentRate?(100*a.excellentRate).toFixed(2)+"%":"--")),1)];var a}),_:1})]),_:1},8,["data"])),[[te,ee.value]])]),_:1})]),_:1})]),_:1}),a[49]||(a[49]=L()),I(C,{gutter:20,class:"mt-2"},{default:A(()=>[I(R,{span:24},{default:A(()=>[I(w,null,{header:A(()=>a[43]||(a[43]=[U("div",{class:"card-header"},[U("span",null,"生成报告")],-1)])),default:A(()=>[a[45]||(a[45]=L()),U("div",X,[I(i,{type:"primary",onClick:ve},{default:A(()=>[I(d,null,{default:A(()=>[I(j(r))]),_:1}),a[44]||(a[44]=L("导出成绩统计报告\n            "))]),_:1})])]),_:1})]),_:1})]),_:1})])}}},[["__scopeId","data-v-f5a7c9bc"]]);export{$ as default};
