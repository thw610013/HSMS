var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,r=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{s as u}from"./index-c00447c9.js";import{_ as n}from"./index-f992b0ab.js";import{_ as i}from"./index-aa3c308e.js";import{r as s,c as v,k as c,z as m,P as p,H as f,aq as h,y as b,A as g,L as y,I as _,Q as j,a5 as w,O as V,a4 as I,G as k}from"./vue-core-ad22061d.js";import{g as x,a as C}from"./major-11c16f9b.js";import{u as U,E as N,a as O,w as S,x as P,B as q,F as z,G as T,y as A,C as D,J as E,L as F,H as B,O as G,A as H}from"./element-plus-7067fc91.js";import"./icons-3f8828dd.js";import"./utils-ebe9136b.js";const K={class:"app-container"},L={class:"dialog-footer"},Q={__name:"index",setup(e){const Q=s(!1),$=s([]),J=v(()=>1!==$.value.length),R=v(()=>0===$.value.length),M=s(!0),W=s(0),X=s([]),Y=s(""),Z=s(!1),ee=s([]),ae=s(["2020","2021","2022","2023","2024","2025"]),le=s([]),oe=s(!1),te=s({pageNum:1,pageSize:10,name:void 0,code:void 0,majorId:void 0,grade:void 0}),de=s({id:void 0,name:void 0,code:void 0,majorId:void 0,grade:void 0,advisorId:void 0}),re={name:[{required:!0,message:"班级名称不能为空",trigger:"blur"}],code:[{required:!0,message:"班级编码不能为空",trigger:"blur"}],majorId:[{required:!0,message:"所属专业不能为空",trigger:"change"}],grade:[{required:!0,message:"年级不能为空",trigger:"change"}]},ue=s(null);function ne(){var e;Q.value=!0,(e=te.value,u({url:"/student/class/list",method:"get",params:e})).then(e=>{X.value=e.data.records,W.value=e.data.total,Q.value=!1}).catch(()=>{Q.value=!1})}function ie(e){""!==e?(oe.value=!0,function(e){return u({url:"/student/class/list/teachers",method:"get",params:e})}({name:e}).then(e=>{try{200===e.code&&e.data?(le.value=(e.data||[]).filter(e=>e&&"object"==typeof e&&(void 0!==e.value||void 0!==e.id)&&(void 0!==e.label||void 0!==e.name)).map(e=>({value:e.value||e.id,label:e.label||e.name})),console.log("搜索教师结果:",le.value)):le.value=[]}catch(a){console.error("处理教师搜索数据时出错:",a),le.value=[]}finally{oe.value=!1}}).catch(e=>{console.error("搜索教师失败:",e),le.value=[],oe.value=!1})):ye()}function se(){te.value.pageNum=1,ne()}function ve(){te.value={pageNum:1,pageSize:10,name:void 0,code:void 0,majorId:void 0,grade:void 0},se()}function ce(e){$.value=e.map(e=>e.id)}function me(){be(),Y.value="添加班级",Z.value=!0}function pe(e){be();(function(e){return u({url:`/student/class/${e}`,method:"get"})})(e.id||$.value[0]).then(e=>{try{if(200===e.code&&e.data){if(de.value=e.data,de.value.advisorId&&de.value.advisorName){le.value&&Array.isArray(le.value)||(le.value=[]);let e=!1;for(const a of le.value)if(a&&"object"==typeof a&&a.value===de.value.advisorId){e=!0;break}e||le.value.push({value:de.value.advisorId,label:de.value.advisorName})}Y.value="修改班级",Z.value=!0}else N.error(e.msg||"获取班级详情失败")}catch(a){console.error("处理班级详情数据时出错:",a),N.error("处理班级详情数据失败")}}).catch(e=>{console.error("获取班级详情失败:",e),N.error("获取班级详情失败，请稍后重试")})}function fe(){var e;null==(e=ue.value)||e.validate(e=>{if(e)try{const e=(i=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&r(e,l,a[l]);if(o)for(var l of o(a))d.call(a,l)&&r(e,l,a[l]);return e})({},de.value),s={id:de.value.id?Number(de.value.id):void 0,majorId:de.value.majorId?Number(de.value.majorId):void 0,advisorId:de.value.advisorId?Number(de.value.advisorId):null},a(i,l(s)));console.log("提交表单数据:",e),e.id?(n=e,u({url:"/student/class",method:"put",data:n})).then(e=>{200===e.code?(N.success("修改成功"),Z.value=!1,ne()):N.error(e.msg||"修改失败")}).catch(e=>{console.error("修改班级失败:",e),N.error("修改失败，请稍后重试")}):function(e){return u({url:"/student/class",method:"post",data:e})}(e).then(e=>{200===e.code?(N.success("新增成功"),Z.value=!1,ne()):N.error(e.msg||"新增失败")}).catch(e=>{console.error("新增班级失败:",e),N.error("新增失败，请稍后重试")})}catch(v){console.error("表单提交数据处理错误:",v),N.error("表单提交失败，请稍后重试")}var n,i,s})}function he(e){const a=e.id||$.value;O.confirm("确认删除选中的班级信息?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e;(e=a,u({url:`/student/class/${e}`,method:"delete"})).then(()=>{N.success("删除成功"),ne()})})}function be(){var e;de.value={id:void 0,name:void 0,code:void 0,majorId:void 0,grade:void 0,advisorId:void 0},null==(e=ue.value)||e.resetFields()}function ge(){Z.value=!1,be()}function ye(){oe.value=!0,le.value=[],u({url:"/student/class/all/teachers",method:"get"}).then(e=>{try{200===e.code&&e.data&&(le.value=e.data.filter(e=>e&&(e.value||e.id)).map(e=>({value:e.value||e.id,label:e.label||e.name})),console.log("预加载教师数据成功:",le.value))}catch(a){console.error("处理教师数据时出错:",a)}finally{oe.value=!1}}).catch(e=>{console.error("获取教师列表失败:",e),oe.value=!1})}return c(()=>{ne(),ee.value=[],x().then(e=>{try{200===e.code&&e.data&&e.data.length>0?(ee.value=e.data.filter(e=>e&&"object"==typeof e&&void 0!==e.value&&void 0!==e.label).map(e=>({value:e.value,label:e.label})),console.log("获取专业选项成功:",ee.value)):C().then(e=>{200===e.code&&e.data?(ee.value=e.data.filter(e=>e&&"object"==typeof e&&void 0!==e.id&&void 0!==e.name).map(e=>({value:e.id,label:e.name})),console.log("获取专业列表成功(已转换):",ee.value)):(console.error("获取专业列表失败:",e),ee.value=[])}).catch(e=>{console.error("获取专业列表异常:",e),ee.value=[]})}catch(a){console.error("处理专业数据时出错:",a),ee.value=[]}}).catch(e=>{console.error("获取专业选项异常，尝试备用方法:",e),C().then(e=>{try{200===e.code&&e.data?ee.value=e.data.filter(e=>e&&"object"==typeof e&&void 0!==e.id&&void 0!==e.name).map(e=>({value:e.id,label:e.name})):ee.value=[]}catch(a){console.error("处理专业数据时出错:",a),ee.value=[]}}).catch(()=>{ee.value=[]})}),ye(),console.log("年级选项数据:",ae.value),setTimeout(()=>{console.log("专业选项加载后:",ee.value),ee.value=[...ee.value]},1e3)}),(e,a)=>{const l=S,o=P,t=H,d=q,r=z,u=T,s=A,v=i,c=D,x=E,C=F,N=n,O=B,$=U,be=h("hasPermi"),ye=G;return b(),m("div",K,[p($,{class:"box-card"},{header:f(()=>a[13]||(a[13]=[g("div",{class:"card-header"},[g("span",null,"班级管理")],-1)])),default:f(()=>[a[46]||(a[46]=y()),_(p(u,{model:te.value,ref:"queryForm",inline:!0},{default:f(()=>[p(o,{label:"班级名称",prop:"name"},{default:f(()=>[p(l,{modelValue:te.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>te.value.name=e),placeholder:"请输入班级名称",clearable:"",style:{width:"240px"},onKeyup:w(se,["enter"])},null,8,["modelValue"])]),_:1}),a[17]||(a[17]=y()),p(o,{label:"班级编码",prop:"code"},{default:f(()=>[p(l,{modelValue:te.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>te.value.code=e),placeholder:"请输入班级编码",clearable:"",style:{width:"240px"},onKeyup:w(se,["enter"])},null,8,["modelValue"])]),_:1}),a[18]||(a[18]=y()),p(o,{label:"所属专业",prop:"majorId"},{default:f(()=>[p(d,{modelValue:te.value.majorId,"onUpdate:modelValue":a[2]||(a[2]=e=>te.value.majorId=e),placeholder:"请选择所属专业",clearable:"",style:{width:"240px"}},{default:f(()=>[(b(!0),m(V,null,I(ee.value,(e,a)=>(b(),k(t,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[19]||(a[19]=y()),p(o,{label:"年级",prop:"grade"},{default:f(()=>[p(d,{modelValue:te.value.grade,"onUpdate:modelValue":a[3]||(a[3]=e=>te.value.grade=e),placeholder:"请选择年级",clearable:"",style:{width:"240px"}},{default:f(()=>[(b(!0),m(V,null,I(ae.value,(e,a)=>(b(),k(t,{key:a,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[20]||(a[20]=y()),p(o,null,{default:f(()=>[p(r,{type:"primary",icon:"Search",onClick:se},{default:f(()=>a[14]||(a[14]=[y("搜索")])),_:1}),a[16]||(a[16]=y()),p(r,{icon:"Refresh",onClick:ve},{default:f(()=>a[15]||(a[15]=[y("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[j,M.value]]),a[47]||(a[47]=y()),p(c,{gutter:10,class:"mb8"},{default:f(()=>[p(s,{span:1.5},{default:f(()=>[_((b(),k(r,{type:"primary",plain:"",icon:"Plus",onClick:me},{default:f(()=>a[21]||(a[21]=[y("新增")])),_:1})),[[be,["education:class:add"]]])]),_:1}),a[24]||(a[24]=y()),p(s,{span:1.5},{default:f(()=>[_((b(),k(r,{type:"success",plain:"",icon:"Edit",disabled:J.value,onClick:pe},{default:f(()=>a[22]||(a[22]=[y("修改")])),_:1},8,["disabled"])),[[be,["education:class:edit"]]])]),_:1}),a[25]||(a[25]=y()),p(s,{span:1.5},{default:f(()=>[_((b(),k(r,{type:"danger",plain:"",icon:"Delete",disabled:R.value,onClick:he},{default:f(()=>a[23]||(a[23]=[y("删除")])),_:1},8,["disabled"])),[[be,["education:class:remove"]]])]),_:1}),a[26]||(a[26]=y()),p(v,{showSearch:M.value,"onUpdate:showSearch":a[4]||(a[4]=e=>M.value=e),onQueryTable:ne},null,8,["showSearch"])]),_:1}),a[48]||(a[48]=y()),_((b(),k(C,{data:X.value,onSelectionChange:ce},{default:f(()=>[p(x,{type:"selection",width:"55",align:"center"}),a[30]||(a[30]=y()),p(x,{label:"班级ID",align:"center",prop:"id",width:"80"}),a[31]||(a[31]=y()),p(x,{label:"班级名称",align:"center",prop:"name","show-overflow-tooltip":!0}),a[32]||(a[32]=y()),p(x,{label:"班级编码",align:"center",prop:"code","show-overflow-tooltip":!0}),a[33]||(a[33]=y()),p(x,{label:"所属专业",align:"center",prop:"majorName","show-overflow-tooltip":!0}),a[34]||(a[34]=y()),p(x,{label:"年级",align:"center",prop:"grade"}),a[35]||(a[35]=y()),p(x,{label:"班主任",align:"center",prop:"advisorName","show-overflow-tooltip":!0}),a[36]||(a[36]=y()),p(x,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),a[37]||(a[37]=y()),p(x,{label:"操作",align:"center",width:"180","class-name":"small-padding fixed-width"},{default:f(e=>[_((b(),k(r,{type:"primary",link:"",icon:"Edit",onClick:a=>pe(e.row)},{default:f(()=>a[27]||(a[27]=[y("修改")])),_:2},1032,["onClick"])),[[be,["education:class:edit"]]]),a[29]||(a[29]=y()),_((b(),k(r,{type:"primary",link:"",icon:"Delete",onClick:a=>he(e.row)},{default:f(()=>a[28]||(a[28]=[y("删除")])),_:2},1032,["onClick"])),[[be,["education:class:remove"]]])]),_:1})]),_:1},8,["data"])),[[ye,Q.value]]),a[49]||(a[49]=y()),_(p(N,{total:W.value,page:te.value.pageNum,"onUpdate:page":a[5]||(a[5]=e=>te.value.pageNum=e),limit:te.value.pageSize,"onUpdate:limit":a[6]||(a[6]=e=>te.value.pageSize=e),onPagination:ne},null,8,["total","page","limit"]),[[j,W.value>0]]),a[50]||(a[50]=y()),p(O,{title:Y.value,modelValue:Z.value,"onUpdate:modelValue":a[12]||(a[12]=e=>Z.value=e),width:"600px","append-to-body":""},{footer:f(()=>[g("div",L,[p(r,{type:"primary",onClick:fe},{default:f(()=>a[42]||(a[42]=[y("确 定")])),_:1}),a[44]||(a[44]=y()),p(r,{onClick:ge},{default:f(()=>a[43]||(a[43]=[y("取 消")])),_:1})])]),default:f(()=>[p(u,{ref_key:"classForm",ref:ue,model:de.value,rules:re,"label-width":"100px"},{default:f(()=>[p(o,{label:"班级名称",prop:"name"},{default:f(()=>[p(l,{modelValue:de.value.name,"onUpdate:modelValue":a[7]||(a[7]=e=>de.value.name=e),placeholder:"请输入班级名称"},null,8,["modelValue"])]),_:1}),a[38]||(a[38]=y()),p(o,{label:"班级编码",prop:"code"},{default:f(()=>[p(l,{modelValue:de.value.code,"onUpdate:modelValue":a[8]||(a[8]=e=>de.value.code=e),placeholder:"请输入班级编码"},null,8,["modelValue"])]),_:1}),a[39]||(a[39]=y()),p(o,{label:"所属专业",prop:"majorId"},{default:f(()=>[p(d,{modelValue:de.value.majorId,"onUpdate:modelValue":a[9]||(a[9]=e=>de.value.majorId=e),placeholder:"请选择所属专业",style:{width:"100%"}},{default:f(()=>[(b(!0),m(V,null,I(ee.value,(e,a)=>(b(),k(t,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[40]||(a[40]=y()),p(o,{label:"年级",prop:"grade"},{default:f(()=>[p(d,{modelValue:de.value.grade,"onUpdate:modelValue":a[10]||(a[10]=e=>de.value.grade=e),placeholder:"请选择年级",style:{width:"100%"}},{default:f(()=>[(b(!0),m(V,null,I(ae.value,(e,a)=>(b(),k(t,{key:a,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[41]||(a[41]=y()),p(o,{label:"班主任",prop:"advisorId"},{default:f(()=>[p(d,{modelValue:de.value.advisorId,"onUpdate:modelValue":a[11]||(a[11]=e=>de.value.advisorId=e),filterable:"",remote:"",placeholder:"请输入教师姓名搜索","remote-method":ie,loading:oe.value,style:{width:"100%"},clearable:""},{default:f(()=>[(b(!0),m(V,null,I(le.value,(e,a)=>(b(),k(t,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["model"]),a[45]||(a[45]=y())]),_:1},8,["title","modelValue"])]),_:1})])}}};export{Q as default};
