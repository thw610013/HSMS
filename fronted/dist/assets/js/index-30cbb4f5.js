var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,t=(l,a,r)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[a]=r,o=(e,o)=>{for(var s in o||(o={}))a.call(o,s)&&t(e,s,o[s]);if(l)for(var s of l(o))r.call(o,s)&&t(e,s,o[s]);return e};import{s,_ as d}from"./index-c00447c9.js";/* empty css                */import{M as u,R as n,B as i}from"./icons-3f8828dd.js";import{E as c,u as p,H as m,a as h,w as f,x as y,A as g,B as v,b,F as _,G as k,J as V,n as w,L as N,M as K,z as S,Q as C,p as x,a3 as z,O as j}from"./element-plus-7067fc91.js";import{r as U,X as I,k as O,z as P,P as q,H as B,L as T,y as $,u as E,A as F,I as H,G as M,M as R}from"./vue-core-ad22061d.js";import"./utils-ebe9136b.js";const A={class:"role-container"},G={class:"card-header"},L={class:"header-buttons"},D={class:"pagination-container"},J={class:"dialog-footer"},Q={class:"role-info"},X={class:"dialog-footer"},W=d({__name:"index",setup(e){const l=U([]),a=U(0),r=U(!1),t=I({pageNum:1,pageSize:10,roleName:"",roleKey:"",status:null}),d=U(null),W=I({visible:!1,title:"",type:""}),Y=I({roleId:void 0,roleName:"",roleKey:"",roleSort:0,status:0,remark:""}),Z={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleKey:[{required:!0,message:"请输入权限标识",trigger:"blur"}],roleSort:[{required:!0,message:"请输入显示顺序",trigger:"blur"}]},ee=U(null),le=U([]),ae=I({visible:!1,role:{},checkedKeys:[]});O(()=>{re()});const re=()=>{r.value=!0,function(e){const l=o({},e);return void 0!==e.pageNum&&(l.current=e.pageNum,delete l.pageNum),void 0!==e.pageSize&&(l.size=e.pageSize,delete l.pageSize),s({url:"/system/role/list",method:"get",params:l})}(t).then(e=>{console.log("角色列表响应:",e),l.value=e.data.records||[],a.value=e.data.total||0}).catch(e=>{console.error("获取角色列表失败:",e),c.error("获取角色列表失败")}).finally(()=>{r.value=!1})},te=()=>{t.pageNum=1,re()},oe=()=>{t.roleName="",t.roleKey="",t.status=null,te()},se=e=>{t.pageNum=e,re()},de=e=>{t.pageSize=e,re()},ue=()=>{me(),W.visible=!0,W.title="新增角色",W.type="add"},ne=e=>{var l;me(),W.visible=!0,W.title="编辑角色",W.type="update",(l=e.id,s({url:`/system/role/${l}`,method:"get"})).then(e=>{const l=e.data;Y.roleId=l.id,Y.roleName=l.roleName,Y.roleKey=l.roleKey,Y.roleSort=l.roleSort,Y.status=l.status,Y.remark=l.remark}).catch(e=>{console.error("获取角色详情失败:",e),c.error("获取角色详情失败")})},ie=e=>{h.confirm(`确定要删除角色 ${e.roleName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var l;(l=e.id,s({url:`/system/role/${l}`,method:"delete"})).then(()=>{c.success("删除成功"),re()}).catch(e=>{console.error("删除角色失败:",e),c.error("删除角色失败")})}).catch(()=>{})},ce=e=>{(function(e){return s({url:"/system/role/status",method:"put",data:{id:e.roleId,status:e.status}})})({roleId:e.id,status:e.status}).then(()=>{c.success(`已${0===e.status?"启用":"禁用"}角色`)}).catch(l=>{console.error("修改角色状态失败:",l),c.error("修改角色状态失败"),e.status=0===e.status?1:0})},pe=()=>{d.value.validate(e=>{if(!e)return;const l=o({},Y);var a;l.roleSort=Number(l.roleSort),l.status=Number(l.status),"update"===W.type&&(l.id=l.roleId,delete l.roleId),"add"===W.type?(a=l,s({url:"/system/role",method:"post",data:a})).then(()=>{c.success("添加成功"),W.visible=!1,re()}).catch(e=>{console.error("添加角色失败:",e),c.error("添加角色失败")}):function(e){return s({url:"/system/role",method:"put",data:e})}(l).then(()=>{c.success("修改成功"),W.visible=!1,re()}).catch(e=>{console.error("修改角色失败:",e),c.error("修改角色失败")})})},me=()=>{Y.roleId=void 0,Y.roleName="",Y.roleKey="",Y.roleSort=0,Y.status=0,Y.remark=""},he=e=>{ae.role=e,ae.visible=!0,ae.checkedKeys=[],s({url:"/system/role/permissions/all",method:"get"}).then(l=>{const a=l.data||[],r=[],t={};var o;a.forEach(e=>{const l=e.split(":"),a=l[0];if(t[a]||(t[a]={id:a,name:fe(a),children:[]},r.push(t[a])),l.length>2){const r=l[0]+":"+l[1];let o=t[a].children.find(e=>e.id===r);o||(o={id:r,name:ye(l[1]),children:[]},t[a].children.push(o)),o.children.push({id:e,name:ge(l[2])})}else t[a].children.push({id:e,name:ge(l[1])})}),le.value=r,(o=e.id,s({url:`/system/role/permissions/${o}`,method:"get"})).then(e=>{const l=e.data||[];console.log("角色权限列表:",l),ae.checkedKeys=l,setTimeout(()=>{ee.value&&ee.value.setCheckedKeys(l)},100)}).catch(e=>{console.error("获取角色权限失败:",e),c.error("获取角色权限失败")})}).catch(e=>{console.error("获取权限选项失败:",e),c.error("获取权限选项失败")})},fe=e=>({system:"系统管理",education:"教育管理",course:"课程管理",attendance:"考勤管理",grade:"成绩管理",monitor:"系统监控",tool:"系统工具",job:"定时任务",common:"通用功能",log:"日志管理"}[e]||e),ye=e=>({user:"用户管理",role:"角色管理",menu:"菜单管理",permission:"权限管理",dept:"部门管理",department:"院系管理",major:"专业管理",class:"班级管理",student:"学生管理",teacher:"教师管理",course:"课程管理",offering:"课程开设",selection:"选课管理",score:"成绩管理",record:"考勤记录",stats:"统计分析",setting:"系统设置",dict:"字典管理",config:"参数配置",notice:"通知公告",log:"日志管理",online:"在线用户",job:"定时任务",druid:"数据监控",server:"服务监控"}[e]||e),ge=e=>({list:"列表",query:"查询",add:"新增",create:"创建",edit:"编辑",update:"更新",delete:"删除",remove:"删除",export:"导出",import:"导入",upload:"上传",download:"下载",resetPwd:"重置密码",operate:"操作",stats:"统计",view:"查看",detail:"详情",start:"启动",stop:"停止",run:"执行",all:"所有"}[e]||e),ve=()=>{if(!ee.value)return void c.error("权限树未初始化");if(!ae.role||!ae.role.id)return void c.error("角色信息不完整");const e=ee.value.getCheckedKeys(),l=ee.value.getHalfCheckedKeys(),a=[...new Set([...e,...l])].filter(e=>"string"==typeof e&&e.includes(":"));console.log("提交的权限:",a);const t={roleId:ae.role.id,menuIds:a};r.value=!0,function(e){return s({url:"/system/role/permissions",method:"put",data:e})}(t).then(e=>{200===e.code?(c({type:"success",message:"权限分配成功",duration:1500}),ae.visible=!1):c.error(e.message||"权限分配失败")}).catch(e=>{console.error("权限分配失败:",e),c.error("权限分配失败: "+(e.message||"未知错误"))}).finally(()=>{r.value=!1})};return(e,o)=>{const s=f,c=y,h=g,U=v,I=b,O=_,re=k,me=p,fe=V,ye=w,ge=N,be=K,_e=S,ke=C,Ve=x,we=m,Ne=z,Ke=j;return $(),P("div",A,[q(me,{class:"search-card",shadow:"hover"},{default:B(()=>[q(re,{model:t,ref:"queryForm",inline:!0},{default:B(()=>[q(c,{label:"角色名称",prop:"roleName"},{default:B(()=>[q(s,{modelValue:t.roleName,"onUpdate:modelValue":o[0]||(o[0]=e=>t.roleName=e),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1}),o[18]||(o[18]=T()),q(c,{label:"权限标识",prop:"roleKey"},{default:B(()=>[q(s,{modelValue:t.roleKey,"onUpdate:modelValue":o[1]||(o[1]=e=>t.roleKey=e),placeholder:"请输入权限标识",clearable:""},null,8,["modelValue"])]),_:1}),o[19]||(o[19]=T()),q(c,{label:"状态",prop:"status"},{default:B(()=>[q(U,{modelValue:t.status,"onUpdate:modelValue":o[2]||(o[2]=e=>t.status=e),placeholder:"请选择状态",clearable:""},{default:B(()=>[q(h,{label:"正常",value:0}),o[14]||(o[14]=T()),q(h,{label:"禁用",value:1})]),_:1},8,["modelValue"])]),_:1}),o[20]||(o[20]=T()),q(c,null,{default:B(()=>[q(O,{type:"primary",onClick:te},{default:B(()=>[q(I,null,{default:B(()=>[q(E(u))]),_:1}),o[15]||(o[15]=T("查询\n          "))]),_:1}),o[17]||(o[17]=T()),q(O,{onClick:oe},{default:B(()=>[q(I,null,{default:B(()=>[q(E(n))]),_:1}),o[16]||(o[16]=T("重置\n          "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o[55]||(o[55]=T()),q(me,{class:"table-card",shadow:"hover"},{header:B(()=>[F("div",G,[o[22]||(o[22]=F("span",{class:"header-title"},"角色列表",-1)),o[23]||(o[23]=T()),F("div",L,[q(O,{type:"primary",onClick:ue},{default:B(()=>[q(I,null,{default:B(()=>[q(E(i))]),_:1}),o[21]||(o[21]=T("新增\n            "))]),_:1})])])]),default:B(()=>[o[36]||(o[36]=T()),H(($(),M(ge,{data:l.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:B(()=>[q(fe,{prop:"id",label:"角色ID",width:"80"}),o[29]||(o[29]=T()),q(fe,{prop:"roleName",label:"角色名称",width:"150"}),o[30]||(o[30]=T()),q(fe,{prop:"roleKey",label:"权限标识",width:"150"}),o[31]||(o[31]=T()),q(fe,{prop:"roleSort",label:"显示顺序",width:"100",align:"center"}),o[32]||(o[32]=T()),q(fe,{prop:"status",label:"状态",width:"80",align:"center"},{default:B(e=>[q(ye,{modelValue:e.row.status,"onUpdate:modelValue":l=>e.row.status=l,"active-value":0,"inactive-value":1,onChange:l=>ce(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o[33]||(o[33]=T()),q(fe,{prop:"remark",label:"备注","min-width":"180"}),o[34]||(o[34]=T()),q(fe,{prop:"createTime",label:"创建时间",width:"160"}),o[35]||(o[35]=T()),q(fe,{label:"操作",fixed:"right",width:"220"},{default:B(e=>[q(O,{type:"primary",link:"",onClick:l=>ne(e.row)},{default:B(()=>o[24]||(o[24]=[T("\n              编辑\n            ")])),_:2},1032,["onClick"]),o[27]||(o[27]=T()),q(O,{type:"primary",link:"",onClick:l=>he(e.row)},{default:B(()=>o[25]||(o[25]=[T("\n              权限\n            ")])),_:2},1032,["onClick"]),o[28]||(o[28]=T()),q(O,{type:"danger",link:"",onClick:l=>ie(e.row)},{default:B(()=>o[26]||(o[26]=[T("\n              删除\n            ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ke,r.value]]),o[37]||(o[37]=T()),F("div",D,[q(be,{"current-page":t.pageNum,"onUpdate:currentPage":o[3]||(o[3]=e=>t.pageNum=e),"page-size":t.pageSize,"onUpdate:pageSize":o[4]||(o[4]=e=>t.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:a.value,onSizeChange:de,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),_:1}),o[56]||(o[56]=T()),q(we,{title:W.title,modelValue:W.visible,"onUpdate:modelValue":o[11]||(o[11]=e=>W.visible=e),width:"600px","append-to-body":"","destroy-on-close":""},{footer:B(()=>[F("div",J,[q(O,{onClick:o[10]||(o[10]=e=>W.visible=!1)},{default:B(()=>o[45]||(o[45]=[T("取消")])),_:1}),o[47]||(o[47]=T()),q(O,{type:"primary",onClick:pe},{default:B(()=>o[46]||(o[46]=[T("确定")])),_:1})])]),default:B(()=>[q(re,{ref_key:"roleFormRef",ref:d,model:Y,rules:Z,"label-width":"100px"},{default:B(()=>[q(c,{label:"角色名称",prop:"roleName"},{default:B(()=>[q(s,{modelValue:Y.roleName,"onUpdate:modelValue":o[5]||(o[5]=e=>Y.roleName=e),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),o[41]||(o[41]=T()),q(c,{label:"权限标识",prop:"roleKey"},{default:B(()=>[q(s,{modelValue:Y.roleKey,"onUpdate:modelValue":o[6]||(o[6]=e=>Y.roleKey=e),placeholder:"请输入权限标识"},null,8,["modelValue"])]),_:1}),o[42]||(o[42]=T()),q(c,{label:"显示顺序",prop:"roleSort"},{default:B(()=>[q(_e,{modelValue:Y.roleSort,"onUpdate:modelValue":o[7]||(o[7]=e=>Y.roleSort=e),min:0,"controls-position":"right"},null,8,["modelValue"])]),_:1}),o[43]||(o[43]=T()),q(c,{label:"状态",prop:"status"},{default:B(()=>[q(Ve,{modelValue:Y.status,"onUpdate:modelValue":o[8]||(o[8]=e=>Y.status=e)},{default:B(()=>[q(ke,{label:0},{default:B(()=>o[38]||(o[38]=[T("正常")])),_:1}),o[40]||(o[40]=T()),q(ke,{label:1},{default:B(()=>o[39]||(o[39]=[T("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o[44]||(o[44]=T()),q(c,{label:"备注",prop:"remark"},{default:B(()=>[q(s,{modelValue:Y.remark,"onUpdate:modelValue":o[9]||(o[9]=e=>Y.remark=e),type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),o[48]||(o[48]=T())]),_:1},8,["title","modelValue"]),o[57]||(o[57]=T()),q(we,{title:"分配权限",modelValue:ae.visible,"onUpdate:modelValue":o[13]||(o[13]=e=>ae.visible=e),width:"700px","append-to-body":"","destroy-on-close":""},{footer:B(()=>[F("div",X,[q(O,{onClick:o[12]||(o[12]=e=>ae.visible=!1)},{default:B(()=>o[50]||(o[50]=[T("取消")])),_:1}),o[52]||(o[52]=T()),q(O,{type:"primary",onClick:ve},{default:B(()=>o[51]||(o[51]=[T("确定")])),_:1})])]),default:B(()=>[F("div",Q,[F("span",null,"角色名称："+R(ae.role.roleName),1),o[49]||(o[49]=T()),F("span",null,"权限标识："+R(ae.role.roleKey),1)]),o[53]||(o[53]=T()),q(re,null,{default:B(()=>[q(c,{label:"权限列表"},{default:B(()=>[q(Ne,{ref_key:"permTreeRef",ref:ee,data:le.value,props:{label:"name",children:"children"},"show-checkbox":"","node-key":"id","default-checked-keys":ae.checkedKeys,"check-strictly":!1,"default-expand-all":"","highlight-current":""},null,8,["data","default-checked-keys"])]),_:1})]),_:1}),o[54]||(o[54]=T())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-3a15f238"]]);export{W as default};
