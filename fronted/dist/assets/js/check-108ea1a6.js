var e=(e,a,l)=>new Promise((t,s)=>{var u=e=>{try{r(l.next(e))}catch(a){s(a)}},o=e=>{try{r(l.throw(e))}catch(a){s(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(u,o);r((l=l.apply(e,a)).next())});import{s as a,u as l,_ as t}from"./index-c00447c9.js";import{M as s,R as u,T as o}from"./icons-3f8828dd.js";import{l as r}from"./manage-ed44f4cc.js";import{E as n,u as d,C as c,H as i,a as m,B as p,x as f,w as v,b,F as _,G as g,y as h,J as y,K as N,L as w,M as V,V as x,W as k,O as C,A as z}from"./element-plus-7067fc91.js";import{r as U,X as j,k as T,z as L,P,H as R,L as B,y as D,A as F,O,a4 as S,u as A,G as M,K as E,I as G,M as H,C as I}from"./vue-core-ad22061d.js";import"./utils-ebe9136b.js";function K(e){if(""!==e&&null!=e)return e}function $(e){if(!e||0===e.length)return!0;const a=l().roles;return!(!a||0===a.length)&&a.some(a=>e.includes(a))}const J={class:"app-container"},W={class:"search-form-container"},X={class:"form-row"},q={class:"dialog-footer"},Q=t({__name:"check",setup(l){const t=[{value:0,label:"已选"},{value:1,label:"已退"},{value:2,label:"已修完"}],Q=U([]),Y=j({pageNum:1,pageSize:10,studentNo:"",studentName:"",courseName:"",semester:"",status:void 0}),Z=U([]),ee=U(!1),ae=U(0),le=U(!1),te=U({});T(()=>{se(),ue()});const se=()=>e(this,null,function*(){try{const e=yield r();200===e.code&&(Q.value=e.data.map(e=>({value:e.value,label:e.label})))}catch(e){console.error("获取学期选项失败",e),n.error("获取学期选项失败")}}),ue=()=>e(this,null,function*(){ee.value=!0;try{const l=yield(e=Y,a({url:"/selection/manage/list",method:"get",params:e}));200===l.code?(Z.value=l.data.list||[],ae.value=l.data.total):(n.error(l.msg||"获取数据失败"),Z.value=[],ae.value=0)}catch(l){console.error("获取列表数据失败",l),n.error("获取列表数据失败"),Z.value=[],ae.value=0}finally{ee.value=!1}var e}),oe=e=>0===e?"info":1===e?"danger":2===e?"success":"",re=e=>null===e?"":e<60?"text-danger":e>=90?"text-success":"",ne=()=>{Y.pageNum=1,ue()},de=()=>{Y.studentNo="",Y.studentName="",Y.courseName="",Y.semester="",Y.status=void 0,ne()},ce=e=>{Y.pageSize=e,ue()},ie=e=>{Y.pageNum=e,ue()},me=l=>e(this,null,function*(){try{const t=yield(e=l.id,a({url:`/selection/manage/${K(e)}`,method:"get"}));200===t.code?(te.value=t.data,le.value=!0):n.error(t.msg||"获取详情失败")}catch(t){console.error("获取详情失败",t),n.error("获取详情失败")}var e}),pe=()=>{m.confirm("是否确认导出所有成绩数据?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e;(e=Y,a({url:"/selection/manage/export",method:"get",params:e,responseType:"blob"})).then(e=>{const a=new Blob([e.data],{type:"application/vnd.ms-excel"}),l=`成绩数据_${(new Date).getTime()}.xlsx`,t=document.createElement("a");t.href=URL.createObjectURL(a),t.download=l,t.click(),URL.revokeObjectURL(t.href),n.success("导出成功")}).catch(e=>{console.error("导出失败",e),n.error("导出失败")})})};return(e,a)=>{const l=z,r=p,n=f,m=v,U=b,j=_,T=g,K=d,se=h,ue=c,fe=y,ve=N,be=w,_e=V,ge=x,he=k,ye=i,Ne=C;return D(),L("div",J,[P(K,{class:"search-card"},{default:R(()=>[F("div",W,[P(T,{model:Y,ref:"searchForm",inline:!0,class:"search-form"},{default:R(()=>[F("div",X,[P(n,{label:"学期"},{default:R(()=>[P(r,{modelValue:Y.semester,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.semester=e),placeholder:"选择学期",clearable:""},{default:R(()=>[(D(!0),L(O,null,S(Q.value,e=>(D(),M(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[10]||(a[10]=B()),P(n,{label:"学号"},{default:R(()=>[P(m,{modelValue:Y.studentNo,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.studentNo=e),placeholder:"请输入学号",clearable:""},null,8,["modelValue"])]),_:1}),a[11]||(a[11]=B()),P(n,{label:"学生姓名"},{default:R(()=>[P(m,{modelValue:Y.studentName,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.studentName=e),placeholder:"请输入学生姓名",clearable:""},null,8,["modelValue"])]),_:1}),a[12]||(a[12]=B()),P(n,{label:"课程名称"},{default:R(()=>[P(m,{modelValue:Y.courseName,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.courseName=e),placeholder:"请输入课程名称",clearable:""},null,8,["modelValue"])]),_:1}),a[13]||(a[13]=B()),P(n,{label:"状态"},{default:R(()=>[P(r,{modelValue:Y.status,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.status=e),placeholder:"请选择状态",clearable:""},{default:R(()=>[(D(),L(O,null,S(t,e=>P(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a[14]||(a[14]=B()),P(n,null,{default:R(()=>[P(j,{type:"primary",onClick:ne},{default:R(()=>[P(U,null,{default:R(()=>[P(A(s))]),_:1}),a[7]||(a[7]=B("查询\n              "))]),_:1}),a[9]||(a[9]=B()),P(j,{onClick:de},{default:R(()=>[P(U,null,{default:R(()=>[P(A(u))]),_:1}),a[8]||(a[8]=B("重置\n              "))]),_:1})]),_:1})])]),_:1},8,["model"])])]),_:1}),a[40]||(a[40]=B()),P(ue,{gutter:10,class:"mb-2 mt-2"},{default:R(()=>[P(se,{span:1.5},{default:R(()=>[A($)(["admin","teacher"])?(D(),M(j,{key:0,type:"primary",onClick:pe},{default:R(()=>[P(U,null,{default:R(()=>[P(A(o))]),_:1}),a[15]||(a[15]=B("导出\n        "))]),_:1})):E("",!0)]),_:1})]),_:1}),a[41]||(a[41]=B()),P(K,null,{default:R(()=>[G((D(),M(be,{data:Z.value,stripe:"",border:"",style:{width:"100%"},"highlight-current-row":""},{default:R(()=>[P(fe,{type:"index",width:"55",align:"center",label:"序号"}),a[17]||(a[17]=B()),P(fe,{prop:"studentNo",label:"学号",align:"center"}),a[18]||(a[18]=B()),P(fe,{prop:"studentName",label:"学生姓名",align:"center"}),a[19]||(a[19]=B()),P(fe,{prop:"className",label:"班级",align:"center"}),a[20]||(a[20]=B()),P(fe,{prop:"courseCode",label:"课程代码",align:"center"}),a[21]||(a[21]=B()),P(fe,{prop:"courseName",label:"课程名称",align:"center"}),a[22]||(a[22]=B()),P(fe,{prop:"semester",label:"学期",align:"center"}),a[23]||(a[23]=B()),P(fe,{prop:"score",label:"成绩",align:"center"},{default:R(e=>[F("span",{class:I(re(e.row.score)),style:{"font-weight":"bold"}},H(null!==e.row.score?e.row.score.toFixed(1):"--"),3)]),_:1}),a[24]||(a[24]=B()),P(fe,{prop:"statusDesc",label:"状态",align:"center"},{default:R(e=>[P(ve,{type:oe(e.row.status)},{default:R(()=>[B(H(e.row.statusDesc),1)]),_:2},1032,["type"])]),_:1}),a[25]||(a[25]=B()),P(fe,{label:"操作",align:"center",width:"150"},{default:R(e=>[P(j,{type:"primary",link:"",size:"small",onClick:a=>me(e.row)},{default:R(()=>a[16]||(a[16]=[B("\n              详情\n            ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ne,ee.value]]),a[26]||(a[26]=B()),ae.value>0?(D(),M(_e,{key:0,"page-sizes":[10,20,50,100],"page-size":Y.pageSize,currentPage:Y.pageNum,layout:"total, sizes, prev, pager, next, jumper",total:ae.value,onSizeChange:ce,onCurrentChange:ie},null,8,["page-size","currentPage","total"])):E("",!0)]),_:1}),a[42]||(a[42]=B()),P(ye,{modelValue:le.value,"onUpdate:modelValue":a[6]||(a[6]=e=>le.value=e),title:"成绩详情",width:"550px","append-to-body":""},{footer:R(()=>[F("div",q,[P(j,{onClick:a[5]||(a[5]=e=>le.value=!1)},{default:R(()=>a[38]||(a[38]=[B("关闭")])),_:1})])]),default:R(()=>[P(he,{column:1,border:""},{default:R(()=>[P(ge,{label:"学生姓名"},{default:R(()=>[B(H(te.value.studentName),1)]),_:1}),a[27]||(a[27]=B()),P(ge,{label:"学号"},{default:R(()=>[B(H(te.value.studentNo),1)]),_:1}),a[28]||(a[28]=B()),P(ge,{label:"班级"},{default:R(()=>[B(H(te.value.className),1)]),_:1}),a[29]||(a[29]=B()),P(ge,{label:"课程名称"},{default:R(()=>[B(H(te.value.courseName),1)]),_:1}),a[30]||(a[30]=B()),P(ge,{label:"课程代码"},{default:R(()=>[B(H(te.value.courseCode),1)]),_:1}),a[31]||(a[31]=B()),P(ge,{label:"课程类型"},{default:R(()=>[B(H(te.value.courseType),1)]),_:1}),a[32]||(a[32]=B()),P(ge,{label:"学分"},{default:R(()=>[B(H(te.value.credits),1)]),_:1}),a[33]||(a[33]=B()),P(ge,{label:"学期"},{default:R(()=>[B(H(te.value.semester),1)]),_:1}),a[34]||(a[34]=B()),P(ge,{label:"教师"},{default:R(()=>[B(H(te.value.teacherName),1)]),_:1}),a[35]||(a[35]=B()),P(ge,{label:"成绩"},{default:R(()=>[F("span",{class:I(re(te.value.score)),style:{"font-weight":"bold"}},H(null!==te.value.score?te.value.score.toFixed(1):"--"),3)]),_:1}),a[36]||(a[36]=B()),P(ge,{label:"选课时间"},{default:R(()=>[B(H(te.value.selectionTime),1)]),_:1}),a[37]||(a[37]=B()),P(ge,{label:"状态"},{default:R(()=>[P(ve,{type:oe(te.value.status)},{default:R(()=>[B(H(te.value.statusDesc),1)]),_:1},8,["type"])]),_:1})]),_:1}),a[39]||(a[39]=B())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-d9ed3d8a"]]);export{Q as default};
