var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,i=(e,i)=>{for(var n in i||(i={}))l.call(i,n)&&o(e,n,i[n]);if(a)for(var n of a(i))s.call(i,n)&&o(e,n,i[n]);return e},n=(e,a,l)=>new Promise((s,o)=>{var i=e=>{try{t(l.next(e))}catch(a){o(a)}},n=e=>{try{t(l.throw(e))}catch(a){o(a)}},t=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,n);t((l=l.apply(e,a)).next())});import{_ as t,u as r,A as d,B as u,C as c,D as m,E as f,F as v}from"./index-c00447c9.js";import{Z as p,_ as g,$ as b,a0 as w,a1 as _,a2 as h,a3 as y,a4 as V,i as P,a5 as k,a6 as x,a7 as U}from"./icons-3f8828dd.js";import{a1 as I,E as j,C as z,f as q,b as C,I as F,u as O,y as A,S as E,T as Z,e as $,w as G,x as B,F as D,G as M,v as Q,n as R}from"./element-plus-7067fc91.js";import{c as S,r as T,X as W,k as H,z as J,P as K,H as L,y as N,A as X,L as Y,u as ee,M as ae,K as le}from"./vue-core-ad22061d.js";import"./utils-ebe9136b.js";const se={class:"profile-container"},oe={class:"profile-avatar"},ie={class:"profile-avatar-upload"},ne={class:"profile-name"},te={class:"profile-info"},re={class:"info-item"},de={class:"info-item"},ue={class:"info-item"},ce={class:"profile-tabs-header"},me={key:0},fe={key:1},ve={key:2,class:"profile-binding"},pe={class:"binding-list"},ge={class:"binding-item"},be={class:"binding-info"},we={class:"binding-icon wx-icon"},_e={class:"binding-item"},he={class:"binding-info"},ye={class:"binding-icon qq-icon"},Ve={class:"binding-item"},Pe={class:"binding-info"},ke={class:"binding-icon wb-icon"},xe={key:3,class:"profile-notification"},Ue={class:"notification-item"},Ie={class:"notification-item"},je={class:"notification-item"},ze={class:"notification-item"},qe={class:"notification-item"},Ce={class:"notification-action"},Fe=t({__name:"index",setup(e){const a=r(),l=S(()=>a.userInfo||{}),s=S(()=>{switch(l.value.userType){case 0:return"管理员";case 1:return"教师";case 2:return"学生";default:return"未知"}}),o=T("basic"),t=T(null),Fe=W({username:"",name:"",email:"",phone:""}),Oe={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,message:"邮箱格式不正确",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}]},Ae=T(null),Ee=W({oldPassword:"",newPassword:"",confirmPassword:""}),Ze={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==Ee.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},$e=W({system:!0,course:!0,attendance:!0,email:!1,sms:!1}),Ge=T(!1),Be=T(!1),De=S(()=>{const e=l.value.avatar||u;return e.startsWith("/src/")||e.startsWith("/assets/")?e:c(e)});H(()=>n(this,null,function*(){var e;const s=I.service({lock:!0,text:"加载用户信息...",background:"rgba(0, 0, 0, 0.7)"});try{console.log("用户信息:",l.value),(null==(e=l.value)?void 0:e.username)||(console.log("用户信息不完整，尝试重新获取"),yield a.getInfo(),console.log("重新获取的用户信息:",a.userInfo)),yield Me()}catch(o){console.error("初始化用户数据失败:",o),j.error("获取用户信息失败，请刷新页面重试")}finally{s.close()}}));const Me=()=>n(this,null,function*(){console.log("初始化表单数据，用户信息:",l.value);let e=l.value.username||a.userInfo.username||"";if(!e){console.log("用户名为空，尝试从后端获取");const l=yield function(){return n(this,null,function*(){try{console.log("从后端获取当前用户信息");const e=yield d();if(e.data)return console.log("获取到的用户信息:",e.data),a.userInfo=i(i({},a.userInfo),e.data),e.data}catch(e){console.error("获取用户信息失败:",e),j.error("获取用户信息失败，请刷新页面")}return null})}();l&&(e=l.username||"")}console.log("最终获取到的用户名:",e),Fe.username=e,Fe.name=l.value.name||"",Fe.email=l.value.email||"",Fe.phone=l.value.phone||"",console.log("初始化后的表单数据:",Fe)}),Qe=e=>{const a="image/jpeg"===e.type,l="image/png"===e.type,s=e.size/1024/1024<2;return a||l?!!s||(j.error("上传头像图片大小不能超过 2MB!"),!1):(j.error("上传头像图片只能是 JPG 或 PNG 格式!"),!1)},Re=e=>{const l=new FormData;l.append("file",e.file);const s=I.service({lock:!0,text:"上传头像中...",background:"rgba(0, 0, 0, 0.7)"});m(l).then(e=>{if(200===e.code){const l=e.data;a.updateUserInfo({avatar:l}),j.success("头像上传成功")}else j.error(e.message||"头像上传失败")}).catch(e=>{var a,l;console.error("上传头像失败:",e),j.error((null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.message)||"头像上传失败")}).finally(()=>{s.close()})},Se=()=>{t.value.validate(e=>{if(e){if(Fe.username||(Fe.username=a.userInfo.username),!Fe.username)return void j.error("用户名信息缺失，请刷新页面重试");const e={username:Fe.username,name:Fe.name,email:Fe.email,phone:Fe.phone};Ge.value=!0,f(e).then(()=>{a.updateUserInfo(e),j.success("个人信息修改成功")}).catch(e=>{var a,l;console.error("修改个人信息失败:",e),j.error("修改个人信息失败: "+((null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.message)||e.message))}).finally(()=>{Ge.value=!1})}})},Te=()=>{var e;null==(e=t.value)||e.resetFields(),Me(),j.info("已重置为原始信息")},We=()=>{Ae.value.validate(e=>{e&&(Be.value=!0,v(Ee.oldPassword,Ee.newPassword).then(()=>{j.success("密码修改成功"),He()}).catch(e=>{var a,l;console.error("修改密码失败:",e),j.error("修改密码失败: "+((null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.message)||e.message))}).finally(()=>{Be.value=!1}))})},He=()=>{Ee.oldPassword="",Ee.newPassword="",Ee.confirmPassword=""},Je=()=>{j.success("通知设置已保存")};return(e,a)=>{const i=q,n=C,r=F,d=O,u=A,c=E,m=Z,f=$,v=G,I=B,j=D,S=M,T=Q,W=R,H=z;return N(),J("div",se,[K(H,{gutter:20},{default:L(()=>[K(u,{xs:24,sm:8,md:6,lg:5,xl:4},{default:L(()=>[K(d,{class:"profile-card",shadow:"hover"},{default:L(()=>[X("div",oe,[K(i,{size:100,src:De.value},null,8,["src"]),a[13]||(a[13]=Y()),X("div",ie,[K(r,{class:"avatar-uploader",action:"#","http-request":Re,"show-file-list":!1,"before-upload":Qe},{default:L(()=>[K(n,{class:"upload-icon"},{default:L(()=>[K(ee(p))]),_:1})]),_:1})])]),a[19]||(a[19]=Y()),X("h2",ne,ae(l.value.name),1),a[20]||(a[20]=Y()),X("div",te,[X("div",re,[K(n,null,{default:L(()=>[K(ee(g))]),_:1}),a[14]||(a[14]=Y()),X("span",null,ae(s.value),1)]),a[17]||(a[17]=Y()),X("div",de,[K(n,null,{default:L(()=>[K(ee(b))]),_:1}),a[15]||(a[15]=Y()),X("span",null,ae(l.value.email||"未设置邮箱"),1)]),a[18]||(a[18]=Y()),X("div",ue,[K(n,null,{default:L(()=>[K(ee(w))]),_:1}),a[16]||(a[16]=Y()),X("span",null,ae(l.value.phone||"未设置手机"),1)])]),a[21]||(a[21]=Y()),a[22]||(a[22]=X("div",{class:"profile-stats"},[X("div",{class:"stat-item"},[X("div",{class:"stat-value"},"12"),Y(),X("div",{class:"stat-label"},"我的课程")]),Y(),X("div",{class:"stat-item"},[X("div",{class:"stat-value"},"89%"),Y(),X("div",{class:"stat-label"},"出勤率")]),Y(),X("div",{class:"stat-item"},[X("div",{class:"stat-value"},"28"),Y(),X("div",{class:"stat-label"},"通知")])],-1))]),_:1})]),_:1}),a[79]||(a[79]=Y()),K(u,{xs:24,sm:16,md:18,lg:19,xl:20},{default:L(()=>[K(d,{shadow:"hover"},{header:L(()=>[X("div",ce,[K(m,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e)},{default:L(()=>[K(c,{label:"基本资料",name:"basic"},{label:L(()=>[X("span",null,[K(n,null,{default:L(()=>[K(ee(_))]),_:1}),a[23]||(a[23]=Y(" 基本资料"))])]),_:1}),a[27]||(a[27]=Y()),K(c,{label:"修改密码",name:"password"},{label:L(()=>[X("span",null,[K(n,null,{default:L(()=>[K(ee(h))]),_:1}),a[24]||(a[24]=Y(" 修改密码"))])]),_:1}),a[28]||(a[28]=Y()),K(c,{label:"账号绑定",name:"binding"},{label:L(()=>[X("span",null,[K(n,null,{default:L(()=>[K(ee(y))]),_:1}),a[25]||(a[25]=Y(" 账号绑定"))])]),_:1}),a[29]||(a[29]=Y()),K(c,{label:"消息通知",name:"notification"},{label:L(()=>[X("span",null,[K(n,null,{default:L(()=>[K(ee(V))]),_:1}),a[26]||(a[26]=Y(" 消息通知"))])]),_:1})]),_:1},8,["modelValue"])])]),default:L(()=>[a[78]||(a[78]=Y()),"basic"===o.value?(N(),J("div",me,[K(S,{ref_key:"userFormRef",ref:t,model:Fe,rules:Oe,"label-width":"80px",class:"profile-form"},{default:L(()=>[K(I,{label:"用户名",prop:"username"},{default:L(()=>[K(v,{modelValue:Fe.username,"onUpdate:modelValue":a[1]||(a[1]=e=>Fe.username=e),disabled:"",placeholder:"用户登录名"},{append:L(()=>[K(f,{content:"用户名是系统内部标识，不可修改",placement:"top"},{default:L(()=>[K(n,null,{default:L(()=>[K(ee(P))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[33]||(a[33]=Y()),K(I,{label:"姓名",prop:"name"},{default:L(()=>[K(v,{modelValue:Fe.name,"onUpdate:modelValue":a[2]||(a[2]=e=>Fe.name=e),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),a[34]||(a[34]=Y()),K(I,{label:"邮箱",prop:"email"},{default:L(()=>[K(v,{modelValue:Fe.email,"onUpdate:modelValue":a[3]||(a[3]=e=>Fe.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a[35]||(a[35]=Y()),K(I,{label:"手机号",prop:"phone"},{default:L(()=>[K(v,{modelValue:Fe.phone,"onUpdate:modelValue":a[4]||(a[4]=e=>Fe.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a[36]||(a[36]=Y()),K(I,null,{default:L(()=>[K(j,{type:"primary",onClick:Se,loading:Ge.value},{default:L(()=>a[30]||(a[30]=[Y("保存")])),_:1},8,["loading"]),a[32]||(a[32]=Y()),K(j,{onClick:Te},{default:L(()=>a[31]||(a[31]=[Y("重置")])),_:1})]),_:1})]),_:1},8,["model"])])):"password"===o.value?(N(),J("div",fe,[K(S,{ref_key:"passwordFormRef",ref:Ae,model:Ee,rules:Ze,"label-width":"120px",class:"profile-form"},{default:L(()=>[K(I,{label:"当前密码",prop:"oldPassword"},{default:L(()=>[K(v,{modelValue:Ee.oldPassword,"onUpdate:modelValue":a[5]||(a[5]=e=>Ee.oldPassword=e),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),a[41]||(a[41]=Y()),K(I,{label:"新密码",prop:"newPassword"},{append:L(()=>[K(f,{content:"密码必须包含大小写字母和数字，长度不少于6位",placement:"top"},{default:L(()=>[K(n,null,{default:L(()=>[K(ee(P))]),_:1})]),_:1})]),default:L(()=>[K(v,{modelValue:Ee.newPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>Ee.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"]),a[37]||(a[37]=Y())]),_:1}),a[42]||(a[42]=Y()),K(I,{label:"确认新密码",prop:"confirmPassword"},{default:L(()=>[K(v,{modelValue:Ee.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>Ee.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a[43]||(a[43]=Y()),K(I,null,{default:L(()=>[K(j,{type:"primary",onClick:We,loading:Be.value},{default:L(()=>a[38]||(a[38]=[Y("保存")])),_:1},8,["loading"]),a[40]||(a[40]=Y()),K(j,{onClick:He},{default:L(()=>a[39]||(a[39]=[Y("重置")])),_:1})]),_:1})]),_:1},8,["model"])])):"binding"===o.value?(N(),J("div",ve,[K(T,null,{default:L(()=>a[44]||(a[44]=[Y("社交账号绑定")])),_:1}),a[59]||(a[59]=Y()),X("div",pe,[X("div",ge,[X("div",be,[X("div",we,[K(n,null,{default:L(()=>[K(ee(k))]),_:1})]),a[45]||(a[45]=Y()),a[46]||(a[46]=X("div",{class:"binding-detail"},[X("div",{class:"binding-name"},"微信"),Y(),X("div",{class:"binding-status"},"未绑定")],-1))]),a[48]||(a[48]=Y()),K(j,{type:"success",size:"small"},{default:L(()=>a[47]||(a[47]=[Y("绑定")])),_:1})]),a[57]||(a[57]=Y()),X("div",_e,[X("div",he,[X("div",ye,[K(n,null,{default:L(()=>[K(ee(x))]),_:1})]),a[49]||(a[49]=Y()),a[50]||(a[50]=X("div",{class:"binding-detail"},[X("div",{class:"binding-name"},"QQ"),Y(),X("div",{class:"binding-status"},"未绑定")],-1))]),a[52]||(a[52]=Y()),K(j,{type:"success",size:"small"},{default:L(()=>a[51]||(a[51]=[Y("绑定")])),_:1})]),a[58]||(a[58]=Y()),X("div",Ve,[X("div",Pe,[X("div",ke,[K(n,null,{default:L(()=>[K(ee(U))]),_:1})]),a[53]||(a[53]=Y()),a[54]||(a[54]=X("div",{class:"binding-detail"},[X("div",{class:"binding-name"},"微博"),Y(),X("div",{class:"binding-status"},"未绑定")],-1))]),a[56]||(a[56]=Y()),K(j,{type:"success",size:"small"},{default:L(()=>a[55]||(a[55]=[Y("绑定")])),_:1})])])])):"notification"===o.value?(N(),J("div",xe,[K(T,null,{default:L(()=>a[60]||(a[60]=[Y("消息通知设置")])),_:1}),a[72]||(a[72]=Y()),X("div",Ue,[a[61]||(a[61]=X("div",{class:"notification-info"},[X("div",{class:"notification-title"},"系统通知"),Y(),X("div",{class:"notification-desc"},"系统更新、维护等通知")],-1)),a[62]||(a[62]=Y()),K(W,{modelValue:$e.system,"onUpdate:modelValue":a[8]||(a[8]=e=>$e.system=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[73]||(a[73]=Y()),X("div",Ie,[a[63]||(a[63]=X("div",{class:"notification-info"},[X("div",{class:"notification-title"},"课程通知"),Y(),X("div",{class:"notification-desc"},"课程变更、考试等通知")],-1)),a[64]||(a[64]=Y()),K(W,{modelValue:$e.course,"onUpdate:modelValue":a[9]||(a[9]=e=>$e.course=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[74]||(a[74]=Y()),X("div",je,[a[65]||(a[65]=X("div",{class:"notification-info"},[X("div",{class:"notification-title"},"考勤通知"),Y(),X("div",{class:"notification-desc"},"考勤记录、异常提醒等通知")],-1)),a[66]||(a[66]=Y()),K(W,{modelValue:$e.attendance,"onUpdate:modelValue":a[10]||(a[10]=e=>$e.attendance=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[75]||(a[75]=Y()),X("div",ze,[a[67]||(a[67]=X("div",{class:"notification-info"},[X("div",{class:"notification-title"},"邮件通知"),Y(),X("div",{class:"notification-desc"},"通过邮件接收通知")],-1)),a[68]||(a[68]=Y()),K(W,{modelValue:$e.email,"onUpdate:modelValue":a[11]||(a[11]=e=>$e.email=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[76]||(a[76]=Y()),X("div",qe,[a[69]||(a[69]=X("div",{class:"notification-info"},[X("div",{class:"notification-title"},"短信通知"),Y(),X("div",{class:"notification-desc"},"通过短信接收通知")],-1)),a[70]||(a[70]=Y()),K(W,{modelValue:$e.sms,"onUpdate:modelValue":a[12]||(a[12]=e=>$e.sms=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[77]||(a[77]=Y()),X("div",Ce,[K(j,{type:"primary",onClick:Je},{default:L(()=>a[71]||(a[71]=[Y("保存设置")])),_:1})])])):le("",!0)]),_:1})]),_:1})]),_:1})])}}},[["__scopeId","data-v-0966c869"]]);export{Fe as default};
