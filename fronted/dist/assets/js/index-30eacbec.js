var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{_ as u,u as n}from"./index-c00447c9.js";import{_ as i}from"./index-f992b0ab.js";import{_ as d}from"./index-aa3c308e.js";import{r as c,k as v,z as p,P as m,H as f,n as b,aq as h,y as w,A as g,L as _,I as y,Q as D,a5 as j,O as L,a4 as O,G as k,M as x}from"./vue-core-ad22061d.js";import{g as C,e as N}from"./attendance-0d82083c.js";import{E as S}from"./utils-ebe9136b.js";import{u as U,w as z,x as V,R as I,B as P,F as R,G as E,y as F,C as A,J as Y,K as M,L as q,O as B,A as G}from"./element-plus-7067fc91.js";import"./icons-3f8828dd.js";const K={class:"app-container"},Q={class:"statistic-number"},T={class:"statistic-number"},W={class:"statistic-number"},H={class:"statistic-number"},J={class:"statistic-number"},$={class:"statistic-number"},X={class:"chart-content"},Z=u({__name:"index",setup(e){const u=n();c(u.userId);const Z=c(u.userId),ee=c(null);let ae=null;const te=c([]),le=c(!1),se=c(!0),re=c(0),oe=c({total:0,normal:0,absent:0,late:0,earlyLeave:0,leave:0}),ue=c([{value:0,label:"出勤"},{value:1,label:"缺勤"},{value:2,label:"迟到"},{value:3,label:"早退"},{value:4,label:"请假"}]),ne=c([]),ie=c({pageNum:1,pageSize:10,courseName:void 0,startDate:void 0,endDate:void 0,status:void 0});function de(){le.value=!0,ne.value&&ne.value.length>0?(ie.value.startDate=ne.value[0],ie.value.endDate=ne.value[1]):(ie.value.startDate=void 0,ie.value.endDate=void 0),C(u.userId,ie.value).then(e=>{e&&e.data?(te.value=e.data.list||[],re.value=parseInt(e.data.total),oe.value={total:te.value.length,normal:0,absent:0,late:0,earlyLeave:0,leave:0},te.value.forEach(e=>{switch(e.status){case 0:oe.value.normal++;break;case 1:oe.value.absent++;break;case 2:oe.value.late++;break;case 3:oe.value.earlyLeave++;break;case 4:oe.value.leave++}}),b(()=>{!function(){if(!ee.value)return;ae&&ae.dispose();ae=S(ee.value);const e={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"bottom",data:["出勤","缺勤","迟到","早退","请假"]},series:[{name:"考勤状态",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:oe.value.normal,name:"出勤"},{value:oe.value.absent,name:"缺勤"},{value:oe.value.late,name:"迟到"},{value:oe.value.earlyLeave,name:"早退"},{value:oe.value.leave,name:"请假"}],color:["#67C23A","#F56C6C","#E6A23C","#909399","#409EFF"]}]};ae.setOption(e),window.addEventListener("resize",()=>{ae&&ae.resize()})}()})):(te.value=[],re.value=0,oe.value={total:0,normal:0,absent:0,late:0,earlyLeave:0,leave:0}),le.value=!1}).catch(e=>{console.error("获取考勤数据失败:",e),te.value=[],re.value=0,le.value=!1})}function ce(){ne.value=[],ie.value={pageNum:1,pageSize:10,courseName:void 0,startDate:void 0,endDate:void 0,status:void 0},ve()}function ve(){ie.value.pageNum=1,de()}function pe(){const e=(u=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))r.call(a,t)&&o(e,t,a[t]);return e})({},ie.value),n={studentId:Z.value,export:!0},a(u,t(n)));var u,n;ne.value&&ne.value.length>0&&(e.startDate=ne.value[0],e.endDate=ne.value[1]),N(e).then(e=>{const a=new Blob([e.data]),t=`我的考勤记录_${(new Date).getTime()}.xlsx`,l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=t,l.click(),URL.revokeObjectURL(l.href)})}return v(()=>{de()}),(e,a)=>{const t=z,l=V,s=I,r=G,o=P,u=R,n=E,c=F,v=d,b=A,C=U,N=Y,S=M,Z=q,ae=i,me=h("hasPerms"),fe=B;return w(),p("div",K,[m(C,{class:"box-card"},{header:f(()=>a[6]||(a[6]=[g("div",{class:"card-header"},[g("span",null,"我的考勤记录")],-1)])),default:f(()=>[a[39]||(a[39]=_()),y(m(n,{model:ie.value,ref:"queryForm",inline:!0},{default:f(()=>[m(l,{label:"课程名称",prop:"courseName"},{default:f(()=>[m(t,{modelValue:ie.value.courseName,"onUpdate:modelValue":a[0]||(a[0]=e=>ie.value.courseName=e),placeholder:"请输入课程名称",clearable:"",onKeyup:j(ve,["enter"])},null,8,["modelValue"])]),_:1}),a[10]||(a[10]=_()),m(l,{label:"考勤日期",prop:"attendanceDate"},{default:f(()=>[m(s,{modelValue:ne.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ne.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a[11]||(a[11]=_()),m(l,{label:"考勤状态",prop:"status"},{default:f(()=>[m(o,{modelValue:ie.value.status,"onUpdate:modelValue":a[2]||(a[2]=e=>ie.value.status=e),placeholder:"请选择考勤状态",clearable:""},{default:f(()=>[(w(!0),p(L,null,O(ue.value,e=>(w(),k(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[12]||(a[12]=_()),m(l,null,{default:f(()=>[m(u,{type:"primary",icon:"Search",onClick:ve},{default:f(()=>a[7]||(a[7]=[_("搜索")])),_:1}),a[9]||(a[9]=_()),m(u,{icon:"Refresh",onClick:ce},{default:f(()=>a[8]||(a[8]=[_("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[D,se.value]]),a[40]||(a[40]=_()),m(b,{gutter:10,class:"mb8"},{default:f(()=>[m(c,{span:1.5},{default:f(()=>[y((w(),k(u,{type:"warning",plain:"",icon:"Download",onClick:pe},{default:f(()=>a[13]||(a[13]=[_("导出")])),_:1})),[[me,["attendance:record:export"]]])]),_:1}),a[14]||(a[14]=_()),m(v,{showSearch:se.value,"onUpdate:showSearch":a[3]||(a[3]=e=>se.value=e),onQueryTable:de},null,8,["showSearch"])]),_:1}),a[41]||(a[41]=_()),m(b,{gutter:20,class:"mb20"},{default:f(()=>[m(c,{span:4},{default:f(()=>[m(C,{shadow:"hover",class:"statistic-card"},{default:f(()=>[a[15]||(a[15]=g("div",{class:"statistic-title"},"总考勤",-1)),a[16]||(a[16]=_()),g("div",Q,x(oe.value.total),1)]),_:1})]),_:1}),a[27]||(a[27]=_()),m(c,{span:4},{default:f(()=>[m(C,{shadow:"hover",class:"statistic-card normal"},{default:f(()=>[a[17]||(a[17]=g("div",{class:"statistic-title"},"出勤",-1)),a[18]||(a[18]=_()),g("div",T,x(oe.value.normal),1)]),_:1})]),_:1}),a[28]||(a[28]=_()),m(c,{span:4},{default:f(()=>[m(C,{shadow:"hover",class:"statistic-card absent"},{default:f(()=>[a[19]||(a[19]=g("div",{class:"statistic-title"},"缺勤",-1)),a[20]||(a[20]=_()),g("div",W,x(oe.value.absent),1)]),_:1})]),_:1}),a[29]||(a[29]=_()),m(c,{span:4},{default:f(()=>[m(C,{shadow:"hover",class:"statistic-card late"},{default:f(()=>[a[21]||(a[21]=g("div",{class:"statistic-title"},"迟到",-1)),a[22]||(a[22]=_()),g("div",H,x(oe.value.late),1)]),_:1})]),_:1}),a[30]||(a[30]=_()),m(c,{span:4},{default:f(()=>[m(C,{shadow:"hover",class:"statistic-card early-leave"},{default:f(()=>[a[23]||(a[23]=g("div",{class:"statistic-title"},"早退",-1)),a[24]||(a[24]=_()),g("div",J,x(oe.value.earlyLeave),1)]),_:1})]),_:1}),a[31]||(a[31]=_()),m(c,{span:4},{default:f(()=>[m(C,{shadow:"hover",class:"statistic-card leave"},{default:f(()=>[a[25]||(a[25]=g("div",{class:"statistic-title"},"请假",-1)),a[26]||(a[26]=_()),g("div",$,x(oe.value.leave),1)]),_:1})]),_:1})]),_:1}),a[42]||(a[42]=_()),y((w(),k(Z,{data:te.value},{default:f(()=>[m(N,{label:"课程名称",align:"center",prop:"courseName","show-overflow-tooltip":!0}),a[32]||(a[32]=_()),m(N,{label:"课程编码",align:"center",prop:"courseCode"}),a[33]||(a[33]=_()),m(N,{label:"班级",align:"center",prop:"className","show-overflow-tooltip":!0}),a[34]||(a[34]=_()),m(N,{label:"考勤日期",align:"center",prop:"attendanceDate",width:"100"}),a[35]||(a[35]=_()),m(N,{label:"考勤状态",align:"center",prop:"statusDesc",width:"80"},{default:f(e=>[m(S,{type:0===e.row.status?"success":1===e.row.status?"danger":2===e.row.status?"warning":3===e.row.status?"info":""},{default:f(()=>[_(x(e.row.statusDesc),1)]),_:2},1032,["type"])]),_:1}),a[36]||(a[36]=_()),m(N,{label:"备注",align:"center",prop:"remark","show-overflow-tooltip":!0})]),_:1},8,["data"])),[[fe,le.value]]),a[43]||(a[43]=_()),y(m(ae,{total:re.value,page:ie.value.pageNum,"onUpdate:page":a[4]||(a[4]=e=>ie.value.pageNum=e),limit:ie.value.pageSize,"onUpdate:limit":a[5]||(a[5]=e=>ie.value.pageSize=e),onPagination:de},null,8,["total","page","limit"]),[[D,re.value>0]]),a[44]||(a[44]=_()),m(C,{class:"chart-card",shadow:"hover",style:{"margin-top":"20px"}},{header:f(()=>a[37]||(a[37]=[g("div",{class:"chart-header"},[g("span",null,"考勤统计分析")],-1)])),default:f(()=>[a[38]||(a[38]=_()),g("div",X,[g("div",{id:"attendanceChart",class:"chart",ref_key:"attendanceChartRef",ref:ee},null,512)])]),_:1})]),_:1})])}}},[["__scopeId","data-v-770bf1bb"]]);export{Z as default};
