var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,s=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&r(e,t,a[t]);return e};import{_ as u,u as i,g as d,a as c}from"./index-c00447c9.js";import{_ as p}from"./index-f992b0ab.js";import{r as v,h as m,k as h,z as f,P as g,H as b,n as y,y as C,A as w,L as _,G as I,M as k,K as x,O as L,a4 as R,I as F,Q as A}from"./vue-core-ad22061d.js";import{a as O,e as j}from"./attendance-0d82083c.js";import{E as D}from"./utils-ebe9136b.js";import{u as E,A as z,B as N,x as S,R as V,a0 as U,F as P,G as T,y as Y,C as M,J as B,_ as G,L as W,O as q}from"./element-plus-7067fc91.js";import"./icons-3f8828dd.js";const H={class:"app-container"},J={class:"course-item"},K={class:"course-code"},Q={class:"charts-container"},$={class:"chart-content"},X={class:"chart-content"},Z={class:"table-header"},ee={class:"table-container"},ae=u({__name:"index",setup(e){const l=i();v(l.userId);const n=v(null),o=v(null);let r=null,u=null;const ae=v([]),te=v([]),le=v(!1),ne=v(0);v([]),v(!1);const oe=v([]),re=v(!1),se=v(!1),ue=v(!1),ie=v({pageNum:1,pageSize:10,type:"course",startDate:void 0,endDate:void 0,courseId:void 0,classId:void 0}),de=v("");function ce(){re.value=!0,c({pageNum:1,pageSize:100}).then(e=>{oe.value=e.data.records,re.value=!1}).catch(()=>{re.value=!1})}function pe(e){switch(ie.value.courseId=void 0,ie.value.classId=void 0,de.value="",e){case"course":default:se.value=!1,ue.value=!1;break;case"class":se.value=!1,ue.value=!1,ce();break;case"date":case"status":se.value=!0,ue.value=!0,ce()}ve()}function ve(){ie.value.pageNum=1,ae.value&&ae.value.length>0?(ie.value.startDate=ae.value[0],ie.value.endDate=ae.value[1]):(ie.value.startDate=void 0,ie.value.endDate=void 0),he()}function me(){ae.value=[],de.value="",ie.value={pageNum:1,pageSize:10,type:"course",startDate:void 0,endDate:void 0,courseId:void 0,classId:void 0},ve()}function he(){le.value=!0,O(ie.value).then(e=>{console.log("考勤统计响应数据:",e),e.data&&e.data.list?(te.value=e.data.list||[],ne.value=parseInt(e.data.total||0)):e.data&&Array.isArray(e.data.records)?(te.value=e.data.records||[],ne.value=parseInt(e.data.total||0)):Array.isArray(e.data)?(te.value=e.data||[],ne.value=te.value.length):(console.error("无法识别的响应数据格式:",e.data),te.value=[],ne.value=0),le.value=!1,y(()=>{try{!function(){if(!n.value)return;let e=[];if(te.value&&0!==te.value.length)if("status"===ie.value.type)e=te.value.map(e=>({value:e.count||0,name:e.statusName||"未知状态"}));else{const a={normalCount:0,absentCount:0,lateCount:0,earlyLeaveCount:0,leaveCount:0};te.value.forEach(e=>{a.normalCount+=parseInt(e.normalCount||0),a.absentCount+=parseInt(e.absentCount||0),a.lateCount+=parseInt(e.lateCount||0),a.earlyLeaveCount+=parseInt(e.earlyLeaveCount||0),a.leaveCount+=parseInt(e.leaveCount||0)}),e=[{value:a.normalCount,name:"出勤"},{value:a.absentCount,name:"缺勤"},{value:a.lateCount,name:"迟到"},{value:a.earlyLeaveCount,name:"早退"},{value:a.leaveCount,name:"请假"}]}else console.log("没有统计数据，不能初始化状态图表"),e=[{value:0,name:"出勤"},{value:0,name:"缺勤"},{value:0,name:"迟到"},{value:0,name:"早退"},{value:0,name:"请假"}];r&&r.dispose();r=D(n.value);const a={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"bottom",data:e.map(e=>e.name)},series:[{name:"考勤状态",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:e,color:["#67C23A","#F56C6C","#E6A23C","#909399","#909399"]}]};r.setOption(a),window.addEventListener("resize",()=>{r&&r.resize()})}(),function(){if(!o.value)return;let e=[],a=[];if(te.value&&0!==te.value.length){if("date"===ie.value.type){te.value.forEach(e=>{a.push(e.date||"未知日期")});e=[{name:"出勤",type:"line",stack:"Total",data:te.value.map(e=>parseInt(e.normalCount||0)),emphasis:{focus:"series"}},{name:"缺勤",type:"line",stack:"Total",data:te.value.map(e=>parseInt(e.absentCount||0)),emphasis:{focus:"series"}},{name:"迟到",type:"line",stack:"Total",data:te.value.map(e=>parseInt(e.lateCount||0)),emphasis:{focus:"series"}},{name:"早退",type:"line",stack:"Total",data:te.value.map(e=>parseInt(e.earlyLeaveCount||0)),emphasis:{focus:"series"}},{name:"请假",type:"line",stack:"Total",data:te.value.map(e=>parseInt(e.leaveCount||0)),emphasis:{focus:"series"}}]}else if("course"===ie.value.type||"class"===ie.value.type){const t="course"===ie.value.type?"courseName":"className";te.value.forEach(e=>{a.push(e[t]||"未知")});e=[{name:"出勤率",type:"bar",data:te.value.map(e=>parseFloat(e.attendanceRate||0)),itemStyle:{color:function(e){return ge(e.value)}},label:{show:!0,position:"top",formatter:"{c}%"}}]}}else console.log("没有统计数据，不能初始化趋势图表"),a=["暂无数据"],e=[{name:"出勤率",type:"bar",data:[0],itemStyle:{color:"#67C23A"}}];u&&u.dispose();u=D(o.value);const t={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:e.map(e=>e.name)},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",axisLabel:{formatter:function(e){return"date"===ie.value.type?e:e+"%"}},max:"date"!==ie.value.type?100:void 0},series:e,color:["#67C23A","#F56C6C","#E6A23C","#909399","#409EFF"]};u.setOption(t),window.addEventListener("resize",()=>{u&&u.resize()})}()}catch(e){console.error("初始化图表时出错:",e)}})}).catch(e=>{console.error("获取考勤统计数据失败:",e),te.value=[],ne.value=0,le.value=!1})}function fe(){const e=s({},ie.value);var l,n;ae.value&&ae.value.length>0&&(e.startDate=ae.value[0],e.endDate=ae.value[1]),j((l=s({},e),n={export:!0},a(l,t(n)))).then(e=>{const a=new Blob([e.data]),t=`考勤统计_${(new Date).getTime()}.xlsx`,l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=t,l.click(),URL.revokeObjectURL(l.href)})}function ge(e){return(e=parseFloat(e))>=90?"#67C23A":e>=80?"#409EFF":e>=70?"#E6A23C":"#F56C6C"}function be(e){switch(e){case 0:return"#67C23A";case 1:return"#F56C6C";case 2:return"#E6A23C";case 3:return"#909399";default:return"#409EFF"}}function ye(e,a){e?d({keyword:e,pageNum:1,pageSize:10}).then(e=>{if(console.log("课程搜索结果:",e),200===e.code&&e.data&&e.data.list){const t=e.data.list.map(e=>({value:e.name,name:e.name,id:e.id,code:e.code}));a(t)}else a([])}).catch(()=>{a([])}):a([])}function Ce(e){console.log("选中课程:",e),ie.value.courseId=e.id,de.value=e.name,ve()}return m(()=>ie.value.type,e=>{pe(e)}),h(()=>{he()}),(e,a)=>{const t=z,l=N,r=S,s=V,u=U,i=P,d=T,c=E,v=Y,m=M,h=B,y=G,O=W,j=p,D=q;return C(),f("div",H,[g(c,{class:"box-card"},{header:b(()=>a[6]||(a[6]=[w("div",{class:"card-header"},[w("span",null,"考勤统计分析")],-1)])),default:b(()=>[a[55]||(a[55]=_()),g(d,{model:ie.value,ref:"queryForm",inline:!0,class:"stats-form"},{default:b(()=>[g(r,{label:"统计类型",prop:"type"},{default:b(()=>[g(l,{modelValue:ie.value.type,"onUpdate:modelValue":a[0]||(a[0]=e=>ie.value.type=e),placeholder:"请选择统计类型",onChange:pe,style:{width:"180px"}},{default:b(()=>[g(t,{label:"按课程统计",value:"course"}),a[7]||(a[7]=_()),g(t,{label:"按班级统计",value:"class"}),a[8]||(a[8]=_()),g(t,{label:"按日期统计",value:"date"}),a[9]||(a[9]=_()),g(t,{label:"按考勤状态统计",value:"status"})]),_:1},8,["modelValue"])]),_:1}),a[13]||(a[13]=_()),g(r,{label:"日期范围",prop:"dateRange"},{default:b(()=>[g(s,{modelValue:ae.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ae.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"320px"}},null,8,["modelValue"])]),_:1}),a[14]||(a[14]=_()),se.value?(C(),I(r,{key:0,label:"课程",prop:"courseId"},{default:b(()=>[g(u,{modelValue:de.value,"onUpdate:modelValue":a[2]||(a[2]=e=>de.value=e),"fetch-suggestions":ye,placeholder:"请输入课程名称",onSelect:Ce,"trigger-on-focus":!1,style:{width:"250px"}},{default:b(({item:e})=>[w("div",J,[_(k(e.name)+" ",1),w("span",K,"("+k(e.code)+")",1)])]),_:1},8,["modelValue"])]),_:1})):x("",!0),a[15]||(a[15]=_()),ue.value?(C(),I(r,{key:1,label:"班级",prop:"classId"},{default:b(()=>[g(l,{modelValue:ie.value.classId,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.value.classId=e),placeholder:"请选择班级",filterable:"",style:{width:"250px"}},{default:b(()=>[(C(!0),f(L,null,R(oe.value,e=>(C(),I(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):x("",!0),a[16]||(a[16]=_()),g(r,null,{default:b(()=>[g(i,{type:"primary",icon:"Search",onClick:ve},{default:b(()=>a[10]||(a[10]=[_("查询")])),_:1}),a[12]||(a[12]=_()),g(i,{icon:"Refresh",onClick:me},{default:b(()=>a[11]||(a[11]=[_("重置")])),_:1})]),_:1})]),_:1},8,["model"]),a[56]||(a[56]=_()),w("div",Q,[g(m,{gutter:20},{default:b(()=>[g(v,{span:24},{default:b(()=>[g(c,{class:"chart-card",shadow:"hover"},{header:b(()=>a[17]||(a[17]=[w("div",{class:"chart-header"},[w("span",null,"考勤状态分布")],-1)])),default:b(()=>[a[18]||(a[18]=_()),w("div",$,[w("div",{id:"statusChart",class:"chart",ref_key:"statusChartRef",ref:n},null,512)])]),_:1})]),_:1})]),_:1}),a[21]||(a[21]=_()),g(m,{gutter:20,style:{"margin-top":"20px"}},{default:b(()=>[g(v,{span:24},{default:b(()=>[g(c,{class:"chart-card",shadow:"hover"},{header:b(()=>a[19]||(a[19]=[w("div",{class:"chart-header"},[w("span",null,"考勤趋势分析")],-1)])),default:b(()=>[a[20]||(a[20]=_()),w("div",X,[w("div",{id:"trendChart",class:"chart",ref_key:"trendChartRef",ref:o},null,512)])]),_:1})]),_:1})]),_:1})]),a[57]||(a[57]=_()),g(m,{style:{"margin-top":"20px"}},{default:b(()=>[g(v,{span:24},{default:b(()=>[g(c,{class:"table-card",shadow:"hover"},{header:b(()=>[w("div",Z,[a[23]||(a[23]=w("span",null,"考勤统计详情",-1)),a[24]||(a[24]=_()),g(i,{type:"primary",icon:"Download",size:"small",onClick:fe},{default:b(()=>a[22]||(a[22]=[_("导出")])),_:1})])]),default:b(()=>[a[54]||(a[54]=_()),w("div",ee,[F((C(),I(O,{data:te.value,border:"",stripe:""},{default:b(()=>["course"===ie.value.type?(C(),f(L,{key:0},[g(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120"}),a[25]||(a[25]=_()),g(h,{label:"课程编码",align:"center",prop:"courseCode","min-width":"100"}),a[26]||(a[26]=_()),g(h,{label:"出勤率",align:"center",prop:"attendanceRate","min-width":"120"},{default:b(e=>[g(y,{percentage:parseFloat(e.row.attendanceRate),color:ge(e.row.attendanceRate)},null,8,["percentage","color"])]),_:1}),a[27]||(a[27]=_()),g(h,{label:"出勤",align:"center",prop:"normalCount","min-width":"80"}),a[28]||(a[28]=_()),g(h,{label:"缺勤",align:"center",prop:"absentCount","min-width":"80"}),a[29]||(a[29]=_()),g(h,{label:"迟到",align:"center",prop:"lateCount","min-width":"80"}),a[30]||(a[30]=_()),g(h,{label:"早退",align:"center",prop:"earlyLeaveCount","min-width":"80"}),a[31]||(a[31]=_()),g(h,{label:"请假",align:"center",prop:"leaveCount","min-width":"80"}),a[32]||(a[32]=_()),g(h,{label:"总记录数",align:"center",prop:"totalCount","min-width":"100"})],64)):x("",!0),a[50]||(a[50]=_()),"class"===ie.value.type?(C(),f(L,{key:1},[g(h,{label:"班级名称",align:"center",prop:"className","min-width":"150"}),a[33]||(a[33]=_()),g(h,{label:"班级编码",align:"center",prop:"classCode","min-width":"100"}),a[34]||(a[34]=_()),g(h,{label:"出勤率",align:"center",prop:"attendanceRate","min-width":"120"},{default:b(e=>[g(y,{percentage:parseFloat(e.row.attendanceRate),color:ge(e.row.attendanceRate)},null,8,["percentage","color"])]),_:1}),a[35]||(a[35]=_()),g(h,{label:"出勤",align:"center",prop:"normalCount","min-width":"80"}),a[36]||(a[36]=_()),g(h,{label:"缺勤",align:"center",prop:"absentCount","min-width":"80"}),a[37]||(a[37]=_()),g(h,{label:"迟到",align:"center",prop:"lateCount","min-width":"80"}),a[38]||(a[38]=_()),g(h,{label:"早退",align:"center",prop:"earlyLeaveCount","min-width":"80"}),a[39]||(a[39]=_()),g(h,{label:"请假",align:"center",prop:"leaveCount","min-width":"80"}),a[40]||(a[40]=_()),g(h,{label:"总记录数",align:"center",prop:"totalCount","min-width":"100"})],64)):x("",!0),a[51]||(a[51]=_()),"date"===ie.value.type?(C(),f(L,{key:2},[g(h,{label:"日期",align:"center",prop:"date","min-width":"120"}),a[41]||(a[41]=_()),g(h,{label:"出勤率",align:"center",prop:"attendanceRate","min-width":"120"},{default:b(e=>[g(y,{percentage:parseFloat(e.row.attendanceRate),color:ge(e.row.attendanceRate)},null,8,["percentage","color"])]),_:1}),a[42]||(a[42]=_()),g(h,{label:"出勤",align:"center",prop:"normalCount","min-width":"80"}),a[43]||(a[43]=_()),g(h,{label:"缺勤",align:"center",prop:"absentCount","min-width":"80"}),a[44]||(a[44]=_()),g(h,{label:"迟到",align:"center",prop:"lateCount","min-width":"80"}),a[45]||(a[45]=_()),g(h,{label:"早退",align:"center",prop:"earlyLeaveCount","min-width":"80"}),a[46]||(a[46]=_()),g(h,{label:"请假",align:"center",prop:"leaveCount","min-width":"80"}),a[47]||(a[47]=_()),g(h,{label:"总记录数",align:"center",prop:"totalCount","min-width":"100"})],64)):x("",!0),a[52]||(a[52]=_()),"status"===ie.value.type?(C(),f(L,{key:3},[g(h,{label:"考勤状态",align:"center",prop:"statusName","min-width":"120"}),a[48]||(a[48]=_()),g(h,{label:"记录数",align:"center",prop:"count","min-width":"100"}),a[49]||(a[49]=_()),g(h,{label:"占比",align:"center",prop:"percentage","min-width":"180"},{default:b(e=>[g(y,{percentage:parseFloat(e.row.percentage),color:be(e.row.status)},null,8,["percentage","color"])]),_:1})],64)):x("",!0)]),_:1},8,["data"])),[[D,le.value]]),a[53]||(a[53]=_()),F(g(j,{total:ne.value,page:ie.value.pageNum,"onUpdate:page":a[4]||(a[4]=e=>ie.value.pageNum=e),limit:ie.value.pageSize,"onUpdate:limit":a[5]||(a[5]=e=>ie.value.pageSize=e),onPagination:he},null,8,["total","page","limit"]),[[A,ne.value>0]])])]),_:1})]),_:1})]),_:1})]),_:1})])}}},[["__scopeId","data-v-bcc3e76f"]]);export{ae as default};
