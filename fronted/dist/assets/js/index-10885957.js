var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,u=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&u(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&u(e,l,a[l]);return e},n=(e,t)=>a(e,l(t)),c=(e,a,l)=>new Promise((t,o)=>{var s=e=>{try{r(l.next(e))}catch(a){o(a)}},u=e=>{try{r(l.throw(e))}catch(a){o(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,u);r((l=l.apply(e,a)).next())});import{_ as i,u as d,f as p,h as m,i as v,j as f,k as g,l as h}from"./index-c00447c9.js";import{_ as w}from"./index-f992b0ab.js";import{_}from"./index-aa3c308e.js";import{r as b,c as y,k as T,z as C,P as S,H as N,L as x,y as V,A as k,I as j,Q as U,a5 as O,O as P,a4 as z,M,G as I,K as R}from"./vue-core-ad22061d.js";import{E as L,u as K,H as A,w as E,x as F,A as G,B as H,F as Q,G as q,C as B,U as D,J,L as W,S as X,K as Y,T as Z,O as $}from"./element-plus-7067fc91.js";import"./icons-3f8828dd.js";import"./utils-ebe9136b.js";const ee={class:"app-container"},ae={class:"selection-tips"},le={class:"highlight"},te={class:"highlight"},oe={class:"conflict-message"},se={key:0,class:"conflict-details"},ue={class:"dialog-footer"},re={class:"select-confirm-message"},ne={key:0,class:"course-info"},ce={class:"dialog-footer"},ie={class:"withdraw-confirm-message"},de={key:0,class:"course-info"},pe={class:"dialog-footer"},me=i({__name:"index",setup(e){const a=d();b(a.userId);const l=b(!1),t=b(!1),o=b(!0),s=b(0),u=b(0),i=b([]),me=b([]),ve=b("available"),fe=b(!1),ge=b(!1),he=b(!1),we=b(null),_e=b(null),be=b(null),ye=b(null),Te=b([{value:"必修",label:"必修课"},{value:"选修",label:"选修课"},{value:"公选",label:"公共选修课"},{value:"实践",label:"实践课"}]),Ce=b({selectedCount:0,selectedCredits:0,maxCourses:10,maxCredits:30,startTime:"2025-06-10 00:00:00",endTime:"2025-06-20 23:59:59",isSelectionTime:!0}),Se=y(()=>Ce.value.isSelectionTime),Ne=b({pageNum:1,pageSize:10,courseName:void 0,courseType:void 0,creditsRange:void 0}),xe=b({pageNum:1,pageSize:10});function Ve(){l.value=!0,p(Ne.value).then(e=>{if(e&&200===e.code&&e.data){const a=(e.data.rows||[]).map(e=>n(r({},e),{courseName:e.courseName||e.course_name,courseCode:e.courseCode||e.course_code,teacherName:e.teacherName||e.teacher_name,maxStudents:e.capacity||e.maxStudents,courseTime:e.class_time||e.classTime||e.courseTime,selectionStatus:void 0!==e.status?e.status:e.selectionStatus,location:e.location||e.classLocation,selectedCount:void 0!==e.selected_count?e.selected_count:e.selectedCount||0,courseType:void 0!==e.course_type?0===e.course_type?"必修":1===e.course_type?"选修":e.course_type:void 0!==e.courseType?0===e.courseType?"必修":1===e.courseType?"选修":e.courseType:"未知",credits:e.credits||e.credit||0,description:e.course_description||e.description||"",assessmentMethod:e.assessmentMethod||e.assessment_method||"笔试+平时考核"}));i.value=a,s.value=parseInt(e.data.total||0),0===i.value.length&&Ne.value.pageNum>1&&(Ne.value.pageNum=1,Ve())}else L.warning("获取可选课程失败: "+(e?e.msg:"未知错误")),i.value=[],s.value=0;l.value=!1}).catch(e=>{console.error("获取可选课程失败:",e),L.error("获取可选课程失败: "+(e.message||"服务器错误")),i.value=[],s.value=0,l.value=!1})}function ke(){t.value=!0,m(xe.value).then(e=>{if(e&&200===e.code&&e.data){const a=(e.data.rows||[]).map(e=>n(r({},e),{courseName:e.courseName||e.course_name,courseCode:e.courseCode||e.course_code,teacherName:e.teacherName||e.teacher_name,courseTime:e.classTime||e.class_time||e.courseTime,selectionStatus:void 0!==e.status?e.status:e.selectionStatus||0,location:e.location||e.classLocation,selectedCount:void 0!==e.selected_count?e.selected_count:e.selectedCount||0,courseType:"number"==typeof e.courseType?0===e.courseType?"必修":1===e.courseType?"选修":e.courseType:"number"==typeof e.course_type?0===e.course_type?"必修":1===e.course_type?"选修":e.course_type:e.courseType||e.course_type||"未知",credits:e.credits||e.credit||0,assessmentMethod:e.assessmentMethod||e.assessment_method||"笔试+平时考核"}));me.value=a,u.value=parseInt(e.data.total||0),function(){const e=me.value.filter(e=>2!==e.selectionStatus);Ce.value.selectedCount=e.length,Ce.value.selectedCredits=e.reduce((e,a)=>e+(a.credits||0),0)}()}else L.warning("获取已选课程失败: "+(e?e.msg:"未知错误")),me.value=[],u.value=0;t.value=!1}).catch(e=>{console.error("获取已选课程失败:",e),L.error("获取已选课程失败: "+(e.message||"服务器错误")),me.value=[],u.value=0,t.value=!1})}function je(){Ne.value.pageNum=1,Ve()}function Ue(){Ne.value={pageNum:1,pageSize:10,courseName:void 0,courseType:void 0,creditsRange:void 0},je()}function Oe(e){(function(e){return c(this,null,function*(){try{if(!me.value||0===me.value.length)return!1;const l=me.value.filter(e=>2!==e.selectionStatus);if(0===l.length)return!1;const t=e.courseTime||e.class_time;if(!t)return!1;for(const o of l)try{const a=o.courseTime||o.class_time;if(!a)continue;const l=yield h({courseTime1:a,courseTime2:t});if(l&&200===l.code&&!0===l.data)return we.value=n(r({},e),{courseName:e.courseName||e.course_name,courseTime:t}),_e.value=n(r({},o),{courseName:o.courseName||o.course_name,courseTime:a}),fe.value=!0,!0}catch(a){console.error("检查时间冲突失败:",a),L.error("检查课程时间冲突失败: "+(a.message||"系统异常，请联系管理员"))}return!1}catch(a){return console.error("处理课程冲突检查失败:",a),L.error("检查课程冲突失败: "+(a.message||"系统异常，请联系管理员")),!1}})})(e).then(a=>{a||(Me()?L.warning("已达到选课数量或学分上限，无法继续选课"):Se.value?(be.value=e,ge.value=!0):L.warning("当前不在选课时间范围内，无法进行选课操作"))}).catch(e=>{console.error("处理选课操作失败:",e),L.error("处理选课操作失败，请重试")})}function Pe(){be.value&&f(be.value.id).then(e=>{L.success("选课成功"),ge.value=!1,Ve(),"selected"===ve.value&&ke()}).catch(e=>{L.error(e.message||"选课失败，请重试")})}function ze(){if(!ye.value)return;const e=ye.value.course_offering_id||ye.value.courseOfferingId;g(e).then(e=>{L.success("退选成功"),he.value=!1,ke()}).catch(e=>{L.error(e.message||"退选失败，请重试")})}function Me(){const e=me.value.filter(e=>2!==e.selectionStatus);if(e.length>=Ce.value.maxCourses)return!0;return e.reduce((e,a)=>e+(a.credits||0),0)>=Ce.value.maxCredits}function Ie(e){return 0===e.selectionStatus||1===e.selectionStatus}function Re(){"available"===ve.value?Ve():"selected"===ve.value&&ke()}return T(()=>c(this,null,function*(){try{yield void v().then(e=>{if(e&&200===e.code&&e.data){const a=e.data;Ce.value.maxCourses=a.maxCourses||10,Ce.value.maxCredits=a.maxCredits||30,Ce.value.startTime=a.startTime||"暂未设置",Ce.value.endTime=a.endTime||"暂未设置",Ce.value.isSelectionTime=void 0===a.isSelectionTime||a.isSelectionTime,Ce.value.currentSemester=a.currentSemester||"当前学期"}else L.warning("获取选课设置失败: "+(e?e.msg:"未知错误"))}).catch(e=>{console.error("获取选课设置失败:",e),L.error("获取选课设置失败: "+(e.message||"服务器错误"))}),Promise.all([Ve(),ke()]).catch(e=>{console.error("初始化数据加载失败:",e),L.error("数据加载失败，请刷新页面重试")})}catch(e){console.error("初始化选课设置失败:",e),L.error("初始化选课设置失败，某些功能可能不可用")}})),(e,a)=>{const r=E,n=F,c=G,d=H,p=Q,m=q,v=_,f=B,g=D,h=J,b=W,y=w,T=X,Le=Y,Ke=Z,Ae=K,Ee=A,Fe=$;return V(),C("div",ee,[S(Ae,{class:"box-card"},{header:N(()=>a[15]||(a[15]=[k("div",{class:"card-header"},[k("span",null,"在线选课")],-1)])),default:N(()=>[a[63]||(a[63]=x()),S(Ke,{modelValue:ve.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ve.value=e),onTabClick:Re},{default:N(()=>[S(T,{label:"可选课程",name:"available"},{default:N(()=>[j(S(m,{model:Ne.value,ref:"queryForm",inline:!0},{default:N(()=>[S(n,{label:"课程名称",prop:"courseName"},{default:N(()=>[S(r,{modelValue:Ne.value.courseName,"onUpdate:modelValue":a[0]||(a[0]=e=>Ne.value.courseName=e),placeholder:"请输入课程名称",clearable:"",onKeyup:O(je,["enter"])},null,8,["modelValue"])]),_:1}),a[23]||(a[23]=x()),S(n,{label:"课程类型",prop:"courseType"},{default:N(()=>[S(d,{modelValue:Ne.value.courseType,"onUpdate:modelValue":a[1]||(a[1]=e=>Ne.value.courseType=e),placeholder:"请选择课程类型",clearable:""},{default:N(()=>[(V(!0),C(P,null,z(Te.value,e=>(V(),I(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[24]||(a[24]=x()),S(n,{label:"学分",prop:"creditsRange"},{default:N(()=>[S(d,{modelValue:Ne.value.creditsRange,"onUpdate:modelValue":a[2]||(a[2]=e=>Ne.value.creditsRange=e),placeholder:"请选择学分范围",clearable:""},{default:N(()=>[S(c,{label:"1学分",value:"1"}),a[16]||(a[16]=x()),S(c,{label:"2学分",value:"2"}),a[17]||(a[17]=x()),S(c,{label:"3学分",value:"3"}),a[18]||(a[18]=x()),S(c,{label:"4学分",value:"4"}),a[19]||(a[19]=x()),S(c,{label:"5学分及以上",value:"5+"})]),_:1},8,["modelValue"])]),_:1}),a[25]||(a[25]=x()),S(n,null,{default:N(()=>[S(p,{type:"primary",icon:"Search",onClick:je},{default:N(()=>a[20]||(a[20]=[x("搜索")])),_:1}),a[22]||(a[22]=x()),S(p,{icon:"Refresh",onClick:Ue},{default:N(()=>a[21]||(a[21]=[x("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[U,o.value]]),a[47]||(a[47]=x()),S(f,{gutter:10,class:"mb8"},{default:N(()=>[S(v,{showSearch:o.value,"onUpdate:showSearch":a[3]||(a[3]=e=>o.value=e),onQueryTable:Ve},null,8,["showSearch"])]),_:1}),a[48]||(a[48]=x()),S(g,{title:"选课提示",type:"info",closable:!1,"show-icon":""},{default:N(()=>[k("div",ae,[k("p",null,[a[26]||(a[26]=x("1. 当前已选 ")),k("strong",le,M(Ce.value.selectedCount),1),a[27]||(a[27]=x(" 门课程，共 ")),k("strong",te,M(Ce.value.selectedCredits),1),a[28]||(a[28]=x(" 学分"))]),a[32]||(a[32]=x()),k("p",null,[a[29]||(a[29]=x("2. 本学期最多可选 ")),k("strong",null,M(Ce.value.maxCourses),1),a[30]||(a[30]=x(" 门课程，最多可选 ")),k("strong",null,M(Ce.value.maxCredits),1),a[31]||(a[31]=x(" 学分"))]),a[33]||(a[33]=x()),k("p",null,"3. 选课时间："+M(Ce.value.startTime)+" 至 "+M(Ce.value.endTime),1)])]),_:1}),a[49]||(a[49]=x()),j((V(),I(b,{data:i.value,style:{"margin-top":"15px"}},{default:N(()=>[S(h,{type:"expand"},{default:N(e=>[S(m,{"label-position":"left",inline:"",class:"course-detail-table"},{default:N(()=>[S(n,{label:"课程简介"},{default:N(()=>[k("span",null,M(e.row.description||"暂无课程简介"),1)]),_:2},1024),a[34]||(a[34]=x()),S(n,{label:"考核方式"},{default:N(()=>[k("span",null,M(e.row.assessmentMethod||"暂无考核方式信息"),1)]),_:2},1024)]),_:2},1024)]),_:1}),a[36]||(a[36]=x()),S(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120","show-overflow-tooltip":!0}),a[37]||(a[37]=x()),S(h,{label:"课程编码",align:"center",prop:"courseCode",width:"120"}),a[38]||(a[38]=x()),S(h,{label:"课程类型",align:"center",prop:"courseType",width:"100"}),a[39]||(a[39]=x()),S(h,{label:"学分",align:"center",prop:"credits",width:"80"}),a[40]||(a[40]=x()),S(h,{label:"授课教师",align:"center",prop:"teacherName",width:"100"}),a[41]||(a[41]=x()),S(h,{label:"上课地点",align:"center",prop:"location",width:"120","show-overflow-tooltip":!0}),a[42]||(a[42]=x()),S(h,{label:"上课时间",align:"center",prop:"courseTime","min-width":"120","show-overflow-tooltip":!0}),a[43]||(a[43]=x()),S(h,{label:"限选人数",align:"center",prop:"maxStudents",width:"90"}),a[44]||(a[44]=x()),S(h,{label:"已选人数",align:"center",width:"90"},{default:N(e=>[x(M(e.row.selected_count||e.row.selectedCount||0),1)]),_:1}),a[45]||(a[45]=x()),S(h,{label:"考核方式",align:"center",width:"120","show-overflow-tooltip":!0},{default:N(e=>[x(M(e.row.assessmentMethod||e.row.assessment_method||"笔试+平时考核"),1)]),_:1}),a[46]||(a[46]=x()),S(h,{label:"操作",align:"center",width:"120","class-name":"small-padding fixed-width"},{default:N(e=>[S(p,{type:"primary",disabled:!Se.value||Me()||e.row.selected_count>=e.row.capacity,onClick:a=>Oe(e.row)},{default:N(()=>a[35]||(a[35]=[x("选课")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[Fe,l.value]]),a[50]||(a[50]=x()),j(S(y,{total:s.value,page:Ne.value.pageNum,"onUpdate:page":a[4]||(a[4]=e=>Ne.value.pageNum=e),limit:Ne.value.pageSize,"onUpdate:limit":a[5]||(a[5]=e=>Ne.value.pageSize=e),onPagination:Ve},null,8,["total","page","limit"]),[[U,s.value>0]])]),_:1}),a[62]||(a[62]=x()),S(T,{label:"已选课程",name:"selected"},{default:N(()=>[j((V(),I(b,{data:me.value},{default:N(()=>[S(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120","show-overflow-tooltip":!0}),a[52]||(a[52]=x()),S(h,{label:"课程编码",align:"center",prop:"courseCode",width:"120"}),a[53]||(a[53]=x()),S(h,{label:"课程类型",align:"center",prop:"courseType",width:"100"}),a[54]||(a[54]=x()),S(h,{label:"学分",align:"center",prop:"credits",width:"80"}),a[55]||(a[55]=x()),S(h,{label:"授课教师",align:"center",prop:"teacherName",width:"100"}),a[56]||(a[56]=x()),S(h,{label:"上课地点",align:"center",prop:"location",width:"120","show-overflow-tooltip":!0}),a[57]||(a[57]=x()),S(h,{label:"上课时间",align:"center",prop:"courseTime","min-width":"120","show-overflow-tooltip":!0}),a[58]||(a[58]=x()),S(h,{label:"考核方式",align:"center",width:"120","show-overflow-tooltip":!0},{default:N(e=>[x(M(e.row.assessmentMethod||e.row.assessment_method||"笔试+平时考核"),1)]),_:1}),a[59]||(a[59]=x()),S(h,{label:"选课状态",align:"center",prop:"selectionStatus",width:"100"},{default:N(e=>[S(Le,{type:0===e.row.selectionStatus?"warning":1===e.row.selectionStatus?"success":"info"},{default:N(()=>[x(M(0===e.row.selectionStatus?"待审核":1===e.row.selectionStatus?"已确认":"已退选"),1)]),_:2},1032,["type"])]),_:1}),a[60]||(a[60]=x()),S(h,{label:"操作",align:"center",width:"180","class-name":"small-padding fixed-width"},{default:N(e=>[S(p,{type:"danger",disabled:!Ie(e.row)||!Se.value,onClick:a=>{var l;Ie(l=e.row)?Se.value?(ye.value=l,he.value=!0):L.warning("当前不在选课时间范围内，无法进行退选操作"):L.warning("该课程状态不允许退选")}},{default:N(()=>a[51]||(a[51]=[x("退选")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[Fe,t.value]]),a[61]||(a[61]=x()),j(S(y,{total:u.value,page:xe.value.pageNum,"onUpdate:page":a[6]||(a[6]=e=>xe.value.pageNum=e),limit:xe.value.pageSize,"onUpdate:limit":a[7]||(a[7]=e=>xe.value.pageSize=e),onPagination:ke},null,8,["total","page","limit"]),[[U,u.value>0]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[101]||(a[101]=x()),S(Ee,{title:"选课冲突提示",modelValue:fe.value,"onUpdate:modelValue":a[10]||(a[10]=e=>fe.value=e),width:"500px"},{footer:N(()=>[k("div",ue,[S(p,{type:"primary",onClick:a[9]||(a[9]=e=>fe.value=!1)},{default:N(()=>a[70]||(a[70]=[x("我知道了")])),_:1})])]),default:N(()=>[k("div",oe,[S(g,{title:"选课冲突",type:"error",description:"以下课程与您已选课程存在时间冲突，无法选择：",closable:!1,"show-icon":""}),a[69]||(a[69]=x()),we.value?(V(),C("div",se,[k("p",null,[a[64]||(a[64]=k("strong",null,"冲突课程：",-1)),x(M(we.value.courseName||we.value.course_name),1)]),a[67]||(a[67]=x()),k("p",null,[a[65]||(a[65]=k("strong",null,"上课时间：",-1)),x(M(we.value.courseTime||we.value.class_time),1)]),a[68]||(a[68]=x()),k("p",null,[a[66]||(a[66]=k("strong",null,"冲突原因：",-1)),x("与已选课程《"+M(_e.value.courseName||_e.value.course_name)+"》在时间上存在冲突",1)])])):R("",!0)]),a[71]||(a[71]=x())]),_:1},8,["modelValue"]),a[102]||(a[102]=x()),S(Ee,{title:"选课确认",modelValue:ge.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ge.value=e),width:"500px"},{footer:N(()=>[k("div",ce,[S(p,{onClick:a[11]||(a[11]=e=>ge.value=!1)},{default:N(()=>a[85]||(a[85]=[x("取消")])),_:1}),a[87]||(a[87]=x()),S(p,{type:"primary",onClick:Pe},{default:N(()=>a[86]||(a[86]=[x("确认选课")])),_:1})])]),default:N(()=>[k("div",re,[a[83]||(a[83]=k("p",null,"您确定要选择以下课程吗？",-1)),a[84]||(a[84]=x()),be.value?(V(),C("div",ne,[k("p",null,[a[72]||(a[72]=k("strong",null,"课程名称：",-1)),x(M(be.value.courseName),1)]),a[78]||(a[78]=x()),k("p",null,[a[73]||(a[73]=k("strong",null,"课程编码：",-1)),x(M(be.value.courseCode),1)]),a[79]||(a[79]=x()),k("p",null,[a[74]||(a[74]=k("strong",null,"学分：",-1)),x(M(be.value.credits),1)]),a[80]||(a[80]=x()),k("p",null,[a[75]||(a[75]=k("strong",null,"上课时间：",-1)),x(M(be.value.courseTime),1)]),a[81]||(a[81]=x()),k("p",null,[a[76]||(a[76]=k("strong",null,"上课地点：",-1)),x(M(be.value.location),1)]),a[82]||(a[82]=x()),k("p",null,[a[77]||(a[77]=k("strong",null,"授课教师：",-1)),x(M(be.value.teacherName),1)])])):R("",!0)]),a[88]||(a[88]=x())]),_:1},8,["modelValue"]),a[103]||(a[103]=x()),S(Ee,{title:"退选确认",modelValue:he.value,"onUpdate:modelValue":a[14]||(a[14]=e=>he.value=e),width:"500px"},{footer:N(()=>[k("div",pe,[S(p,{onClick:a[13]||(a[13]=e=>he.value=!1)},{default:N(()=>a[97]||(a[97]=[x("取消")])),_:1}),a[99]||(a[99]=x()),S(p,{type:"danger",onClick:ze},{default:N(()=>a[98]||(a[98]=[x("确认退选")])),_:1})])]),default:N(()=>[k("div",ie,[S(g,{title:"退选提醒",type:"warning",description:"退选后如果再次选择该课程，将重新进入审核状态，且可能因课程已满而无法选择。",closable:!1,"show-icon":""}),a[96]||(a[96]=x()),ye.value?(V(),C("div",de,[k("p",null,[a[89]||(a[89]=k("strong",null,"课程名称：",-1)),x(M(ye.value.courseName),1)]),a[93]||(a[93]=x()),k("p",null,[a[90]||(a[90]=k("strong",null,"课程编码：",-1)),x(M(ye.value.courseCode),1)]),a[94]||(a[94]=x()),k("p",null,[a[91]||(a[91]=k("strong",null,"学分：",-1)),x(M(ye.value.credits),1)]),a[95]||(a[95]=x()),k("p",null,[a[92]||(a[92]=k("strong",null,"上课时间：",-1)),x(M(ye.value.courseTime),1)])])):R("",!0)]),a[100]||(a[100]=x())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-8d2d5dc6"]]);export{me as default};
