var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{s as u,_ as d,d as c,e as n}from"./index-c00447c9.js";import{X as i,r as p,k as m,z as f,P as h,H as g,L as b,ay as y,y as _,u as v,A as w,I as V,G as I,M as N,O as k,a4 as O}from"./vue-core-ad22061d.js";import{M as C,R as j,B as U,m as z}from"./icons-3f8828dd.js";import{u as x,H as q,E as T,a as P,w as S,x as A,b as D,F as M,G as B,J as E,K as F,L as G,M as H,A as L,B as R,y as J,z as K,C as X,O as $}from"./element-plus-7067fc91.js";import"./utils-ebe9136b.js";const Q={class:"course-offering-container"},W={class:"card-header"},Y={class:"header-buttons"},Z={class:"pagination-container"},ee={class:"form-buttons"},ae=d({__name:"index",setup(e){const d=i({courseName:"",teacherName:"",semester:"",pageNum:1,pageSize:10}),ae=p([]),le=p(0),te=p(!1),re=p([]),oe=p([]),se=i({visible:!1,title:"新增课程开设",type:"add"}),ue=i({id:null,courseId:null,teacherId:null,semester:"",classTime:"",location:"",capacity:30,status:0}),de={courseId:[{required:!0,message:"请选择课程",trigger:"change"}],teacherId:[{required:!0,message:"请选择教师",trigger:"change"}],semester:[{required:!0,message:"请输入学期",trigger:"blur"}],classTime:[{required:!0,message:"请输入上课时间",trigger:"blur"}],location:[{required:!0,message:"请输入上课地点",trigger:"blur"}],capacity:[{required:!0,message:"请输入容量",trigger:"blur"}]},ce=p(null),ne=y();function ie(){var e;te.value=!0,(e=d,console.log("查询课程开设列表，参数:",e),u({url:"/courseOffering/list",method:"get",params:e}).catch(e=>{throw console.error("查询课程开设列表失败:",e),e})).then(e=>{ae.value=e.data.list,le.value=e.data.total}).finally(()=>te.value=!1)}function pe(){d.pageNum=1,ie()}function me(){d.courseName="",d.teacherName="",d.semester="",pe()}function fe(e){d.pageSize=e,ie()}function he(e){d.pageNum=e,ie()}function ge(e,a){se.type=e,se.title="add"===e?"新增课程开设":"编辑课程开设",se.visible=!0,"edit"===e&&a?Object.assign(ue,a):Object.assign(ue,{id:null,courseId:null,teacherId:null,semester:"",classTime:"",location:"",capacity:30,status:0})}function be(){console.log("提交表单数据:",ue),ce.value.validate(e=>{if(!e)return void console.error("表单验证失败");const d=(c=((e,a)=>{for(var l in a||(a={}))r.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&s(e,l,a[l]);return e})({},ue),n={courseId:Number(ue.courseId),teacherId:Number(ue.teacherId),capacity:Number(ue.capacity),status:Number(ue.status)},a(c,l(n)));var c,n,i;console.log("处理后的提交数据:",d),"add"===se.type?(i=d,console.log("新增课程开设请求数据:",i),u({url:"/courseOffering",method:"post",data:i}).catch(e=>{throw console.error("新增课程开设失败:",e),e})).then(e=>{console.log("新增课程开设成功:",e),T.success("新增成功"),se.visible=!1,ie()}).catch(e=>{console.error("新增课程开设失败:",e),T.error(e.message||"新增失败，请检查表单数据")}):function(e){return console.log("修改课程开设请求数据:",e),u({url:"/courseOffering",method:"put",data:e}).catch(e=>{throw console.error("修改课程开设失败:",e),e})}(d).then(e=>{console.log("修改课程开设成功:",e),T.success("修改成功"),se.visible=!1,ie()}).catch(e=>{console.error("修改课程开设失败:",e),T.error(e.message||"修改失败，请检查表单数据")})})}function ye(e){P.confirm("确定要删除该课程开设记录吗？","提示",{type:"warning"}).then(()=>{var a;(a=e.id,console.log("删除课程开设，ID:",a),u({url:`/courseOffering/${a}`,method:"delete"}).catch(e=>{throw console.error("删除课程开设失败:",e),e})).then(()=>{T.success("删除成功"),ie()})})}return m(()=>{ie(),c().then(e=>{200===e.code&&e.data&&e.data.list?re.value=e.data.list.map(e=>({id:e.id,name:e.name})):(re.value=[],console.error("获取课程列表失败:",e))}).catch(e=>{console.error("获取课程列表异常:",e),re.value=[]}),n().then(e=>{200===e.code&&e.data&&e.data.list?oe.value=e.data.list.map(e=>({id:e.id,name:e.name||(e.user?e.user.name:"未知教师")})):(oe.value=[],console.error("获取教师列表失败:",e))}).catch(e=>{console.error("获取教师列表异常:",e),oe.value=[]})}),(e,a)=>{const l=S,t=A,r=D,o=M,s=B,u=x,c=E,n=F,i=G,p=H,m=L,y=R,P=J,ie=K,_e=X,ve=q,we=$;return _(),f("div",Q,[h(u,{class:"search-card",shadow:"hover"},{default:g(()=>[h(s,{model:d,ref:"queryForm",inline:!0},{default:g(()=>[h(t,{label:"课程名称",prop:"courseName"},{default:g(()=>[h(l,{modelValue:d.courseName,"onUpdate:modelValue":a[0]||(a[0]=e=>d.courseName=e),placeholder:"请输入课程名称",clearable:""},null,8,["modelValue"])]),_:1}),a[18]||(a[18]=b()),h(t,{label:"教师名称",prop:"teacherName"},{default:g(()=>[h(l,{modelValue:d.teacherName,"onUpdate:modelValue":a[1]||(a[1]=e=>d.teacherName=e),placeholder:"请输入教师名称",clearable:""},null,8,["modelValue"])]),_:1}),a[19]||(a[19]=b()),h(t,{label:"学期",prop:"semester"},{default:g(()=>[h(l,{modelValue:d.semester,"onUpdate:modelValue":a[2]||(a[2]=e=>d.semester=e),placeholder:"请输入学期",clearable:""},null,8,["modelValue"])]),_:1}),a[20]||(a[20]=b()),h(t,null,{default:g(()=>[h(o,{type:"primary",onClick:pe},{default:g(()=>[h(r,null,{default:g(()=>[h(v(C))]),_:1}),a[15]||(a[15]=b("查询\n          "))]),_:1}),a[17]||(a[17]=b()),h(o,{onClick:me},{default:g(()=>[h(r,null,{default:g(()=>[h(v(j))]),_:1}),a[16]||(a[16]=b("重置\n          "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a[51]||(a[51]=b()),h(u,{class:"table-card",shadow:"hover"},{header:g(()=>[w("div",W,[a[22]||(a[22]=w("span",{class:"header-title"},"课程开设记录",-1)),a[23]||(a[23]=b()),w("div",Y,[h(o,{type:"primary",onClick:a[3]||(a[3]=e=>ge("add"))},{default:g(()=>[h(r,null,{default:g(()=>[h(v(U))]),_:1}),a[21]||(a[21]=b("新增\n            "))]),_:1})])])]),default:g(()=>[a[38]||(a[38]=b()),V((_(),I(i,{data:ae.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:g(()=>[h(c,{type:"index",label:"#",width:"60"}),a[29]||(a[29]=b()),h(c,{prop:"courseName",label:"课程名称",width:"160"}),a[30]||(a[30]=b()),h(c,{prop:"teacherName",label:"教师名称",width:"120"}),a[31]||(a[31]=b()),h(c,{prop:"semester",label:"学期",width:"120"}),a[32]||(a[32]=b()),h(c,{prop:"classTime",label:"上课时间",width:"120"}),a[33]||(a[33]=b()),h(c,{prop:"location",label:"上课地点",width:"120"}),a[34]||(a[34]=b()),h(c,{prop:"capacity",label:"容量",width:"80",align:"center"}),a[35]||(a[35]=b()),h(c,{prop:"selectedCount",label:"已选人数",width:"100",align:"center"}),a[36]||(a[36]=b()),h(c,{label:"状态",width:"100",align:"center"},{default:g(e=>[h(n,{type:0===e.row.status?"success":"info"},{default:g(()=>[b(N(0===e.row.status?"正常":"已结课"),1)]),_:2},1032,["type"])]),_:1}),a[37]||(a[37]=b()),h(c,{label:"操作","min-width":"220",fixed:"right"},{default:g(e=>[h(o,{type:"primary",link:"",onClick:a=>ge("edit",e.row)},{default:g(()=>a[24]||(a[24]=[b("编辑")])),_:2},1032,["onClick"]),a[27]||(a[27]=b()),h(o,{type:"success",link:"",onClick:a=>function(e){console.log("跳转到考勤记录页面，参数:",{courseId:e.courseId,courseOfferingId:e.id,row:e});try{T.info("正在跳转到考勤记录页面..."),ne.push({path:"/attendance-record",query:{courseId:e.courseId,courseOfferingId:e.id}}).catch(a=>{console.error("路由跳转失败，尝试备用方案:",a),ne.push("/").then(()=>{setTimeout(()=>{ne.push({path:"/attendance-record",query:{courseId:e.courseId,courseOfferingId:e.id,_t:(new Date).getTime()}})},300)})})}catch(a){console.error("考勤管理跳转错误:",a),T.error("页面跳转发生错误，请联系管理员")}}(e.row)},{default:g(()=>[h(r,null,{default:g(()=>[h(v(z))]),_:1}),a[25]||(a[25]=b("考勤管理\n            "))]),_:2},1032,["onClick"]),a[28]||(a[28]=b()),h(o,{type:"danger",link:"",onClick:a=>ye(e.row)},{default:g(()=>a[26]||(a[26]=[b("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[we,te.value]]),a[39]||(a[39]=b()),w("div",Z,[h(p,{"current-page":d.pageNum,"onUpdate:currentPage":a[4]||(a[4]=e=>d.pageNum=e),"page-size":d.pageSize,"onUpdate:pageSize":a[5]||(a[5]=e=>d.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:le.value,onSizeChange:fe,onCurrentChange:he},null,8,["current-page","page-size","total"])])]),_:1}),a[52]||(a[52]=b()),h(ve,{title:se.title,modelValue:se.visible,"onUpdate:modelValue":a[14]||(a[14]=e=>se.visible=e),width:"600px","append-to-body":"","destroy-on-close":""},{default:g(()=>[h(s,{ref_key:"formRef",ref:ce,model:ue,rules:de,"label-width":"100px"},{default:g(()=>[h(_e,{gutter:24},{default:g(()=>[h(P,{span:12},{default:g(()=>[h(t,{label:"课程",prop:"courseId"},{default:g(()=>[h(y,{modelValue:ue.courseId,"onUpdate:modelValue":a[6]||(a[6]=e=>ue.courseId=e),placeholder:"请选择课程",filterable:""},{default:g(()=>[(_(!0),f(k,null,O(re.value,e=>(_(),I(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a[41]||(a[41]=b()),h(P,{span:12},{default:g(()=>[h(t,{label:"教师",prop:"teacherId"},{default:g(()=>[h(y,{modelValue:ue.teacherId,"onUpdate:modelValue":a[7]||(a[7]=e=>ue.teacherId=e),placeholder:"请选择教师",filterable:""},{default:g(()=>[(_(!0),f(k,null,O(oe.value,e=>(_(),I(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a[42]||(a[42]=b()),h(P,{span:12},{default:g(()=>[h(t,{label:"学期",prop:"semester"},{default:g(()=>[h(l,{modelValue:ue.semester,"onUpdate:modelValue":a[8]||(a[8]=e=>ue.semester=e),placeholder:"如 2023-2024-1"},null,8,["modelValue"])]),_:1})]),_:1}),a[43]||(a[43]=b()),h(P,{span:12},{default:g(()=>[h(t,{label:"上课时间",prop:"classTime"},{default:g(()=>[h(l,{modelValue:ue.classTime,"onUpdate:modelValue":a[9]||(a[9]=e=>ue.classTime=e),placeholder:"如 周一 1-2节"},null,8,["modelValue"])]),_:1})]),_:1}),a[44]||(a[44]=b()),h(P,{span:12},{default:g(()=>[h(t,{label:"上课地点",prop:"location"},{default:g(()=>[h(l,{modelValue:ue.location,"onUpdate:modelValue":a[10]||(a[10]=e=>ue.location=e),placeholder:"如 教学楼A-101"},null,8,["modelValue"])]),_:1})]),_:1}),a[45]||(a[45]=b()),h(P,{span:12},{default:g(()=>[h(t,{label:"容量",prop:"capacity"},{default:g(()=>[h(ie,{modelValue:ue.capacity,"onUpdate:modelValue":a[11]||(a[11]=e=>ue.capacity=e),min:1,max:200,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a[46]||(a[46]=b()),h(P,{span:12},{default:g(()=>[h(t,{label:"状态",prop:"status"},{default:g(()=>[h(y,{modelValue:ue.status,"onUpdate:modelValue":a[12]||(a[12]=e=>ue.status=e),placeholder:"请选择状态"},{default:g(()=>[h(m,{label:"正常",value:0}),a[40]||(a[40]=b()),h(m,{label:"已结课",value:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a[50]||(a[50]=b()),w("div",ee,[h(o,{onClick:a[13]||(a[13]=e=>se.visible=!1)},{default:g(()=>a[47]||(a[47]=[b("取消")])),_:1}),a[49]||(a[49]=b()),h(o,{type:"primary",onClick:be},{default:g(()=>a[48]||(a[48]=[b("确定")])),_:1})])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},[["__scopeId","data-v-6a1f6c34"]]);export{ae as default};
