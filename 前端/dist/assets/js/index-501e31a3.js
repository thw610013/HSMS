var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(e,t,l)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;import{_ as u,u as n}from"./index-22381d63.js";import{_ as i}from"./index-50714a02.js";import{_ as d}from"./index-473e483c.js";import{r as c,f as v,m as p,E as m,z as f,n as b,ab as h,l as g,q as w,D as _,A as y,G as D,X as j,F as k,W as O,y as x}from"./vue-core-9ee4ed8b.js";import{g as L,e as N}from"./attendance-868b1362.js";import{E as C}from"./utils-e59f4bae.js";import{a9 as S,Q as z,ab as U,ac as V,av as E,ag as P,aj as R,ak as I,ad as F,ah as Y,an as A,ao as W,ap as q,as as M,af as Q}from"./element-plus-e2333c73.js";import"./icons-c547ea56.js";const T={class:"app-container"},B={class:"statistic-number"},G={class:"statistic-number"},K={class:"statistic-number"},X={class:"statistic-number"},$={class:"statistic-number"},H={class:"statistic-number"},J={class:"chart-content"},Z=u({__name:"index",setup(a){const u=n();c(u.userId);const Z=c(u.userId),aa=c(null);let ea=null;const ta=c([]),la=c(!1),sa=c(!0),ra=c(0),oa=c({total:0,normal:0,absent:0,late:0,earlyLeave:0,leave:0}),ua=c([{value:0,label:"出勤"},{value:1,label:"缺勤"},{value:2,label:"迟到"},{value:3,label:"早退"},{value:4,label:"请假"}]),na=c([]),ia=c({pageNum:1,pageSize:10,courseName:void 0,startDate:void 0,endDate:void 0,status:void 0});function da(){la.value=!0,na.value&&na.value.length>0?(ia.value.startDate=na.value[0],ia.value.endDate=na.value[1]):(ia.value.startDate=void 0,ia.value.endDate=void 0),L(Z.value,ia.value).then((a=>{ta.value=a.data.records,ra.value=parseInt(a.data.total),oa.value={total:ta.value.length,normal:0,absent:0,late:0,earlyLeave:0,leave:0},ta.value.forEach((a=>{switch(a.status){case 0:oa.value.normal++;break;case 1:oa.value.absent++;break;case 2:oa.value.late++;break;case 3:oa.value.earlyLeave++;break;case 4:oa.value.leave++}})),b((()=>{!function(){if(!aa.value)return;ea&&ea.dispose();ea=C(aa.value);const a={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"bottom",data:["出勤","缺勤","迟到","早退","请假"]},series:[{name:"考勤状态",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:oa.value.normal,name:"出勤"},{value:oa.value.absent,name:"缺勤"},{value:oa.value.late,name:"迟到"},{value:oa.value.earlyLeave,name:"早退"},{value:oa.value.leave,name:"请假"}],color:["#67C23A","#F56C6C","#E6A23C","#909399","#409EFF"]}]};ea.setOption(a),window.addEventListener("resize",(()=>{ea&&ea.resize()}))}()})),la.value=!1})).catch((()=>{la.value=!1}))}function ca(){na.value=[],ia.value={pageNum:1,pageSize:10,courseName:void 0,startDate:void 0,endDate:void 0,status:void 0},va()}function va(){ia.value.pageNum=1,da()}function pa(){const a=(u=((a,e)=>{for(var t in e||(e={}))s.call(e,t)&&o(a,t,e[t]);if(l)for(var t of l(e))r.call(e,t)&&o(a,t,e[t]);return a})({},ia.value),n={studentId:Z.value,export:!0},e(u,t(n)));var u,n;na.value&&na.value.length>0&&(a.startDate=na.value[0],a.endDate=na.value[1]),N(a).then((a=>{const e=new Blob([a.data]),t=`我的考勤记录_${(new Date).getTime()}.xlsx`,l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=t,l.click(),URL.revokeObjectURL(l.href)}))}return v((()=>{da()})),(a,e)=>{const t=U,l=V,s=E,r=Q,o=P,u=R,n=I,c=F,v=d,b=Y,L=S,N=A,C=W,Z=q,ea=i,ma=h("hasPerms"),fa=M;return g(),p("div",T,[m(L,{class:"box-card"},{header:f((()=>e[6]||(e[6]=[w("div",{class:"card-header"},[w("span",null,"我的考勤记录")],-1)]))),default:f((()=>[e[39]||(e[39]=_()),y(m(n,{model:ia.value,ref:"queryForm",inline:!0},{default:f((()=>[m(l,{label:"课程名称",prop:"courseName"},{default:f((()=>[m(t,{modelValue:ia.value.courseName,"onUpdate:modelValue":e[0]||(e[0]=a=>ia.value.courseName=a),placeholder:"请输入课程名称",clearable:"",onKeyup:j(va,["enter"])},null,8,["modelValue"])])),_:1}),e[10]||(e[10]=_()),m(l,{label:"考勤日期",prop:"attendanceDate"},{default:f((()=>[m(s,{modelValue:na.value,"onUpdate:modelValue":e[1]||(e[1]=a=>na.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),e[11]||(e[11]=_()),m(l,{label:"考勤状态",prop:"status"},{default:f((()=>[m(o,{modelValue:ia.value.status,"onUpdate:modelValue":e[2]||(e[2]=a=>ia.value.status=a),placeholder:"请选择考勤状态",clearable:""},{default:f((()=>[(g(!0),p(k,null,O(ua.value,(a=>(g(),x(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),e[12]||(e[12]=_()),m(l,null,{default:f((()=>[m(u,{type:"primary",icon:"Search",onClick:va},{default:f((()=>e[7]||(e[7]=[_("搜索")]))),_:1}),e[9]||(e[9]=_()),m(u,{icon:"Refresh",onClick:ca},{default:f((()=>e[8]||(e[8]=[_("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),[[D,sa.value]]),e[40]||(e[40]=_()),m(b,{gutter:10,class:"mb8"},{default:f((()=>[m(c,{span:1.5},{default:f((()=>[y((g(),x(u,{type:"warning",plain:"",icon:"Download",onClick:pa},{default:f((()=>e[13]||(e[13]=[_("导出")]))),_:1})),[[ma,["attendance:record:export"]]])])),_:1}),e[14]||(e[14]=_()),m(v,{showSearch:sa.value,"onUpdate:showSearch":e[3]||(e[3]=a=>sa.value=a),onQueryTable:da},null,8,["showSearch"])])),_:1}),e[41]||(e[41]=_()),m(b,{gutter:20,class:"mb20"},{default:f((()=>[m(c,{span:4},{default:f((()=>[m(L,{shadow:"hover",class:"statistic-card"},{default:f((()=>[e[15]||(e[15]=w("div",{class:"statistic-title"},"总考勤",-1)),e[16]||(e[16]=_()),w("div",B,z(oa.value.total),1)])),_:1})])),_:1}),e[27]||(e[27]=_()),m(c,{span:4},{default:f((()=>[m(L,{shadow:"hover",class:"statistic-card normal"},{default:f((()=>[e[17]||(e[17]=w("div",{class:"statistic-title"},"出勤",-1)),e[18]||(e[18]=_()),w("div",G,z(oa.value.normal),1)])),_:1})])),_:1}),e[28]||(e[28]=_()),m(c,{span:4},{default:f((()=>[m(L,{shadow:"hover",class:"statistic-card absent"},{default:f((()=>[e[19]||(e[19]=w("div",{class:"statistic-title"},"缺勤",-1)),e[20]||(e[20]=_()),w("div",K,z(oa.value.absent),1)])),_:1})])),_:1}),e[29]||(e[29]=_()),m(c,{span:4},{default:f((()=>[m(L,{shadow:"hover",class:"statistic-card late"},{default:f((()=>[e[21]||(e[21]=w("div",{class:"statistic-title"},"迟到",-1)),e[22]||(e[22]=_()),w("div",X,z(oa.value.late),1)])),_:1})])),_:1}),e[30]||(e[30]=_()),m(c,{span:4},{default:f((()=>[m(L,{shadow:"hover",class:"statistic-card early-leave"},{default:f((()=>[e[23]||(e[23]=w("div",{class:"statistic-title"},"早退",-1)),e[24]||(e[24]=_()),w("div",$,z(oa.value.earlyLeave),1)])),_:1})])),_:1}),e[31]||(e[31]=_()),m(c,{span:4},{default:f((()=>[m(L,{shadow:"hover",class:"statistic-card leave"},{default:f((()=>[e[25]||(e[25]=w("div",{class:"statistic-title"},"请假",-1)),e[26]||(e[26]=_()),w("div",H,z(oa.value.leave),1)])),_:1})])),_:1})])),_:1}),e[42]||(e[42]=_()),y((g(),x(Z,{data:ta.value},{default:f((()=>[m(N,{label:"课程名称",align:"center",prop:"courseName","show-overflow-tooltip":!0}),e[32]||(e[32]=_()),m(N,{label:"课程编码",align:"center",prop:"courseCode"}),e[33]||(e[33]=_()),m(N,{label:"班级",align:"center",prop:"className","show-overflow-tooltip":!0}),e[34]||(e[34]=_()),m(N,{label:"考勤日期",align:"center",prop:"attendanceDate",width:"100"}),e[35]||(e[35]=_()),m(N,{label:"考勤状态",align:"center",prop:"statusDesc",width:"80"},{default:f((a=>[m(C,{type:0===a.row.status?"success":1===a.row.status?"danger":2===a.row.status?"warning":3===a.row.status?"info":""},{default:f((()=>[_(z(a.row.statusDesc),1)])),_:2},1032,["type"])])),_:1}),e[36]||(e[36]=_()),m(N,{label:"备注",align:"center",prop:"remark","show-overflow-tooltip":!0})])),_:1},8,["data"])),[[fa,la.value]]),e[43]||(e[43]=_()),y(m(ea,{total:ra.value,page:ia.value.pageNum,"onUpdate:page":e[4]||(e[4]=a=>ia.value.pageNum=a),limit:ia.value.pageSize,"onUpdate:limit":e[5]||(e[5]=a=>ia.value.pageSize=a),onPagination:da},null,8,["total","page","limit"]),[[D,ra.value>0]]),e[44]||(e[44]=_()),m(L,{class:"chart-card",shadow:"hover",style:{"margin-top":"20px"}},{header:f((()=>e[37]||(e[37]=[w("div",{class:"chart-header"},[w("span",null,"考勤统计分析")],-1)]))),default:f((()=>[e[38]||(e[38]=_()),w("div",J,[w("div",{id:"attendanceChart",class:"chart",ref_key:"attendanceChartRef",ref:aa},null,512)])])),_:1})])),_:1})])}}},[["__scopeId","data-v-a80a5e79"]]);export{Z as default};
