var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,n=(e,n)=>{for(var o in n||(n={}))l.call(n,o)&&i(e,o,n[o]);if(a)for(var o of a(n))s.call(n,o)&&i(e,o,n[o]);return e},o=(e,a,l)=>new Promise((s,i)=>{var n=e=>{try{t(l.next(e))}catch(a){i(a)}},o=e=>{try{t(l.throw(e))}catch(a){i(a)}},t=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,o);t((l=l.apply(e,a)).next())});import{_ as t,u as d,A as r,B as u,C as c,D as m,E as f,F as v}from"./index-1c6f2b30.js";import{Z as p,_ as g,$ as b,a0 as w,a1 as _,a2 as h,a3 as y,a4 as V,i as P,a5 as k,a6 as U,a7 as x}from"./icons-02de347c.js";import{aH as j,O as I,Q as z,V as q,R as C,al as O,ak as F,ac as A,aw as E,ax as Z,U as $,aa as D,ab as Q,ai as R,aj as B,a9 as G,a2 as M,ag as W}from"./element-plus-33c96ec5.js";import{c as H,r as J,M as N,f as S,l as T,m as K,E as L,z as X,q as Y,D as ee,u as ae,C as le}from"./vue-core-d6f028e5.js";import"./utils-80dc1c42.js";const se={class:"profile-container"},ie={class:"profile-avatar"},ne={class:"profile-avatar-upload"},oe={class:"profile-name"},te={class:"profile-info"},de={class:"info-item"},re={class:"info-item"},ue={class:"info-item"},ce={class:"profile-tabs-header"},me={key:0},fe={key:1},ve={key:2,class:"profile-binding"},pe={class:"binding-list"},ge={class:"binding-item"},be={class:"binding-info"},we={class:"binding-icon wx-icon"},_e={class:"binding-item"},he={class:"binding-info"},ye={class:"binding-icon qq-icon"},Ve={class:"binding-item"},Pe={class:"binding-info"},ke={class:"binding-icon wb-icon"},Ue={key:3,class:"profile-notification"},xe={class:"notification-item"},je={class:"notification-item"},Ie={class:"notification-item"},ze={class:"notification-item"},qe={class:"notification-item"},Ce={class:"notification-action"},Oe=t({__name:"index",setup(e){const a=d(),l=H(()=>a.userInfo||{}),s=H(()=>{switch(l.value.userType){case 0:return"管理员";case 1:return"教师";case 2:return"学生";default:return"未知"}}),i=J("basic"),t=J(null),Oe=N({username:"",name:"",email:"",phone:""}),Fe={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,message:"邮箱格式不正确",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}]},Ae=J(null),Ee=N({oldPassword:"",newPassword:"",confirmPassword:""}),Ze={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==Ee.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},$e=N({system:!0,course:!0,attendance:!0,email:!1,sms:!1}),De=J(!1),Qe=J(!1),Re=H(()=>{const e=l.value.avatar||f;return e.startsWith("/src/")||e.startsWith("/assets/")?e:v(e)});S(()=>o(this,null,function*(){var e;const s=j.service({lock:!0,text:"加载用户信息...",background:"rgba(0, 0, 0, 0.7)"});try{(null==(e=l.value)?void 0:e.username)||(yield a.getInfo()),yield Be()}catch(i){I.error("获取用户信息失败，请刷新页面重试")}finally{s.close()}}));const Be=()=>o(this,null,function*(){let e=l.value.username||a.userInfo.username||"";if(!e){const l=yield function(){return o(this,null,function*(){try{const e=yield r();if(e.data)return a.userInfo=n(n({},a.userInfo),e.data),e.data}catch(e){I.error("获取用户信息失败，请刷新页面")}return null})}();l&&(e=l.username||"")}Oe.username=e,Oe.name=l.value.name||"",Oe.email=l.value.email||"",Oe.phone=l.value.phone||""}),Ge=e=>{const a="image/jpeg"===e.type,l="image/png"===e.type,s=e.size/1024/1024<2;return a||l?!!s||(I.error("上传头像图片大小不能超过 2MB!"),!1):(I.error("上传头像图片只能是 JPG 或 PNG 格式!"),!1)},Me=e=>{const l=new FormData;l.append("file",e.file);const s=j.service({lock:!0,text:"上传头像中...",background:"rgba(0, 0, 0, 0.7)"});u(l).then(e=>{if(200===e.code){const l=e.data;a.updateUserInfo({avatar:l}),I.success("头像上传成功")}else I.error(e.message||"头像上传失败")}).catch(e=>{var a,l;I.error((null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.message)||"头像上传失败")}).finally(()=>{s.close()})},We=()=>{t.value.validate(e=>{if(e){if(Oe.username||(Oe.username=a.userInfo.username),!Oe.username)return void I.error("用户名信息缺失，请刷新页面重试");const e={username:Oe.username,name:Oe.name,email:Oe.email,phone:Oe.phone};De.value=!0,c(e).then(()=>{a.updateUserInfo(e),I.success("个人信息修改成功")}).catch(e=>{var a,l;I.error("修改个人信息失败: "+((null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.message)||e.message))}).finally(()=>{De.value=!1})}})},He=()=>{var e;null==(e=t.value)||e.resetFields(),Be(),I.info("已重置为原始信息")},Je=()=>{Ae.value.validate(e=>{e&&(Qe.value=!0,m(Ee.oldPassword,Ee.newPassword).then(()=>{I.success("密码修改成功"),Ne()}).catch(e=>{var a,l;I.error("修改密码失败: "+((null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.message)||e.message))}).finally(()=>{Qe.value=!1}))})},Ne=()=>{Ee.oldPassword="",Ee.newPassword="",Ee.confirmPassword=""},Se=()=>{I.success("通知设置已保存")};return(e,a)=>{const n=q,o=C,d=O,r=F,u=A,c=E,m=Z,f=$,v=D,j=Q,I=R,H=B,J=G,N=M,S=W;return T(),K("div",se,[L(S,{gutter:20},{default:X(()=>[L(u,{xs:24,sm:8,md:6,lg:5,xl:4},{default:X(()=>[L(r,{class:"profile-card",shadow:"hover"},{default:X(()=>[Y("div",ie,[L(n,{size:100,src:Re.value},null,8,["src"]),a[13]||(a[13]=ee()),Y("div",ne,[L(d,{class:"avatar-uploader",action:"#","http-request":Me,"show-file-list":!1,"before-upload":Ge},{default:X(()=>[L(o,{class:"upload-icon"},{default:X(()=>[L(ae(p))]),_:1})]),_:1})])]),a[19]||(a[19]=ee()),Y("h2",oe,z(l.value.name),1),a[20]||(a[20]=ee()),Y("div",te,[Y("div",de,[L(o,null,{default:X(()=>[L(ae(g))]),_:1}),a[14]||(a[14]=ee()),Y("span",null,z(s.value),1)]),a[17]||(a[17]=ee()),Y("div",re,[L(o,null,{default:X(()=>[L(ae(b))]),_:1}),a[15]||(a[15]=ee()),Y("span",null,z(l.value.email||"未设置邮箱"),1)]),a[18]||(a[18]=ee()),Y("div",ue,[L(o,null,{default:X(()=>[L(ae(w))]),_:1}),a[16]||(a[16]=ee()),Y("span",null,z(l.value.phone||"未设置手机"),1)])]),a[21]||(a[21]=ee()),a[22]||(a[22]=Y("div",{class:"profile-stats"},[Y("div",{class:"stat-item"},[Y("div",{class:"stat-value"},"12"),ee(),Y("div",{class:"stat-label"},"我的课程")]),ee(),Y("div",{class:"stat-item"},[Y("div",{class:"stat-value"},"89%"),ee(),Y("div",{class:"stat-label"},"出勤率")]),ee(),Y("div",{class:"stat-item"},[Y("div",{class:"stat-value"},"28"),ee(),Y("div",{class:"stat-label"},"通知")])],-1))]),_:1})]),_:1}),a[79]||(a[79]=ee()),L(u,{xs:24,sm:16,md:18,lg:19,xl:20},{default:X(()=>[L(r,{shadow:"hover"},{header:X(()=>[Y("div",ce,[L(m,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e)},{default:X(()=>[L(c,{label:"基本资料",name:"basic"},{label:X(()=>[Y("span",null,[L(o,null,{default:X(()=>[L(ae(_))]),_:1}),a[23]||(a[23]=ee(" 基本资料"))])]),_:1}),a[27]||(a[27]=ee()),L(c,{label:"修改密码",name:"password"},{label:X(()=>[Y("span",null,[L(o,null,{default:X(()=>[L(ae(h))]),_:1}),a[24]||(a[24]=ee(" 修改密码"))])]),_:1}),a[28]||(a[28]=ee()),L(c,{label:"账号绑定",name:"binding"},{label:X(()=>[Y("span",null,[L(o,null,{default:X(()=>[L(ae(y))]),_:1}),a[25]||(a[25]=ee(" 账号绑定"))])]),_:1}),a[29]||(a[29]=ee()),L(c,{label:"消息通知",name:"notification"},{label:X(()=>[Y("span",null,[L(o,null,{default:X(()=>[L(ae(V))]),_:1}),a[26]||(a[26]=ee(" 消息通知"))])]),_:1})]),_:1},8,["modelValue"])])]),default:X(()=>[a[78]||(a[78]=ee()),"basic"===i.value?(T(),K("div",me,[L(H,{ref_key:"userFormRef",ref:t,model:Oe,rules:Fe,"label-width":"80px",class:"profile-form"},{default:X(()=>[L(j,{label:"用户名",prop:"username"},{default:X(()=>[L(v,{modelValue:Oe.username,"onUpdate:modelValue":a[1]||(a[1]=e=>Oe.username=e),disabled:"",placeholder:"用户登录名"},{append:X(()=>[L(f,{content:"用户名是系统内部标识，不可修改",placement:"top"},{default:X(()=>[L(o,null,{default:X(()=>[L(ae(P))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[33]||(a[33]=ee()),L(j,{label:"姓名",prop:"name"},{default:X(()=>[L(v,{modelValue:Oe.name,"onUpdate:modelValue":a[2]||(a[2]=e=>Oe.name=e),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),a[34]||(a[34]=ee()),L(j,{label:"邮箱",prop:"email"},{default:X(()=>[L(v,{modelValue:Oe.email,"onUpdate:modelValue":a[3]||(a[3]=e=>Oe.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a[35]||(a[35]=ee()),L(j,{label:"手机号",prop:"phone"},{default:X(()=>[L(v,{modelValue:Oe.phone,"onUpdate:modelValue":a[4]||(a[4]=e=>Oe.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a[36]||(a[36]=ee()),L(j,null,{default:X(()=>[L(I,{type:"primary",onClick:We,loading:De.value},{default:X(()=>a[30]||(a[30]=[ee("保存")])),_:1},8,["loading"]),a[32]||(a[32]=ee()),L(I,{onClick:He},{default:X(()=>a[31]||(a[31]=[ee("重置")])),_:1})]),_:1})]),_:1},8,["model"])])):"password"===i.value?(T(),K("div",fe,[L(H,{ref_key:"passwordFormRef",ref:Ae,model:Ee,rules:Ze,"label-width":"120px",class:"profile-form"},{default:X(()=>[L(j,{label:"当前密码",prop:"oldPassword"},{default:X(()=>[L(v,{modelValue:Ee.oldPassword,"onUpdate:modelValue":a[5]||(a[5]=e=>Ee.oldPassword=e),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),a[41]||(a[41]=ee()),L(j,{label:"新密码",prop:"newPassword"},{append:X(()=>[L(f,{content:"密码必须包含大小写字母和数字，长度不少于6位",placement:"top"},{default:X(()=>[L(o,null,{default:X(()=>[L(ae(P))]),_:1})]),_:1})]),default:X(()=>[L(v,{modelValue:Ee.newPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>Ee.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"]),a[37]||(a[37]=ee())]),_:1}),a[42]||(a[42]=ee()),L(j,{label:"确认新密码",prop:"confirmPassword"},{default:X(()=>[L(v,{modelValue:Ee.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>Ee.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a[43]||(a[43]=ee()),L(j,null,{default:X(()=>[L(I,{type:"primary",onClick:Je,loading:Qe.value},{default:X(()=>a[38]||(a[38]=[ee("保存")])),_:1},8,["loading"]),a[40]||(a[40]=ee()),L(I,{onClick:Ne},{default:X(()=>a[39]||(a[39]=[ee("重置")])),_:1})]),_:1})]),_:1},8,["model"])])):"binding"===i.value?(T(),K("div",ve,[L(J,null,{default:X(()=>a[44]||(a[44]=[ee("社交账号绑定")])),_:1}),a[59]||(a[59]=ee()),Y("div",pe,[Y("div",ge,[Y("div",be,[Y("div",we,[L(o,null,{default:X(()=>[L(ae(k))]),_:1})]),a[45]||(a[45]=ee()),a[46]||(a[46]=Y("div",{class:"binding-detail"},[Y("div",{class:"binding-name"},"微信"),ee(),Y("div",{class:"binding-status"},"未绑定")],-1))]),a[48]||(a[48]=ee()),L(I,{type:"success",size:"small"},{default:X(()=>a[47]||(a[47]=[ee("绑定")])),_:1})]),a[57]||(a[57]=ee()),Y("div",_e,[Y("div",he,[Y("div",ye,[L(o,null,{default:X(()=>[L(ae(U))]),_:1})]),a[49]||(a[49]=ee()),a[50]||(a[50]=Y("div",{class:"binding-detail"},[Y("div",{class:"binding-name"},"QQ"),ee(),Y("div",{class:"binding-status"},"未绑定")],-1))]),a[52]||(a[52]=ee()),L(I,{type:"success",size:"small"},{default:X(()=>a[51]||(a[51]=[ee("绑定")])),_:1})]),a[58]||(a[58]=ee()),Y("div",Ve,[Y("div",Pe,[Y("div",ke,[L(o,null,{default:X(()=>[L(ae(x))]),_:1})]),a[53]||(a[53]=ee()),a[54]||(a[54]=Y("div",{class:"binding-detail"},[Y("div",{class:"binding-name"},"微博"),ee(),Y("div",{class:"binding-status"},"未绑定")],-1))]),a[56]||(a[56]=ee()),L(I,{type:"success",size:"small"},{default:X(()=>a[55]||(a[55]=[ee("绑定")])),_:1})])])])):"notification"===i.value?(T(),K("div",Ue,[L(J,null,{default:X(()=>a[60]||(a[60]=[ee("消息通知设置")])),_:1}),a[72]||(a[72]=ee()),Y("div",xe,[a[61]||(a[61]=Y("div",{class:"notification-info"},[Y("div",{class:"notification-title"},"系统通知"),ee(),Y("div",{class:"notification-desc"},"系统更新、维护等通知")],-1)),a[62]||(a[62]=ee()),L(N,{modelValue:$e.system,"onUpdate:modelValue":a[8]||(a[8]=e=>$e.system=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[73]||(a[73]=ee()),Y("div",je,[a[63]||(a[63]=Y("div",{class:"notification-info"},[Y("div",{class:"notification-title"},"课程通知"),ee(),Y("div",{class:"notification-desc"},"课程变更、考试等通知")],-1)),a[64]||(a[64]=ee()),L(N,{modelValue:$e.course,"onUpdate:modelValue":a[9]||(a[9]=e=>$e.course=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[74]||(a[74]=ee()),Y("div",Ie,[a[65]||(a[65]=Y("div",{class:"notification-info"},[Y("div",{class:"notification-title"},"考勤通知"),ee(),Y("div",{class:"notification-desc"},"考勤记录、异常提醒等通知")],-1)),a[66]||(a[66]=ee()),L(N,{modelValue:$e.attendance,"onUpdate:modelValue":a[10]||(a[10]=e=>$e.attendance=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[75]||(a[75]=ee()),Y("div",ze,[a[67]||(a[67]=Y("div",{class:"notification-info"},[Y("div",{class:"notification-title"},"邮件通知"),ee(),Y("div",{class:"notification-desc"},"通过邮件接收通知")],-1)),a[68]||(a[68]=ee()),L(N,{modelValue:$e.email,"onUpdate:modelValue":a[11]||(a[11]=e=>$e.email=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[76]||(a[76]=ee()),Y("div",qe,[a[69]||(a[69]=Y("div",{class:"notification-info"},[Y("div",{class:"notification-title"},"短信通知"),ee(),Y("div",{class:"notification-desc"},"通过短信接收通知")],-1)),a[70]||(a[70]=ee()),L(N,{modelValue:$e.sms,"onUpdate:modelValue":a[12]||(a[12]=e=>$e.sms=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),a[77]||(a[77]=ee()),Y("div",Ce,[L(I,{type:"primary",onClick:Se},{default:X(()=>a[71]||(a[71]=[ee("保存设置")])),_:1})])])):le("",!0)]),_:1})]),_:1})]),_:1})])}}},[["__scopeId","data-v-0966c869"]]);export{Oe as default};
