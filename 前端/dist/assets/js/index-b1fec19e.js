var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(e,t,l)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;import{_ as u,u as n}from"./index-1c6f2b30.js";import{_ as i}from"./index-db7beee4.js";import{_ as d}from"./index-292e5414.js";import{r as c,f as v,l as p,m,E as f,z as b,q as h,D as g,A as w,G as _,X as y,F as D,W as j,y as k,n as L,ab as O}from"./vue-core-d6f028e5.js";import{g as x,e as N}from"./attendance-ce7d59db.js";import{E as C}from"./utils-80dc1c42.js";import{Q as S,aa as U,ab as z,av as V,af as E,ai as I,aj as P,ac as R,ag as F,ak as Y,am as A,an as W,ao as q,as as M,ae as Q}from"./element-plus-33c96ec5.js";import"./icons-02de347c.js";const T={class:"app-container"},B={class:"statistic-number"},G={class:"statistic-number"},K={class:"statistic-number"},X={class:"statistic-number"},$={class:"statistic-number"},H={class:"statistic-number"},J={class:"chart-content"},Z=u({__name:"index",setup(a){const u=n();c(u.userId);const Z=c(u.userId),aa=c(null);let ea=null;const ta=c([]),la=c(!1),sa=c(!0),ra=c(0),oa=c({total:0,normal:0,absent:0,late:0,earlyLeave:0,leave:0}),ua=c([{value:0,label:"出勤"},{value:1,label:"缺勤"},{value:2,label:"迟到"},{value:3,label:"早退"},{value:4,label:"请假"}]),na=c([]),ia=c({pageNum:1,pageSize:10,courseName:void 0,startDate:void 0,endDate:void 0,status:void 0});function da(){la.value=!0,na.value&&na.value.length>0?(ia.value.startDate=na.value[0],ia.value.endDate=na.value[1]):(ia.value.startDate=void 0,ia.value.endDate=void 0),x(u.userId,ia.value).then(a=>{a&&a.data?(ta.value=a.data.list||[],ra.value=parseInt(a.data.total),oa.value={total:ta.value.length,normal:0,absent:0,late:0,earlyLeave:0,leave:0},ta.value.forEach(a=>{switch(a.status){case 0:oa.value.normal++;break;case 1:oa.value.absent++;break;case 2:oa.value.late++;break;case 3:oa.value.earlyLeave++;break;case 4:oa.value.leave++}}),L(()=>{!function(){if(!aa.value)return;ea&&ea.dispose();ea=C(aa.value);const a={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"bottom",data:["出勤","缺勤","迟到","早退","请假"]},series:[{name:"考勤状态",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:oa.value.normal,name:"出勤"},{value:oa.value.absent,name:"缺勤"},{value:oa.value.late,name:"迟到"},{value:oa.value.earlyLeave,name:"早退"},{value:oa.value.leave,name:"请假"}],color:["#67C23A","#F56C6C","#E6A23C","#909399","#409EFF"]}]};ea.setOption(a),window.addEventListener("resize",()=>{ea&&ea.resize()})}()})):(ta.value=[],ra.value=0,oa.value={total:0,normal:0,absent:0,late:0,earlyLeave:0,leave:0}),la.value=!1}).catch(a=>{ta.value=[],ra.value=0,la.value=!1})}function ca(){na.value=[],ia.value={pageNum:1,pageSize:10,courseName:void 0,startDate:void 0,endDate:void 0,status:void 0},va()}function va(){ia.value.pageNum=1,da()}function pa(){const a=(u=((a,e)=>{for(var t in e||(e={}))s.call(e,t)&&o(a,t,e[t]);if(l)for(var t of l(e))r.call(e,t)&&o(a,t,e[t]);return a})({},ia.value),n={studentId:Z.value,export:!0},e(u,t(n)));var u,n;na.value&&na.value.length>0&&(a.startDate=na.value[0],a.endDate=na.value[1]),N(a).then(a=>{const e=new Blob([a.data]),t=`我的考勤记录_${(new Date).getTime()}.xlsx`,l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=t,l.click(),URL.revokeObjectURL(l.href)})}return v(()=>{da()}),(a,e)=>{const t=U,l=z,s=V,r=Q,o=E,u=I,n=P,c=R,v=d,L=F,x=Y,N=A,C=W,Z=q,ea=i,ma=O("hasPerms"),fa=M;return p(),m("div",T,[f(x,{class:"box-card"},{header:b(()=>e[6]||(e[6]=[h("div",{class:"card-header"},[h("span",null,"我的考勤记录")],-1)])),default:b(()=>[e[39]||(e[39]=g()),w(f(n,{model:ia.value,ref:"queryForm",inline:!0},{default:b(()=>[f(l,{label:"课程名称",prop:"courseName"},{default:b(()=>[f(t,{modelValue:ia.value.courseName,"onUpdate:modelValue":e[0]||(e[0]=a=>ia.value.courseName=a),placeholder:"请输入课程名称",clearable:"",onKeyup:y(va,["enter"])},null,8,["modelValue"])]),_:1}),e[10]||(e[10]=g()),f(l,{label:"考勤日期",prop:"attendanceDate"},{default:b(()=>[f(s,{modelValue:na.value,"onUpdate:modelValue":e[1]||(e[1]=a=>na.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e[11]||(e[11]=g()),f(l,{label:"考勤状态",prop:"status"},{default:b(()=>[f(o,{modelValue:ia.value.status,"onUpdate:modelValue":e[2]||(e[2]=a=>ia.value.status=a),placeholder:"请选择考勤状态",clearable:""},{default:b(()=>[(p(!0),m(D,null,j(ua.value,a=>(p(),k(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e[12]||(e[12]=g()),f(l,null,{default:b(()=>[f(u,{type:"primary",icon:"Search",onClick:va},{default:b(()=>e[7]||(e[7]=[g("搜索")])),_:1}),e[9]||(e[9]=g()),f(u,{icon:"Refresh",onClick:ca},{default:b(()=>e[8]||(e[8]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[_,sa.value]]),e[40]||(e[40]=g()),f(L,{gutter:10,class:"mb8"},{default:b(()=>[f(c,{span:1.5},{default:b(()=>[w((p(),k(u,{type:"warning",plain:"",icon:"Download",onClick:pa},{default:b(()=>e[13]||(e[13]=[g("导出")])),_:1})),[[ma,["attendance:record:export"]]])]),_:1}),e[14]||(e[14]=g()),f(v,{showSearch:sa.value,"onUpdate:showSearch":e[3]||(e[3]=a=>sa.value=a),onQueryTable:da},null,8,["showSearch"])]),_:1}),e[41]||(e[41]=g()),f(L,{gutter:20,class:"mb20"},{default:b(()=>[f(c,{span:4},{default:b(()=>[f(x,{shadow:"hover",class:"statistic-card"},{default:b(()=>[e[15]||(e[15]=h("div",{class:"statistic-title"},"总考勤",-1)),e[16]||(e[16]=g()),h("div",B,S(oa.value.total),1)]),_:1})]),_:1}),e[27]||(e[27]=g()),f(c,{span:4},{default:b(()=>[f(x,{shadow:"hover",class:"statistic-card normal"},{default:b(()=>[e[17]||(e[17]=h("div",{class:"statistic-title"},"出勤",-1)),e[18]||(e[18]=g()),h("div",G,S(oa.value.normal),1)]),_:1})]),_:1}),e[28]||(e[28]=g()),f(c,{span:4},{default:b(()=>[f(x,{shadow:"hover",class:"statistic-card absent"},{default:b(()=>[e[19]||(e[19]=h("div",{class:"statistic-title"},"缺勤",-1)),e[20]||(e[20]=g()),h("div",K,S(oa.value.absent),1)]),_:1})]),_:1}),e[29]||(e[29]=g()),f(c,{span:4},{default:b(()=>[f(x,{shadow:"hover",class:"statistic-card late"},{default:b(()=>[e[21]||(e[21]=h("div",{class:"statistic-title"},"迟到",-1)),e[22]||(e[22]=g()),h("div",X,S(oa.value.late),1)]),_:1})]),_:1}),e[30]||(e[30]=g()),f(c,{span:4},{default:b(()=>[f(x,{shadow:"hover",class:"statistic-card early-leave"},{default:b(()=>[e[23]||(e[23]=h("div",{class:"statistic-title"},"早退",-1)),e[24]||(e[24]=g()),h("div",$,S(oa.value.earlyLeave),1)]),_:1})]),_:1}),e[31]||(e[31]=g()),f(c,{span:4},{default:b(()=>[f(x,{shadow:"hover",class:"statistic-card leave"},{default:b(()=>[e[25]||(e[25]=h("div",{class:"statistic-title"},"请假",-1)),e[26]||(e[26]=g()),h("div",H,S(oa.value.leave),1)]),_:1})]),_:1})]),_:1}),e[42]||(e[42]=g()),w((p(),k(Z,{data:ta.value},{default:b(()=>[f(N,{label:"课程名称",align:"center",prop:"courseName","show-overflow-tooltip":!0}),e[32]||(e[32]=g()),f(N,{label:"课程编码",align:"center",prop:"courseCode"}),e[33]||(e[33]=g()),f(N,{label:"班级",align:"center",prop:"className","show-overflow-tooltip":!0}),e[34]||(e[34]=g()),f(N,{label:"考勤日期",align:"center",prop:"attendanceDate",width:"100"}),e[35]||(e[35]=g()),f(N,{label:"考勤状态",align:"center",prop:"statusDesc",width:"80"},{default:b(a=>[f(C,{type:0===a.row.status?"success":1===a.row.status?"danger":2===a.row.status?"warning":3===a.row.status?"info":""},{default:b(()=>[g(S(a.row.statusDesc),1)]),_:2},1032,["type"])]),_:1}),e[36]||(e[36]=g()),f(N,{label:"备注",align:"center",prop:"remark","show-overflow-tooltip":!0})]),_:1},8,["data"])),[[fa,la.value]]),e[43]||(e[43]=g()),w(f(ea,{total:ra.value,page:ia.value.pageNum,"onUpdate:page":e[4]||(e[4]=a=>ia.value.pageNum=a),limit:ia.value.pageSize,"onUpdate:limit":e[5]||(e[5]=a=>ia.value.pageSize=a),onPagination:da},null,8,["total","page","limit"]),[[_,ra.value>0]]),e[44]||(e[44]=g()),f(x,{class:"chart-card",shadow:"hover",style:{"margin-top":"20px"}},{header:b(()=>e[37]||(e[37]=[h("div",{class:"chart-header"},[h("span",null,"考勤统计分析")],-1)])),default:b(()=>[e[38]||(e[38]=g()),h("div",J,[h("div",{id:"attendanceChart",class:"chart",ref_key:"attendanceChartRef",ref:aa},null,512)])]),_:1})]),_:1})])}}},[["__scopeId","data-v-4baafd28"]]);export{Z as default};
