var e=(e,a,l)=>new Promise(((t,n)=>{var o=e=>{try{r(l.next(e))}catch(a){n(a)}},u=e=>{try{r(l.throw(e))}catch(a){n(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,u);r((l=l.apply(e,a)).next())}));import{_ as a,u as l,n as t,o as n}from"./index-22381d63.js";import{c as o,r as u,M as r,f as d,m as s,E as i,z as c,D as p,ah as m,ag as f,l as g,q as v,C as h,u as _,A as y,y as b}from"./vue-core-9ee4ed8b.js";import{D as w,M as N,R as k,S as C,T as V,O as I}from"./icons-c547ea56.js";import{O as x,a9 as z,al as U,Q as j,R,aj as S,ab as A,ac as q,ak as O,an as F,ao as D,aE as E,ap as P,aq as B,ae as M,as as Q}from"./element-plus-e2333c73.js";import"./utils-e59f4bae.js";const T={class:"course-students-container"},$={class:"card-header"},G={class:"header-left"},H={key:0,class:"course-info"},J={class:"operation-container"},K={key:0},L={key:1,class:"no-score"},W={key:1,class:"no-grade"},X={class:"pagination-container"},Y={class:"dialog-footer"},Z=a({__name:"students",setup(a){const Z=m(),ee=f(),ae=o((()=>ee.params.courseId)),le=o((()=>ee.params.id)),te=l(),ne=u(null),oe=u(null),ue=u(!1),re=u([]),de=u(0),se=u(!1),ie=u(!1),ce=r({courseId:null,courseOfferingId:null,studentNo:"",studentName:"",pageNum:1,pageSize:10}),pe=r({visible:!1,title:"录入成绩"}),me=r({id:null,studentId:null,studentName:"",studentNo:"",score:null,comment:""}),fe={score:[{required:!0,message:"请输入成绩",trigger:"blur"}]},ge=u(null),ve=u(!1);function he(){ne.value&&ae.value?(ue.value=!0,t(ne.value,ae.value,ce).then((e=>{re.value=e.data.list||[],de.value=e.data.total||0,e.data.courseInfo&&(oe.value=e.data.courseInfo)})).catch((e=>{x.error("获取课程学生列表失败")})).finally((()=>{ue.value=!1}))):x.warning("参数不完整，无法获取学生列表")}function _e(){ce.pageNum=1,he()}function ye(){ce.studentNo="",ce.studentName="",_e()}function be(e){ce.pageSize=e,he()}function we(e){ce.pageNum=e,he()}function Ne(){Z.go(-1)}function ke(){var e;null==(e=ge.value)||e.validate((e=>{if(!e)return;ve.value=!0;const a={studentId:me.studentId,score:me.score,comment:me.comment};n(ne.value,ae.value,a).then((()=>{x.success("成绩提交成功"),pe.visible=!1,he()})).catch((e=>{x.error("成绩提交失败")})).finally((()=>{ve.value=!1}))}))}function Ce(){x.info("导入成绩功能待实现")}function Ve(){x.info("导出学生名单功能待实现")}function Ie(){x.info("下载成绩模板功能待实现")}return d((()=>e(this,null,(function*(){yield function(){return e(this,null,(function*(){try{const e=te.userInfo;e&&e.teacherId?ne.value=e.teacherId:x.warning("获取教师信息失败，请重新登录")}catch(e){x.error("获取教师信息失败")}}))}(),ce.courseId=ae.value,ce.courseOfferingId=le.value,he()})))),(e,a)=>{const l=R,t=S,n=A,o=q,u=O,r=F,d=D,m=E,f=P,x=B,ee=z,te=M,ne=U,he=Q;return g(),s("div",T,[i(ee,{class:"box-card"},{header:c((()=>[v("div",$,[v("div",G,[a[10]||(a[10]=v("span",{class:"header-title"},"课程学生名单",-1)),a[11]||(a[11]=p()),oe.value?(g(),s("span",H,j(oe.value.courseName)+" - "+j(oe.value.semester),1)):h("",!0)]),a[13]||(a[13]=p()),i(t,{onClick:Ne,link:""},{default:c((()=>[i(l,null,{default:c((()=>[i(_(w))])),_:1}),a[12]||(a[12]=p("返回\n          "))])),_:1})])])),default:c((()=>[a[35]||(a[35]=p()),i(u,{model:ce,ref:"queryForm",inline:!0,class:"search-form"},{default:c((()=>[i(o,{label:"学号",prop:"studentNo"},{default:c((()=>[i(n,{modelValue:ce.studentNo,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.studentNo=e),placeholder:"请输入学号",clearable:""},null,8,["modelValue"])])),_:1}),a[17]||(a[17]=p()),i(o,{label:"姓名",prop:"studentName"},{default:c((()=>[i(n,{modelValue:ce.studentName,"onUpdate:modelValue":a[1]||(a[1]=e=>ce.studentName=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])])),_:1}),a[18]||(a[18]=p()),i(o,null,{default:c((()=>[i(t,{type:"primary",onClick:_e},{default:c((()=>[i(l,null,{default:c((()=>[i(_(N))])),_:1}),a[14]||(a[14]=p("查询\n          "))])),_:1}),a[16]||(a[16]=p()),i(t,{onClick:ye},{default:c((()=>[i(l,null,{default:c((()=>[i(_(k))])),_:1}),a[15]||(a[15]=p("重置\n          "))])),_:1})])),_:1})])),_:1},8,["model"]),a[36]||(a[36]=p()),v("div",J,[i(t,{type:"primary",onClick:Ce,loading:se.value},{default:c((()=>[i(l,null,{default:c((()=>[i(_(C))])),_:1}),a[19]||(a[19]=p("导入成绩\n        "))])),_:1},8,["loading"]),a[22]||(a[22]=p()),i(t,{type:"primary",onClick:Ve,loading:ie.value},{default:c((()=>[i(l,null,{default:c((()=>[i(_(V))])),_:1}),a[20]||(a[20]=p("导出学生名单\n        "))])),_:1},8,["loading"]),a[23]||(a[23]=p()),i(t,{type:"primary",onClick:Ie},{default:c((()=>[i(l,null,{default:c((()=>[i(_(I))])),_:1}),a[21]||(a[21]=p("下载成绩模板\n        "))])),_:1})]),a[37]||(a[37]=p()),y((g(),b(f,{data:re.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:c((()=>[i(r,{type:"index",label:"#",width:"60"}),a[27]||(a[27]=p()),i(r,{prop:"studentNo",label:"学号",width:"120"}),a[28]||(a[28]=p()),i(r,{prop:"studentName",label:"姓名",width:"120"}),a[29]||(a[29]=p()),i(r,{prop:"gender",label:"性别",width:"80",align:"center"},{default:c((e=>[p(j(0===e.row.gender?"男":"女"),1)])),_:1}),a[30]||(a[30]=p()),i(r,{prop:"className",label:"班级",width:"180"}),a[31]||(a[31]=p()),i(r,{prop:"score",label:"成绩",width:"100",align:"center"},{default:c((e=>[null!==e.row.score&&void 0!==e.row.score?(g(),s("span",K,j(e.row.score),1)):(g(),s("span",L,"未录入"))])),_:1}),a[32]||(a[32]=p()),i(r,{prop:"grade",label:"等级",width:"100",align:"center"},{default:c((e=>{return[e.row.grade?(g(),b(d,{key:0,type:(a=e.row.grade,{"A+":"success",A:"success","B+":"success",B:"warning","C+":"warning",C:"warning",D:"danger",F:"danger"}[a]||"info")},{default:c((()=>[p(j(e.row.grade),1)])),_:2},1032,["type"])):(g(),s("span",W,"-"))];var a})),_:1}),a[33]||(a[33]=p()),i(r,{prop:"attendanceRate",label:"出勤率",width:"100",align:"center"},{default:c((e=>{return[i(m,{percentage:e.row.attendanceRate||0,color:(a=e.row.attendanceRate,null==a?"#909399":a>=90?"#67C23A":a>=80?"#E6A23C":"#F56C6C"),format:e=>`${e}%`},null,8,["percentage","color","format"])];var a})),_:1}),a[34]||(a[34]=p()),i(r,{label:"操作","min-width":"150",fixed:"right"},{default:c((e=>[i(t,{type:"primary",link:"",onClick:a=>{return l=e.row,pe.title="编辑成绩",pe.visible=!0,me.id=l.id,me.studentId=l.studentId,me.studentName=l.studentName,me.studentNo=l.studentNo,me.score=l.score,void(me.comment=l.comment||"");var l}},{default:c((()=>a[24]||(a[24]=[p("\n              编辑成绩\n            ")]))),_:2},1032,["onClick"]),a[26]||(a[26]=p()),i(t,{type:"primary",link:"",onClick:a=>{return l=e.row,void Z.push({name:"AttendanceRecord",query:{courseId:ae.value,courseOfferingId:le.value,studentId:l.studentId}});var l}},{default:c((()=>a[25]||(a[25]=[p("\n              考勤记录\n            ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[he,ue.value]]),a[38]||(a[38]=p()),v("div",X,[i(x,{"current-page":ce.pageNum,"onUpdate:currentPage":a[2]||(a[2]=e=>ce.pageNum=e),"page-size":ce.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>ce.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:de.value,onSizeChange:be,onCurrentChange:we},null,8,["current-page","page-size","total"])])])),_:1}),a[46]||(a[46]=p()),i(ne,{modelValue:pe.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>pe.visible=e),title:pe.title,width:"500px","append-to-body":""},{footer:c((()=>[v("div",Y,[i(t,{onClick:a[8]||(a[8]=e=>pe.visible=!1)},{default:c((()=>a[42]||(a[42]=[p("取消")]))),_:1}),a[44]||(a[44]=p()),i(t,{type:"primary",onClick:ke,loading:ve.value},{default:c((()=>a[43]||(a[43]=[p("确定")]))),_:1},8,["loading"])])])),default:c((()=>[i(u,{ref_key:"gradeFormRef",ref:ge,model:me,rules:fe,"label-width":"80px"},{default:c((()=>[i(o,{label:"学生",prop:"studentName"},{default:c((()=>[i(n,{modelValue:me.studentName,"onUpdate:modelValue":a[4]||(a[4]=e=>me.studentName=e),disabled:""},null,8,["modelValue"])])),_:1}),a[39]||(a[39]=p()),i(o,{label:"学号",prop:"studentNo"},{default:c((()=>[i(n,{modelValue:me.studentNo,"onUpdate:modelValue":a[5]||(a[5]=e=>me.studentNo=e),disabled:""},null,8,["modelValue"])])),_:1}),a[40]||(a[40]=p()),i(o,{label:"成绩",prop:"score"},{default:c((()=>[i(te,{modelValue:me.score,"onUpdate:modelValue":a[6]||(a[6]=e=>me.score=e),min:0,max:100,precision:1,style:{width:"100%"}},null,8,["modelValue"])])),_:1}),a[41]||(a[41]=p()),i(o,{label:"备注",prop:"comment"},{default:c((()=>[i(n,{modelValue:me.comment,"onUpdate:modelValue":a[7]||(a[7]=e=>me.comment=e),type:"textarea",rows:"3",placeholder:"请输入备注"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),a[45]||(a[45]=p())])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-2c518a4c"]]);export{Z as default};
