var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,l,r)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[l]=r;import{_ as t,K as u,L as o,M as d,N as n,O as p,P as i,Q as m}from"./index-22381d63.js";import{M as c,R as f,B as b}from"./icons-c547ea56.js";import{O as h,a9 as g,al as w,Q as y,P as v,ab as V,ac as _,af as k,ag as U,R as C,aj as T,ak as x,an as I,ao as P,a2 as j,ap as z,aq as q,au as N,a4 as O,as as S}from"./element-plus-e2333c73.js";import{r as D,M as R,f as $,m as B,E,z as F,D as M,l as Q,u as A,q as K,A as L,y as G,C as H}from"./vue-core-9ee4ed8b.js";import"./utils-e59f4bae.js";const J={class:"user-container"},W={class:"card-header"},X={class:"header-buttons"},Y={style:{display:"flex","align-items":"center","justify-content":"center",gap:"8px"}},Z={class:"pagination-container"},ee={class:"dialog-footer"},ae={class:"dialog-footer"},le=t({__name:"index",setup(e){const t=D([]),le=D(0),re=D(!1),se=R({pageNum:1,pageSize:10,username:"",name:"",phone:"",status:null}),te=D(null),ue=R({visible:!1,title:"",type:""}),oe=R({userId:void 0,username:"",name:"",userType:0,email:"",phone:"",password:"",status:0}),de={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3到20个字符之间",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],userType:[{required:!0,message:"请选择用户类型",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],email:[{pattern:/^[\w.-]+@[\w.-]+\.\w+$/,message:"邮箱格式不正确",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}]},ne=D(null),pe=R({visible:!1,userId:void 0}),ie=R({userId:void 0,username:"",password:"",confirmPassword:""}),me={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==ie.password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]};$((()=>{ce()}));const ce=()=>{re.value=!0,u(se).then((e=>{t.value=e.data.list||[],le.value=e.data.total||0})).catch((e=>{h.error("获取用户列表失败")})).finally((()=>{re.value=!1}))},fe=()=>{se.pageNum=1,ce()},be=()=>{se.username="",se.name="",se.phone="",se.status=null,fe()},he=e=>{se.pageNum=e,ce()},ge=e=>{se.pageSize=e,ce()},we=()=>{Ve(),ue.visible=!0,ue.title="新增用户",ue.type="add"},ye=()=>{ne.value.validate((e=>{if(!e)return;const a={userId:Number(ie.userId),password:ie.password};n(a).then((()=>{h.success("重置密码成功"),pe.visible=!1})).catch((e=>{h.error("重置密码失败")}))}))},ve=()=>{te.value.validate((e=>{if(!e)return;const t=((e,t)=>{for(var u in t||(t={}))l.call(t,u)&&s(e,u,t[u]);if(a)for(var u of a(t))r.call(t,u)&&s(e,u,t[u]);return e})({},oe);t.userType=Number(t.userType),t.status=Number(t.status),"update"===ue.type&&(t.id=t.userId,delete t.userId),"add"===ue.type?i(t).then((()=>{h.success("添加成功"),ue.visible=!1,ce()})).catch((e=>{h.error("添加用户失败")})):m(t).then((()=>{h.success("修改成功"),ue.visible=!1,ce()})).catch((e=>{h.error("修改用户失败")}))}))},Ve=()=>{oe.userId=void 0,oe.username="",oe.name="",oe.userType=0,oe.email="",oe.phone="",oe.password="",oe.status=0},_e=e=>{switch(e){case 0:return"管理员";case 1:return"教师";case 2:return"学生";default:return"未知"}},ke=e=>{switch(e){case 0:return"danger";case 1:return"warning";case 2:return"success";default:return"info"}};return(e,a)=>{const l=V,r=_,s=k,u=U,n=C,i=T,m=x,D=g,R=I,$=P,Ue=j,Ce=z,Te=q,xe=N,Ie=O,Pe=w,je=S;return Q(),B("div",J,[E(D,{class:"search-card",shadow:"hover"},{default:F((()=>[E(m,{model:se,ref:"queryForm",inline:!0},{default:F((()=>[E(r,{label:"用户名",prop:"username"},{default:F((()=>[E(l,{modelValue:se.username,"onUpdate:modelValue":a[0]||(a[0]=e=>se.username=e),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])])),_:1}),a[27]||(a[27]=M()),E(r,{label:"姓名",prop:"name"},{default:F((()=>[E(l,{modelValue:se.name,"onUpdate:modelValue":a[1]||(a[1]=e=>se.name=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])])),_:1}),a[28]||(a[28]=M()),E(r,{label:"手机号",prop:"phone"},{default:F((()=>[E(l,{modelValue:se.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>se.phone=e),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])])),_:1}),a[29]||(a[29]=M()),E(r,{label:"状态",prop:"status"},{default:F((()=>[E(u,{modelValue:se.status,"onUpdate:modelValue":a[3]||(a[3]=e=>se.status=e),placeholder:"请选择状态",clearable:"",style:{width:"240px"}},{default:F((()=>[E(s,{label:"正常",value:0}),a[21]||(a[21]=M()),E(s,{label:"禁用",value:1})])),_:1},8,["modelValue"])])),_:1}),a[30]||(a[30]=M()),E(r,{label:"用户类型",prop:"userType"},{default:F((()=>[E(u,{modelValue:se.userType,"onUpdate:modelValue":a[4]||(a[4]=e=>se.userType=e),placeholder:"请选择用户类型",clearable:"",style:{width:"240px"}},{default:F((()=>[E(s,{label:"管理员",value:0}),a[22]||(a[22]=M()),E(s,{label:"教师",value:1}),a[23]||(a[23]=M()),E(s,{label:"学生",value:2})])),_:1},8,["modelValue"])])),_:1}),a[31]||(a[31]=M()),E(r,null,{default:F((()=>[E(i,{type:"primary",onClick:fe},{default:F((()=>[E(n,null,{default:F((()=>[E(A(c))])),_:1}),a[24]||(a[24]=M("查询\n          "))])),_:1}),a[26]||(a[26]=M()),E(i,{onClick:be},{default:F((()=>[E(n,null,{default:F((()=>[E(A(f))])),_:1}),a[25]||(a[25]=M("重置\n          "))])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),a[72]||(a[72]=M()),E(D,{class:"table-card",shadow:"hover"},{header:F((()=>[K("div",W,[a[33]||(a[33]=K("span",{class:"header-title"},"用户列表",-1)),a[34]||(a[34]=M()),K("div",X,[E(i,{type:"primary",onClick:we},{default:F((()=>[E(n,null,{default:F((()=>[E(A(b))])),_:1}),a[32]||(a[32]=M("新增\n            "))])),_:1})])])])),default:F((()=>[a[49]||(a[49]=M()),L((Q(),G(Ce,{data:t.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:F((()=>[E(R,{prop:"id",label:"用户ID",width:"80"}),a[41]||(a[41]=M()),E(R,{prop:"username",label:"用户名",width:"120"}),a[42]||(a[42]=M()),E(R,{prop:"name",label:"姓名",width:"100"}),a[43]||(a[43]=M()),E(R,{prop:"userType",label:"用户类型",width:"100"},{default:F((e=>[E($,{type:ke(e.row.userType)},{default:F((()=>[M(y(_e(e.row.userType)),1)])),_:2},1032,["type"])])),_:1}),a[44]||(a[44]=M()),E(R,{prop:"phone",label:"手机号码",width:"120"}),a[45]||(a[45]=M()),E(R,{prop:"email",label:"邮箱","min-width":"180"}),a[46]||(a[46]=M()),E(R,{prop:"statusDesc",label:"状态",width:"120",align:"center"},{default:F((e=>[K("div",Y,[K("span",null,y(e.row.statusDesc),1),a[35]||(a[35]=M()),E(Ue,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":0,"inactive-value":1,onChange:a=>(e=>{const a={userId:e.id,status:e.status};p(a).then((()=>{h.success(`已${0===e.status?"启用":"禁用"}用户`)})).catch((a=>{h.error("修改用户状态失败"),e.status=0===e.status?1:0}))})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:1}),a[47]||(a[47]=M()),E(R,{prop:"createTime",label:"创建时间",width:"160"}),a[48]||(a[48]=M()),E(R,{label:"操作",fixed:"right",width:"220"},{default:F((e=>[E(i,{type:"primary",link:"",onClick:a=>{return l=e.row,Ve(),ue.visible=!0,ue.title="编辑用户",ue.type="update",void o(l.id).then((e=>{const a=e.data;oe.userId=a.id,oe.username=a.username,oe.name=a.name,oe.userType=a.userType,oe.email=a.email,oe.phone=a.phone,oe.status=a.status})).catch((e=>{h.error("获取用户详情失败")}));var l}},{default:F((()=>a[36]||(a[36]=[M("\n              编辑\n            ")]))),_:2},1032,["onClick"]),a[39]||(a[39]=M()),E(i,{type:"primary",link:"",onClick:a=>{return l=e.row,ie.userId=l.id,ie.username=l.username,ie.password="",ie.confirmPassword="",void(pe.visible=!0);var l}},{default:F((()=>a[37]||(a[37]=[M("\n              重置密码\n            ")]))),_:2},1032,["onClick"]),a[40]||(a[40]=M()),E(i,{type:"danger",link:"",onClick:a=>{return l=e.row,void v.confirm(`确定要删除用户 ${l.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{d(l.id).then((()=>{h.success("删除成功"),ce()})).catch((e=>{h.error("删除用户失败")}))})).catch((()=>{}));var l}},{default:F((()=>a[38]||(a[38]=[M("\n              删除\n            ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[je,re.value]]),a[50]||(a[50]=M()),K("div",Z,[E(Te,{"current-page":se.pageNum,"onUpdate:currentPage":a[5]||(a[5]=e=>se.pageNum=e),"page-size":se.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>se.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:le.value,onSizeChange:ge,onCurrentChange:he},null,8,["current-page","page-size","total"])])])),_:1}),a[73]||(a[73]=M()),E(Pe,{title:ue.title,modelValue:ue.visible,"onUpdate:modelValue":a[15]||(a[15]=e=>ue.visible=e),width:"600px","append-to-body":"","destroy-on-close":""},{footer:F((()=>[K("div",ee,[E(i,{onClick:a[14]||(a[14]=e=>ue.visible=!1)},{default:F((()=>a[62]||(a[62]=[M("取消")]))),_:1}),a[64]||(a[64]=M()),E(i,{type:"primary",onClick:ve},{default:F((()=>a[63]||(a[63]=[M("确定")]))),_:1})])])),default:F((()=>[E(m,{ref_key:"userFormRef",ref:te,model:oe,rules:de,"label-width":"80px"},{default:F((()=>[E(r,{label:"用户名",prop:"username"},{default:F((()=>[E(l,{modelValue:oe.username,"onUpdate:modelValue":a[7]||(a[7]=e=>oe.username=e),placeholder:"请输入用户名",disabled:"update"===ue.type},null,8,["modelValue","disabled"])])),_:1}),a[56]||(a[56]=M()),E(r,{label:"姓名",prop:"name"},{default:F((()=>[E(l,{modelValue:oe.name,"onUpdate:modelValue":a[8]||(a[8]=e=>oe.name=e),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),a[57]||(a[57]=M()),E(r,{label:"用户类型",prop:"userType"},{default:F((()=>[E(u,{modelValue:oe.userType,"onUpdate:modelValue":a[9]||(a[9]=e=>oe.userType=e),placeholder:"请选择用户类型",style:{width:"100%"}},{default:F((()=>[E(s,{label:"管理员",value:0}),a[51]||(a[51]=M()),E(s,{label:"教师",value:1}),a[52]||(a[52]=M()),E(s,{label:"学生",value:2})])),_:1},8,["modelValue"])])),_:1}),a[58]||(a[58]=M()),E(r,{label:"邮箱",prop:"email"},{default:F((()=>[E(l,{modelValue:oe.email,"onUpdate:modelValue":a[10]||(a[10]=e=>oe.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),a[59]||(a[59]=M()),E(r,{label:"手机号",prop:"phone"},{default:F((()=>[E(l,{modelValue:oe.phone,"onUpdate:modelValue":a[11]||(a[11]=e=>oe.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),a[60]||(a[60]=M()),"add"===ue.type?(Q(),G(r,{key:0,label:"密码",prop:"password"},{default:F((()=>[E(l,{modelValue:oe.password,"onUpdate:modelValue":a[12]||(a[12]=e=>oe.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1})):H("",!0),a[61]||(a[61]=M()),E(r,{label:"状态",prop:"status"},{default:F((()=>[E(Ie,{modelValue:oe.status,"onUpdate:modelValue":a[13]||(a[13]=e=>oe.status=e)},{default:F((()=>[E(xe,{label:0},{default:F((()=>a[53]||(a[53]=[M("正常")]))),_:1}),a[55]||(a[55]=M()),E(xe,{label:1},{default:F((()=>a[54]||(a[54]=[M("禁用")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"]),a[65]||(a[65]=M())])),_:1},8,["title","modelValue"]),a[74]||(a[74]=M()),E(Pe,{title:"重置密码",modelValue:pe.visible,"onUpdate:modelValue":a[20]||(a[20]=e=>pe.visible=e),width:"500px","append-to-body":""},{footer:F((()=>[K("div",ae,[E(i,{onClick:a[19]||(a[19]=e=>pe.visible=!1)},{default:F((()=>a[68]||(a[68]=[M("取消")]))),_:1}),a[70]||(a[70]=M()),E(i,{type:"primary",onClick:ye},{default:F((()=>a[69]||(a[69]=[M("确定")]))),_:1})])])),default:F((()=>[E(m,{ref_key:"resetPwdFormRef",ref:ne,model:ie,rules:me,"label-width":"80px"},{default:F((()=>[E(r,{label:"用户名"},{default:F((()=>[E(l,{modelValue:ie.username,"onUpdate:modelValue":a[16]||(a[16]=e=>ie.username=e),disabled:""},null,8,["modelValue"])])),_:1}),a[66]||(a[66]=M()),E(r,{label:"新密码",prop:"password"},{default:F((()=>[E(l,{modelValue:ie.password,"onUpdate:modelValue":a[17]||(a[17]=e=>ie.password=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])])),_:1}),a[67]||(a[67]=M()),E(r,{label:"确认密码",prop:"confirmPassword"},{default:F((()=>[E(l,{modelValue:ie.confirmPassword,"onUpdate:modelValue":a[18]||(a[18]=e=>ie.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),a[71]||(a[71]=M())])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-a9921c38"]]);export{le as default};
