var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,s=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))r.call(a,t)&&o(e,t,a[t]);return e};import{_ as u,u as i,g as d,a as c}from"./index-22381d63.js";import{_ as p}from"./index-50714a02.js";import{r as v,d as m,f as h,m as f,E as b,z as g,n as y,l as C,q as w,D as _,y as I,C as k,F as x,W as L,A as R,G as F}from"./vue-core-9ee4ed8b.js";import{a as E,e as j}from"./attendance-868b1362.js";import{E as A}from"./utils-e59f4bae.js";import{a9 as D,Q as z,af as O,ag as N,ac as S,av as V,aG as U,aj as P,ak as T,ad as Y,ah as W,an as q,aE as G,ap as M,as as B}from"./element-plus-e2333c73.js";import"./icons-c547ea56.js";const Q={class:"app-container"},$={class:"course-item"},H={class:"course-code"},J={class:"charts-container"},K={class:"chart-content"},X={class:"chart-content"},Z={class:"table-header"},ee={class:"table-container"},ae=u({__name:"index",setup(e){const l=i();v(l.userId);const n=v(null),r=v(null);let o=null,u=null;const ae=v([]),te=v([]),le=v(!1),ne=v(0);v([]),v(!1);const re=v([]),oe=v(!1),se=v(!1),ue=v(!1),ie=v({pageNum:1,pageSize:10,type:"course",startDate:void 0,endDate:void 0,courseId:void 0,classId:void 0}),de=v("");function ce(){oe.value=!0,c({pageNum:1,pageSize:100}).then((e=>{re.value=e.data.records,oe.value=!1})).catch((()=>{oe.value=!1}))}function pe(e){switch(ie.value.courseId=void 0,ie.value.classId=void 0,de.value="",e){case"course":default:se.value=!1,ue.value=!1;break;case"class":se.value=!1,ue.value=!1,ce();break;case"date":case"status":se.value=!0,ue.value=!0,ce()}ve()}function ve(){ie.value.pageNum=1,ae.value&&ae.value.length>0?(ie.value.startDate=ae.value[0],ie.value.endDate=ae.value[1]):(ie.value.startDate=void 0,ie.value.endDate=void 0),he()}function me(){ae.value=[],de.value="",ie.value={pageNum:1,pageSize:10,type:"course",startDate:void 0,endDate:void 0,courseId:void 0,classId:void 0},ve()}function he(){le.value=!0,E(ie.value).then((e=>{e.data&&e.data.list?(te.value=e.data.list||[],ne.value=parseInt(e.data.total||0)):e.data&&Array.isArray(e.data.records)?(te.value=e.data.records||[],ne.value=parseInt(e.data.total||0)):Array.isArray(e.data)?(te.value=e.data||[],ne.value=te.value.length):(te.value=[],ne.value=0),le.value=!1,y((()=>{try{!function(){if(!n.value)return;let e=[];if(te.value&&0!==te.value.length)if("status"===ie.value.type)e=te.value.map((e=>({value:e.count||0,name:e.statusName||"未知状态"})));else{const a={normalCount:0,absentCount:0,lateCount:0,earlyLeaveCount:0,leaveCount:0};te.value.forEach((e=>{a.normalCount+=parseInt(e.normalCount||0),a.absentCount+=parseInt(e.absentCount||0),a.lateCount+=parseInt(e.lateCount||0),a.earlyLeaveCount+=parseInt(e.earlyLeaveCount||0),a.leaveCount+=parseInt(e.leaveCount||0)})),e=[{value:a.normalCount,name:"出勤"},{value:a.absentCount,name:"缺勤"},{value:a.lateCount,name:"迟到"},{value:a.earlyLeaveCount,name:"早退"},{value:a.leaveCount,name:"请假"}]}else e=[{value:0,name:"出勤"},{value:0,name:"缺勤"},{value:0,name:"迟到"},{value:0,name:"早退"},{value:0,name:"请假"}];o&&o.dispose();o=A(n.value);const a={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"bottom",data:e.map((e=>e.name))},series:[{name:"考勤状态",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:e,color:["#67C23A","#F56C6C","#E6A23C","#909399","#909399"]}]};o.setOption(a),window.addEventListener("resize",(()=>{o&&o.resize()}))}(),function(){if(!r.value)return;let e=[],a=[];if(te.value&&0!==te.value.length){if("date"===ie.value.type){te.value.forEach((e=>{a.push(e.date||"未知日期")}));e=[{name:"出勤",type:"line",stack:"Total",data:te.value.map((e=>parseInt(e.normalCount||0))),emphasis:{focus:"series"}},{name:"缺勤",type:"line",stack:"Total",data:te.value.map((e=>parseInt(e.absentCount||0))),emphasis:{focus:"series"}},{name:"迟到",type:"line",stack:"Total",data:te.value.map((e=>parseInt(e.lateCount||0))),emphasis:{focus:"series"}},{name:"早退",type:"line",stack:"Total",data:te.value.map((e=>parseInt(e.earlyLeaveCount||0))),emphasis:{focus:"series"}},{name:"请假",type:"line",stack:"Total",data:te.value.map((e=>parseInt(e.leaveCount||0))),emphasis:{focus:"series"}}]}else if("course"===ie.value.type||"class"===ie.value.type){const t="course"===ie.value.type?"courseName":"className";te.value.forEach((e=>{a.push(e[t]||"未知")}));e=[{name:"出勤率",type:"bar",data:te.value.map((e=>parseFloat(e.attendanceRate||0))),itemStyle:{color:function(e){return be(e.value)}},label:{show:!0,position:"top",formatter:"{c}%"}}]}}else a=["暂无数据"],e=[{name:"出勤率",type:"bar",data:[0],itemStyle:{color:"#67C23A"}}];u&&u.dispose();u=A(r.value);const t={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:e.map((e=>e.name))},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",axisLabel:{formatter:function(e){return"date"===ie.value.type?e:e+"%"}},max:"date"!==ie.value.type?100:void 0},series:e,color:["#67C23A","#F56C6C","#E6A23C","#909399","#409EFF"]};u.setOption(t),window.addEventListener("resize",(()=>{u&&u.resize()}))}()}catch(e){}}))})).catch((e=>{te.value=[],ne.value=0,le.value=!1}))}function fe(){const e=s({},ie.value);var l,n;ae.value&&ae.value.length>0&&(e.startDate=ae.value[0],e.endDate=ae.value[1]),j((l=s({},e),n={export:!0},a(l,t(n)))).then((e=>{const a=new Blob([e.data]),t=`考勤统计_${(new Date).getTime()}.xlsx`,l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=t,l.click(),URL.revokeObjectURL(l.href)}))}function be(e){return(e=parseFloat(e))>=90?"#67C23A":e>=80?"#409EFF":e>=70?"#E6A23C":"#F56C6C"}function ge(e){switch(e){case 0:return"#67C23A";case 1:return"#F56C6C";case 2:return"#E6A23C";case 3:return"#909399";default:return"#409EFF"}}function ye(e,a){e?d({keyword:e,pageNum:1,pageSize:10}).then((e=>{if(200===e.code&&e.data&&e.data.list){const t=e.data.list.map((e=>({value:e.name,name:e.name,id:e.id,code:e.code})));a(t)}else a([])})).catch((()=>{a([])})):a([])}function Ce(e){ie.value.courseId=e.id,de.value=e.name,ve()}return m((()=>ie.value.type),(e=>{pe(e)})),h((()=>{he()})),(e,a)=>{const t=O,l=N,o=S,s=V,u=U,i=P,d=T,c=D,v=Y,m=W,h=q,y=G,E=M,j=p,A=B;return C(),f("div",Q,[b(c,{class:"box-card"},{header:g((()=>a[6]||(a[6]=[w("div",{class:"card-header"},[w("span",null,"考勤统计分析")],-1)]))),default:g((()=>[a[55]||(a[55]=_()),b(d,{model:ie.value,ref:"queryForm",inline:!0,class:"stats-form"},{default:g((()=>[b(o,{label:"统计类型",prop:"type"},{default:g((()=>[b(l,{modelValue:ie.value.type,"onUpdate:modelValue":a[0]||(a[0]=e=>ie.value.type=e),placeholder:"请选择统计类型",onChange:pe,style:{width:"180px"}},{default:g((()=>[b(t,{label:"按课程统计",value:"course"}),a[7]||(a[7]=_()),b(t,{label:"按班级统计",value:"class"}),a[8]||(a[8]=_()),b(t,{label:"按日期统计",value:"date"}),a[9]||(a[9]=_()),b(t,{label:"按考勤状态统计",value:"status"})])),_:1},8,["modelValue"])])),_:1}),a[13]||(a[13]=_()),b(o,{label:"日期范围",prop:"dateRange"},{default:g((()=>[b(s,{modelValue:ae.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ae.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"320px"}},null,8,["modelValue"])])),_:1}),a[14]||(a[14]=_()),se.value?(C(),I(o,{key:0,label:"课程",prop:"courseId"},{default:g((()=>[b(u,{modelValue:de.value,"onUpdate:modelValue":a[2]||(a[2]=e=>de.value=e),"fetch-suggestions":ye,placeholder:"请输入课程名称",onSelect:Ce,"trigger-on-focus":!1,style:{width:"250px"}},{default:g((({item:e})=>[w("div",$,[_(z(e.name)+" ",1),w("span",H,"("+z(e.code)+")",1)])])),_:1},8,["modelValue"])])),_:1})):k("",!0),a[15]||(a[15]=_()),ue.value?(C(),I(o,{key:1,label:"班级",prop:"classId"},{default:g((()=>[b(l,{modelValue:ie.value.classId,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.value.classId=e),placeholder:"请选择班级",filterable:"",style:{width:"250px"}},{default:g((()=>[(C(!0),f(x,null,L(re.value,(e=>(C(),I(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):k("",!0),a[16]||(a[16]=_()),b(o,null,{default:g((()=>[b(i,{type:"primary",icon:"Search",onClick:ve},{default:g((()=>a[10]||(a[10]=[_("查询")]))),_:1}),a[12]||(a[12]=_()),b(i,{icon:"Refresh",onClick:me},{default:g((()=>a[11]||(a[11]=[_("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),a[56]||(a[56]=_()),w("div",J,[b(m,{gutter:20},{default:g((()=>[b(v,{span:24},{default:g((()=>[b(c,{class:"chart-card",shadow:"hover"},{header:g((()=>a[17]||(a[17]=[w("div",{class:"chart-header"},[w("span",null,"考勤状态分布")],-1)]))),default:g((()=>[a[18]||(a[18]=_()),w("div",K,[w("div",{id:"statusChart",class:"chart",ref_key:"statusChartRef",ref:n},null,512)])])),_:1})])),_:1})])),_:1}),a[21]||(a[21]=_()),b(m,{gutter:20,style:{"margin-top":"20px"}},{default:g((()=>[b(v,{span:24},{default:g((()=>[b(c,{class:"chart-card",shadow:"hover"},{header:g((()=>a[19]||(a[19]=[w("div",{class:"chart-header"},[w("span",null,"考勤趋势分析")],-1)]))),default:g((()=>[a[20]||(a[20]=_()),w("div",X,[w("div",{id:"trendChart",class:"chart",ref_key:"trendChartRef",ref:r},null,512)])])),_:1})])),_:1})])),_:1})]),a[57]||(a[57]=_()),b(m,{style:{"margin-top":"20px"}},{default:g((()=>[b(v,{span:24},{default:g((()=>[b(c,{class:"table-card",shadow:"hover"},{header:g((()=>[w("div",Z,[a[23]||(a[23]=w("span",null,"考勤统计详情",-1)),a[24]||(a[24]=_()),b(i,{type:"primary",icon:"Download",size:"small",onClick:fe},{default:g((()=>a[22]||(a[22]=[_("导出")]))),_:1})])])),default:g((()=>[a[54]||(a[54]=_()),w("div",ee,[R((C(),I(E,{data:te.value,border:"",stripe:""},{default:g((()=>["course"===ie.value.type?(C(),f(x,{key:0},[b(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120"}),a[25]||(a[25]=_()),b(h,{label:"课程编码",align:"center",prop:"courseCode","min-width":"100"}),a[26]||(a[26]=_()),b(h,{label:"出勤率",align:"center",prop:"attendanceRate","min-width":"120"},{default:g((e=>[b(y,{percentage:parseFloat(e.row.attendanceRate),color:be(e.row.attendanceRate)},null,8,["percentage","color"])])),_:1}),a[27]||(a[27]=_()),b(h,{label:"出勤",align:"center",prop:"normalCount","min-width":"80"}),a[28]||(a[28]=_()),b(h,{label:"缺勤",align:"center",prop:"absentCount","min-width":"80"}),a[29]||(a[29]=_()),b(h,{label:"迟到",align:"center",prop:"lateCount","min-width":"80"}),a[30]||(a[30]=_()),b(h,{label:"早退",align:"center",prop:"earlyLeaveCount","min-width":"80"}),a[31]||(a[31]=_()),b(h,{label:"请假",align:"center",prop:"leaveCount","min-width":"80"}),a[32]||(a[32]=_()),b(h,{label:"总记录数",align:"center",prop:"totalCount","min-width":"100"})],64)):k("",!0),a[50]||(a[50]=_()),"class"===ie.value.type?(C(),f(x,{key:1},[b(h,{label:"班级名称",align:"center",prop:"className","min-width":"150"}),a[33]||(a[33]=_()),b(h,{label:"班级编码",align:"center",prop:"classCode","min-width":"100"}),a[34]||(a[34]=_()),b(h,{label:"出勤率",align:"center",prop:"attendanceRate","min-width":"120"},{default:g((e=>[b(y,{percentage:parseFloat(e.row.attendanceRate),color:be(e.row.attendanceRate)},null,8,["percentage","color"])])),_:1}),a[35]||(a[35]=_()),b(h,{label:"出勤",align:"center",prop:"normalCount","min-width":"80"}),a[36]||(a[36]=_()),b(h,{label:"缺勤",align:"center",prop:"absentCount","min-width":"80"}),a[37]||(a[37]=_()),b(h,{label:"迟到",align:"center",prop:"lateCount","min-width":"80"}),a[38]||(a[38]=_()),b(h,{label:"早退",align:"center",prop:"earlyLeaveCount","min-width":"80"}),a[39]||(a[39]=_()),b(h,{label:"请假",align:"center",prop:"leaveCount","min-width":"80"}),a[40]||(a[40]=_()),b(h,{label:"总记录数",align:"center",prop:"totalCount","min-width":"100"})],64)):k("",!0),a[51]||(a[51]=_()),"date"===ie.value.type?(C(),f(x,{key:2},[b(h,{label:"日期",align:"center",prop:"date","min-width":"120"}),a[41]||(a[41]=_()),b(h,{label:"出勤率",align:"center",prop:"attendanceRate","min-width":"120"},{default:g((e=>[b(y,{percentage:parseFloat(e.row.attendanceRate),color:be(e.row.attendanceRate)},null,8,["percentage","color"])])),_:1}),a[42]||(a[42]=_()),b(h,{label:"出勤",align:"center",prop:"normalCount","min-width":"80"}),a[43]||(a[43]=_()),b(h,{label:"缺勤",align:"center",prop:"absentCount","min-width":"80"}),a[44]||(a[44]=_()),b(h,{label:"迟到",align:"center",prop:"lateCount","min-width":"80"}),a[45]||(a[45]=_()),b(h,{label:"早退",align:"center",prop:"earlyLeaveCount","min-width":"80"}),a[46]||(a[46]=_()),b(h,{label:"请假",align:"center",prop:"leaveCount","min-width":"80"}),a[47]||(a[47]=_()),b(h,{label:"总记录数",align:"center",prop:"totalCount","min-width":"100"})],64)):k("",!0),a[52]||(a[52]=_()),"status"===ie.value.type?(C(),f(x,{key:3},[b(h,{label:"考勤状态",align:"center",prop:"statusName","min-width":"120"}),a[48]||(a[48]=_()),b(h,{label:"记录数",align:"center",prop:"count","min-width":"100"}),a[49]||(a[49]=_()),b(h,{label:"占比",align:"center",prop:"percentage","min-width":"180"},{default:g((e=>[b(y,{percentage:parseFloat(e.row.percentage),color:ge(e.row.status)},null,8,["percentage","color"])])),_:1})],64)):k("",!0)])),_:1},8,["data"])),[[A,le.value]]),a[53]||(a[53]=_()),R(b(j,{total:ne.value,page:ie.value.pageNum,"onUpdate:page":a[4]||(a[4]=e=>ie.value.pageNum=e),limit:ie.value.pageSize,"onUpdate:limit":a[5]||(a[5]=e=>ie.value.pageSize=e),onPagination:he},null,8,["total","page","limit"]),[[F,ne.value>0]])])])),_:1})])),_:1})])),_:1})])),_:1})])}}},[["__scopeId","data-v-bcc3e76f"]]);export{ae as default};
