var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,u=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&u(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&u(e,l,a[l]);return e},n=(e,t)=>a(e,l(t)),i=(e,a,l)=>new Promise(((t,o)=>{var s=e=>{try{r(l.next(e))}catch(a){o(a)}},u=e=>{try{r(l.throw(e))}catch(a){o(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,u);r((l=l.apply(e,a)).next())}));import{_ as c,u as d,f as p,h as m,i as v,j as f,k as g,l as h}from"./index-22381d63.js";import{_ as w}from"./index-50714a02.js";import{_}from"./index-473e483c.js";import{r as y,c as b,f as T,m as C,E as N,z as S,D as x,l as V,q as k,A as j,G as U,X as O,F as P,W as z,y as M,C as R}from"./vue-core-9ee4ed8b.js";import{O as I,a9 as q,al as D,Q as E,ab as F,ac as L,af as Q,ag as A,aj as G,ak as K,ah as W,ay as X,an as B,ap as H,aw as J,ao as Y,ax as Z,as as $}from"./element-plus-e2333c73.js";import"./icons-c547ea56.js";import"./utils-e59f4bae.js";const ee={class:"app-container"},ae={class:"selection-tips"},le={class:"highlight"},te={class:"highlight"},oe={class:"conflict-message"},se={key:0,class:"conflict-details"},ue={class:"dialog-footer"},re={class:"select-confirm-message"},ne={key:0,class:"course-info"},ie={class:"dialog-footer"},ce={class:"withdraw-confirm-message"},de={key:0,class:"course-info"},pe={class:"dialog-footer"},me=c({__name:"index",setup(e){const a=d();y(a.userId);const l=y(!1),t=y(!1),o=y(!0),s=y(0),u=y(0),c=y([]),me=y([]),ve=y("available"),fe=y(!1),ge=y(!1),he=y(!1),we=y(null),_e=y(null),ye=y(null),be=y(null),Te=y([{value:"必修",label:"必修课"},{value:"选修",label:"选修课"},{value:"公选",label:"公共选修课"},{value:"实践",label:"实践课"}]),Ce=y({selectedCount:0,selectedCredits:0,maxCourses:10,maxCredits:30,startTime:"2025-06-10 00:00:00",endTime:"2025-06-20 23:59:59",isSelectionTime:!0}),Ne=b((()=>Ce.value.isSelectionTime)),Se=y({pageNum:1,pageSize:10,courseName:void 0,courseType:void 0,creditsRange:void 0}),xe=y({pageNum:1,pageSize:10});function Ve(){l.value=!0,p(Se.value).then((e=>{if(e&&200===e.code&&e.data){const a=(e.data.rows||[]).map((e=>n(r({},e),{courseName:e.courseName||e.course_name,courseCode:e.courseCode||e.course_code,teacherName:e.teacherName||e.teacher_name,maxStudents:e.capacity||e.maxStudents,courseTime:e.class_time||e.classTime||e.courseTime,selectionStatus:void 0!==e.status?e.status:e.selectionStatus,location:e.location||e.classLocation,selectedCount:void 0!==e.selected_count?e.selected_count:e.selectedCount||0,courseType:void 0!==e.course_type?0===e.course_type?"必修":1===e.course_type?"选修":e.course_type:void 0!==e.courseType?0===e.courseType?"必修":1===e.courseType?"选修":e.courseType:"未知",credits:e.credits||e.credit||0,description:e.course_description||e.description||"",assessmentMethod:e.assessmentMethod||e.assessment_method||"笔试+平时考核"})));c.value=a,s.value=parseInt(e.data.total||0),0===c.value.length&&Se.value.pageNum>1&&(Se.value.pageNum=1,Ve())}else I.warning("获取可选课程失败: "+(e?e.msg:"未知错误")),c.value=[],s.value=0;l.value=!1})).catch((e=>{I.error("获取可选课程失败: "+(e.message||"服务器错误")),c.value=[],s.value=0,l.value=!1}))}function ke(){t.value=!0,m(xe.value).then((e=>{if(e&&200===e.code&&e.data){const a=(e.data.rows||[]).map((e=>n(r({},e),{courseName:e.courseName||e.course_name,courseCode:e.courseCode||e.course_code,teacherName:e.teacherName||e.teacher_name,courseTime:e.classTime||e.class_time||e.courseTime,selectionStatus:void 0!==e.status?e.status:e.selectionStatus||0,location:e.location||e.classLocation,selectedCount:void 0!==e.selected_count?e.selected_count:e.selectedCount||0,courseType:"number"==typeof e.courseType?0===e.courseType?"必修":1===e.courseType?"选修":e.courseType:"number"==typeof e.course_type?0===e.course_type?"必修":1===e.course_type?"选修":e.course_type:e.courseType||e.course_type||"未知",credits:e.credits||e.credit||0,assessmentMethod:e.assessmentMethod||e.assessment_method||"笔试+平时考核"})));me.value=a,u.value=parseInt(e.data.total||0),function(){const e=me.value.filter((e=>2!==e.selectionStatus));Ce.value.selectedCount=e.length,Ce.value.selectedCredits=e.reduce(((e,a)=>e+(a.credits||0)),0)}()}else I.warning("获取已选课程失败: "+(e?e.msg:"未知错误")),me.value=[],u.value=0;t.value=!1})).catch((e=>{I.error("获取已选课程失败: "+(e.message||"服务器错误")),me.value=[],u.value=0,t.value=!1}))}function je(){Se.value.pageNum=1,Ve()}function Ue(){Se.value={pageNum:1,pageSize:10,courseName:void 0,courseType:void 0,creditsRange:void 0},je()}function Oe(e){(function(e){return i(this,null,(function*(){try{if(!me.value||0===me.value.length)return!1;const l=me.value.filter((e=>2!==e.selectionStatus));if(0===l.length)return!1;const t=e.courseTime||e.class_time;if(!t)return!1;for(const o of l)try{const a=o.courseTime||o.class_time;if(!a)continue;const l=yield h({courseTime1:a,courseTime2:t});if(l&&200===l.code&&!0===l.data)return we.value=n(r({},e),{courseName:e.courseName||e.course_name,courseTime:t}),_e.value=n(r({},o),{courseName:o.courseName||o.course_name,courseTime:a}),fe.value=!0,!0}catch(a){I.error("检查课程时间冲突失败: "+(a.message||"系统异常，请联系管理员"))}return!1}catch(a){return I.error("检查课程冲突失败: "+(a.message||"系统异常，请联系管理员")),!1}}))})(e).then((a=>{a||(Me()?I.warning("已达到选课数量或学分上限，无法继续选课"):Ne.value?(ye.value=e,ge.value=!0):I.warning("当前不在选课时间范围内，无法进行选课操作"))})).catch((e=>{I.error("处理选课操作失败，请重试")}))}function Pe(){ye.value&&f(ye.value.id).then((e=>{I.success("选课成功"),ge.value=!1,Ve(),"selected"===ve.value&&ke()})).catch((e=>{I.error(e.message||"选课失败，请重试")}))}function ze(){be.value&&g(be.value.id).then((e=>{I.success("退选成功"),he.value=!1,ke()})).catch((e=>{I.error(e.message||"退选失败，请重试")}))}function Me(){const e=me.value.filter((e=>2!==e.selectionStatus));if(e.length>=Ce.value.maxCourses)return!0;return e.reduce(((e,a)=>e+(a.credits||0)),0)>=Ce.value.maxCredits}function Re(e){return 0===e.selectionStatus||1===e.selectionStatus}function Ie(){"available"===ve.value?Ve():"selected"===ve.value&&ke()}return T((()=>i(this,null,(function*(){try{yield void v().then((e=>{if(e&&200===e.code&&e.data){const a=e.data;Ce.value.maxCourses=a.maxCourses||10,Ce.value.maxCredits=a.maxCredits||30,Ce.value.startTime=a.startTime||"暂未设置",Ce.value.endTime=a.endTime||"暂未设置",Ce.value.isSelectionTime=void 0===a.isSelectionTime||a.isSelectionTime,Ce.value.currentSemester=a.currentSemester||"当前学期"}else I.warning("获取选课设置失败: "+(e?e.msg:"未知错误"))})).catch((e=>{I.error("获取选课设置失败: "+(e.message||"服务器错误"))})),Promise.all([Ve(),ke()]).catch((e=>{I.error("数据加载失败，请刷新页面重试")}))}catch(e){I.error("初始化选课设置失败，某些功能可能不可用")}})))),(e,a)=>{const r=F,n=L,i=Q,d=A,p=G,m=K,v=_,f=W,g=X,h=B,y=H,b=w,T=J,qe=Y,De=Z,Ee=q,Fe=D,Le=$;return V(),C("div",ee,[N(Ee,{class:"box-card"},{header:S((()=>a[15]||(a[15]=[k("div",{class:"card-header"},[k("span",null,"在线选课")],-1)]))),default:S((()=>[a[63]||(a[63]=x()),N(De,{modelValue:ve.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ve.value=e),onTabClick:Ie},{default:S((()=>[N(T,{label:"可选课程",name:"available"},{default:S((()=>[j(N(m,{model:Se.value,ref:"queryForm",inline:!0},{default:S((()=>[N(n,{label:"课程名称",prop:"courseName"},{default:S((()=>[N(r,{modelValue:Se.value.courseName,"onUpdate:modelValue":a[0]||(a[0]=e=>Se.value.courseName=e),placeholder:"请输入课程名称",clearable:"",onKeyup:O(je,["enter"])},null,8,["modelValue"])])),_:1}),a[23]||(a[23]=x()),N(n,{label:"课程类型",prop:"courseType"},{default:S((()=>[N(d,{modelValue:Se.value.courseType,"onUpdate:modelValue":a[1]||(a[1]=e=>Se.value.courseType=e),placeholder:"请选择课程类型",clearable:""},{default:S((()=>[(V(!0),C(P,null,z(Te.value,(e=>(V(),M(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),a[24]||(a[24]=x()),N(n,{label:"学分",prop:"creditsRange"},{default:S((()=>[N(d,{modelValue:Se.value.creditsRange,"onUpdate:modelValue":a[2]||(a[2]=e=>Se.value.creditsRange=e),placeholder:"请选择学分范围",clearable:""},{default:S((()=>[N(i,{label:"1学分",value:"1"}),a[16]||(a[16]=x()),N(i,{label:"2学分",value:"2"}),a[17]||(a[17]=x()),N(i,{label:"3学分",value:"3"}),a[18]||(a[18]=x()),N(i,{label:"4学分",value:"4"}),a[19]||(a[19]=x()),N(i,{label:"5学分及以上",value:"5+"})])),_:1},8,["modelValue"])])),_:1}),a[25]||(a[25]=x()),N(n,null,{default:S((()=>[N(p,{type:"primary",icon:"Search",onClick:je},{default:S((()=>a[20]||(a[20]=[x("搜索")]))),_:1}),a[22]||(a[22]=x()),N(p,{icon:"Refresh",onClick:Ue},{default:S((()=>a[21]||(a[21]=[x("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),[[U,o.value]]),a[47]||(a[47]=x()),N(f,{gutter:10,class:"mb8"},{default:S((()=>[N(v,{showSearch:o.value,"onUpdate:showSearch":a[3]||(a[3]=e=>o.value=e),onQueryTable:Ve},null,8,["showSearch"])])),_:1}),a[48]||(a[48]=x()),N(g,{title:"选课提示",type:"info",closable:!1,"show-icon":""},{default:S((()=>[k("div",ae,[k("p",null,[a[26]||(a[26]=x("1. 当前已选 ")),k("strong",le,E(Ce.value.selectedCount),1),a[27]||(a[27]=x(" 门课程，共 ")),k("strong",te,E(Ce.value.selectedCredits),1),a[28]||(a[28]=x(" 学分"))]),a[32]||(a[32]=x()),k("p",null,[a[29]||(a[29]=x("2. 本学期最多可选 ")),k("strong",null,E(Ce.value.maxCourses),1),a[30]||(a[30]=x(" 门课程，最多可选 ")),k("strong",null,E(Ce.value.maxCredits),1),a[31]||(a[31]=x(" 学分"))]),a[33]||(a[33]=x()),k("p",null,"3. 选课时间："+E(Ce.value.startTime)+" 至 "+E(Ce.value.endTime),1)])])),_:1}),a[49]||(a[49]=x()),j((V(),M(y,{data:c.value,style:{"margin-top":"15px"}},{default:S((()=>[N(h,{type:"expand"},{default:S((e=>[N(m,{"label-position":"left",inline:"",class:"course-detail-table"},{default:S((()=>[N(n,{label:"课程简介"},{default:S((()=>[k("span",null,E(e.row.description||"暂无课程简介"),1)])),_:2},1024),a[34]||(a[34]=x()),N(n,{label:"考核方式"},{default:S((()=>[k("span",null,E(e.row.assessmentMethod||"暂无考核方式信息"),1)])),_:2},1024)])),_:2},1024)])),_:1}),a[36]||(a[36]=x()),N(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120","show-overflow-tooltip":!0}),a[37]||(a[37]=x()),N(h,{label:"课程编码",align:"center",prop:"courseCode",width:"120"}),a[38]||(a[38]=x()),N(h,{label:"课程类型",align:"center",prop:"courseType",width:"100"}),a[39]||(a[39]=x()),N(h,{label:"学分",align:"center",prop:"credits",width:"80"}),a[40]||(a[40]=x()),N(h,{label:"授课教师",align:"center",prop:"teacherName",width:"100"}),a[41]||(a[41]=x()),N(h,{label:"上课地点",align:"center",prop:"location",width:"120","show-overflow-tooltip":!0}),a[42]||(a[42]=x()),N(h,{label:"上课时间",align:"center",prop:"courseTime","min-width":"120","show-overflow-tooltip":!0}),a[43]||(a[43]=x()),N(h,{label:"限选人数",align:"center",prop:"maxStudents",width:"90"}),a[44]||(a[44]=x()),N(h,{label:"已选人数",align:"center",width:"90"},{default:S((e=>[x(E(e.row.selected_count||e.row.selectedCount||0),1)])),_:1}),a[45]||(a[45]=x()),N(h,{label:"考核方式",align:"center",width:"120","show-overflow-tooltip":!0},{default:S((e=>[x(E(e.row.assessmentMethod||e.row.assessment_method||"笔试+平时考核"),1)])),_:1}),a[46]||(a[46]=x()),N(h,{label:"操作",align:"center",width:"120","class-name":"small-padding fixed-width"},{default:S((e=>[N(p,{type:"primary",disabled:!Ne.value||Me()||e.row.selected_count>=e.row.capacity,onClick:a=>Oe(e.row)},{default:S((()=>a[35]||(a[35]=[x("选课")]))),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"])),[[Le,l.value]]),a[50]||(a[50]=x()),j(N(b,{total:s.value,page:Se.value.pageNum,"onUpdate:page":a[4]||(a[4]=e=>Se.value.pageNum=e),limit:Se.value.pageSize,"onUpdate:limit":a[5]||(a[5]=e=>Se.value.pageSize=e),onPagination:Ve},null,8,["total","page","limit"]),[[U,s.value>0]])])),_:1}),a[62]||(a[62]=x()),N(T,{label:"已选课程",name:"selected"},{default:S((()=>[j((V(),M(y,{data:me.value},{default:S((()=>[N(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120","show-overflow-tooltip":!0}),a[52]||(a[52]=x()),N(h,{label:"课程编码",align:"center",prop:"courseCode",width:"120"}),a[53]||(a[53]=x()),N(h,{label:"课程类型",align:"center",prop:"courseType",width:"100"}),a[54]||(a[54]=x()),N(h,{label:"学分",align:"center",prop:"credits",width:"80"}),a[55]||(a[55]=x()),N(h,{label:"授课教师",align:"center",prop:"teacherName",width:"100"}),a[56]||(a[56]=x()),N(h,{label:"上课地点",align:"center",prop:"location",width:"120","show-overflow-tooltip":!0}),a[57]||(a[57]=x()),N(h,{label:"上课时间",align:"center",prop:"courseTime","min-width":"120","show-overflow-tooltip":!0}),a[58]||(a[58]=x()),N(h,{label:"考核方式",align:"center",width:"120","show-overflow-tooltip":!0},{default:S((e=>[x(E(e.row.assessmentMethod||e.row.assessment_method||"笔试+平时考核"),1)])),_:1}),a[59]||(a[59]=x()),N(h,{label:"选课状态",align:"center",prop:"selectionStatus",width:"100"},{default:S((e=>[N(qe,{type:0===e.row.selectionStatus?"warning":1===e.row.selectionStatus?"success":"info"},{default:S((()=>[x(E(0===e.row.selectionStatus?"待审核":1===e.row.selectionStatus?"已确认":"已退选"),1)])),_:2},1032,["type"])])),_:1}),a[60]||(a[60]=x()),N(h,{label:"操作",align:"center",width:"180","class-name":"small-padding fixed-width"},{default:S((e=>[N(p,{type:"danger",disabled:!Re(e.row)||!Ne.value,onClick:a=>{var l;Re(l=e.row)?Ne.value?(be.value=l,he.value=!0):I.warning("当前不在选课时间范围内，无法进行退选操作"):I.warning("该课程状态不允许退选")}},{default:S((()=>a[51]||(a[51]=[x("退选")]))),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"])),[[Le,t.value]]),a[61]||(a[61]=x()),j(N(b,{total:u.value,page:xe.value.pageNum,"onUpdate:page":a[6]||(a[6]=e=>xe.value.pageNum=e),limit:xe.value.pageSize,"onUpdate:limit":a[7]||(a[7]=e=>xe.value.pageSize=e),onPagination:ke},null,8,["total","page","limit"]),[[U,u.value>0]])])),_:1})])),_:1},8,["modelValue"])])),_:1}),a[101]||(a[101]=x()),N(Fe,{title:"选课冲突提示",modelValue:fe.value,"onUpdate:modelValue":a[10]||(a[10]=e=>fe.value=e),width:"500px"},{footer:S((()=>[k("div",ue,[N(p,{type:"primary",onClick:a[9]||(a[9]=e=>fe.value=!1)},{default:S((()=>a[70]||(a[70]=[x("我知道了")]))),_:1})])])),default:S((()=>[k("div",oe,[N(g,{title:"选课冲突",type:"error",description:"以下课程与您已选课程存在时间冲突，无法选择：",closable:!1,"show-icon":""}),a[69]||(a[69]=x()),we.value?(V(),C("div",se,[k("p",null,[a[64]||(a[64]=k("strong",null,"冲突课程：",-1)),x(E(we.value.courseName||we.value.course_name),1)]),a[67]||(a[67]=x()),k("p",null,[a[65]||(a[65]=k("strong",null,"上课时间：",-1)),x(E(we.value.courseTime||we.value.class_time),1)]),a[68]||(a[68]=x()),k("p",null,[a[66]||(a[66]=k("strong",null,"冲突原因：",-1)),x("与已选课程《"+E(_e.value.courseName||_e.value.course_name)+"》在时间上存在冲突",1)])])):R("",!0)]),a[71]||(a[71]=x())])),_:1},8,["modelValue"]),a[102]||(a[102]=x()),N(Fe,{title:"选课确认",modelValue:ge.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ge.value=e),width:"500px"},{footer:S((()=>[k("div",ie,[N(p,{onClick:a[11]||(a[11]=e=>ge.value=!1)},{default:S((()=>a[85]||(a[85]=[x("取消")]))),_:1}),a[87]||(a[87]=x()),N(p,{type:"primary",onClick:Pe},{default:S((()=>a[86]||(a[86]=[x("确认选课")]))),_:1})])])),default:S((()=>[k("div",re,[a[83]||(a[83]=k("p",null,"您确定要选择以下课程吗？",-1)),a[84]||(a[84]=x()),ye.value?(V(),C("div",ne,[k("p",null,[a[72]||(a[72]=k("strong",null,"课程名称：",-1)),x(E(ye.value.courseName),1)]),a[78]||(a[78]=x()),k("p",null,[a[73]||(a[73]=k("strong",null,"课程编码：",-1)),x(E(ye.value.courseCode),1)]),a[79]||(a[79]=x()),k("p",null,[a[74]||(a[74]=k("strong",null,"学分：",-1)),x(E(ye.value.credits),1)]),a[80]||(a[80]=x()),k("p",null,[a[75]||(a[75]=k("strong",null,"上课时间：",-1)),x(E(ye.value.courseTime),1)]),a[81]||(a[81]=x()),k("p",null,[a[76]||(a[76]=k("strong",null,"上课地点：",-1)),x(E(ye.value.location),1)]),a[82]||(a[82]=x()),k("p",null,[a[77]||(a[77]=k("strong",null,"授课教师：",-1)),x(E(ye.value.teacherName),1)])])):R("",!0)]),a[88]||(a[88]=x())])),_:1},8,["modelValue"]),a[103]||(a[103]=x()),N(Fe,{title:"退选确认",modelValue:he.value,"onUpdate:modelValue":a[14]||(a[14]=e=>he.value=e),width:"500px"},{footer:S((()=>[k("div",pe,[N(p,{onClick:a[13]||(a[13]=e=>he.value=!1)},{default:S((()=>a[97]||(a[97]=[x("取消")]))),_:1}),a[99]||(a[99]=x()),N(p,{type:"danger",onClick:ze},{default:S((()=>a[98]||(a[98]=[x("确认退选")]))),_:1})])])),default:S((()=>[k("div",ce,[N(g,{title:"退选提醒",type:"warning",description:"退选后如果再次选择该课程，将重新进入审核状态，且可能因课程已满而无法选择。",closable:!1,"show-icon":""}),a[96]||(a[96]=x()),be.value?(V(),C("div",de,[k("p",null,[a[89]||(a[89]=k("strong",null,"课程名称：",-1)),x(E(be.value.courseName),1)]),a[93]||(a[93]=x()),k("p",null,[a[90]||(a[90]=k("strong",null,"课程编码：",-1)),x(E(be.value.courseCode),1)]),a[94]||(a[94]=x()),k("p",null,[a[91]||(a[91]=k("strong",null,"学分：",-1)),x(E(be.value.credits),1)]),a[95]||(a[95]=x()),k("p",null,[a[92]||(a[92]=k("strong",null,"上课时间：",-1)),x(E(be.value.courseTime),1)])])):R("",!0)]),a[100]||(a[100]=x())])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-4167c4f6"]]);export{me as default};
