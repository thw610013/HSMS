var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,u=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&u(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&u(e,l,a[l]);return e},n=(e,t)=>a(e,l(t)),i=(e,a,l)=>new Promise((t,o)=>{var s=e=>{try{r(l.next(e))}catch(a){o(a)}},u=e=>{try{r(l.throw(e))}catch(a){o(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,u);r((l=l.apply(e,a)).next())});import{_ as c,u as d,f as p,h as m,i as v,j as f,k as g,l as h}from"./index-1c6f2b30.js";import{_ as w}from"./index-db7beee4.js";import{_}from"./index-292e5414.js";import{r as b,c as y,f as T,l as C,m as N,E as S,z as x,q as V,D as k,A as j,G as U,X as O,F as P,W as z,y as M,C as R}from"./vue-core-d6f028e5.js";import{O as I,Q as q,aa as D,ab as E,ae as F,af as L,ai as Q,aj as A,ag as G,ay as K,am as W,ao as X,aw as B,an as H,ax as J,ak as Y,aq as Z,as as $}from"./element-plus-33c96ec5.js";import"./icons-02de347c.js";import"./utils-80dc1c42.js";const ee={class:"app-container"},ae={class:"selection-tips"},le={class:"highlight"},te={class:"highlight"},oe={class:"conflict-message"},se={key:0,class:"conflict-details"},ue={class:"dialog-footer"},re={class:"select-confirm-message"},ne={key:0,class:"course-info"},ie={class:"dialog-footer"},ce={class:"withdraw-confirm-message"},de={key:0,class:"course-info"},pe={class:"dialog-footer"},me=c({__name:"index",setup(e){const a=d();b(a.userId);const l=b(!1),t=b(!1),o=b(!0),s=b(0),u=b(0),c=b([]),me=b([]),ve=b("available"),fe=b(!1),ge=b(!1),he=b(!1),we=b(null),_e=b(null),be=b(null),ye=b(null),Te=b([{value:"必修",label:"必修课"},{value:"选修",label:"选修课"},{value:"公选",label:"公共选修课"},{value:"实践",label:"实践课"}]),Ce=b({selectedCount:0,selectedCredits:0,maxCourses:10,maxCredits:30,startTime:"2025-06-10 00:00:00",endTime:"2025-06-20 23:59:59",isSelectionTime:!0}),Ne=y(()=>Ce.value.isSelectionTime),Se=b({pageNum:1,pageSize:10,courseName:void 0,courseType:void 0,creditsRange:void 0}),xe=b({pageNum:1,pageSize:10});function Ve(){l.value=!0,p(Se.value).then(e=>{if(e&&200===e.code&&e.data){const a=(e.data.rows||[]).map(e=>n(r({},e),{courseName:e.courseName||e.course_name,courseCode:e.courseCode||e.course_code,teacherName:e.teacherName||e.teacher_name,maxStudents:e.capacity||e.maxStudents,courseTime:e.class_time||e.classTime||e.courseTime,selectionStatus:void 0!==e.status?e.status:e.selectionStatus,location:e.location||e.classLocation,selectedCount:void 0!==e.selected_count?e.selected_count:e.selectedCount||0,courseType:void 0!==e.course_type?0===e.course_type?"必修":1===e.course_type?"选修":e.course_type:void 0!==e.courseType?0===e.courseType?"必修":1===e.courseType?"选修":e.courseType:"未知",credits:e.credits||e.credit||0,description:e.course_description||e.description||"",assessmentMethod:e.assessmentMethod||e.assessment_method||"笔试+平时考核"}));c.value=a,s.value=parseInt(e.data.total||0),0===c.value.length&&Se.value.pageNum>1&&(Se.value.pageNum=1,Ve())}else I.warning("获取可选课程失败: "+(e?e.msg:"未知错误")),c.value=[],s.value=0;l.value=!1}).catch(e=>{I.error("获取可选课程失败: "+(e.message||"服务器错误")),c.value=[],s.value=0,l.value=!1})}function ke(){t.value=!0,m(xe.value).then(e=>{if(e&&200===e.code&&e.data){const a=(e.data.rows||[]).map(e=>n(r({},e),{courseName:e.courseName||e.course_name,courseCode:e.courseCode||e.course_code,teacherName:e.teacherName||e.teacher_name,courseTime:e.classTime||e.class_time||e.courseTime,selectionStatus:void 0!==e.status?e.status:e.selectionStatus||0,location:e.location||e.classLocation,selectedCount:void 0!==e.selected_count?e.selected_count:e.selectedCount||0,courseType:"number"==typeof e.courseType?0===e.courseType?"必修":1===e.courseType?"选修":e.courseType:"number"==typeof e.course_type?0===e.course_type?"必修":1===e.course_type?"选修":e.course_type:e.courseType||e.course_type||"未知",credits:e.credits||e.credit||0,assessmentMethod:e.assessmentMethod||e.assessment_method||"笔试+平时考核"}));me.value=a,u.value=parseInt(e.data.total||0),function(){const e=me.value.filter(e=>2!==e.selectionStatus);Ce.value.selectedCount=e.length,Ce.value.selectedCredits=e.reduce((e,a)=>e+(a.credits||0),0)}()}else I.warning("获取已选课程失败: "+(e?e.msg:"未知错误")),me.value=[],u.value=0;t.value=!1}).catch(e=>{I.error("获取已选课程失败: "+(e.message||"服务器错误")),me.value=[],u.value=0,t.value=!1})}function je(){Se.value.pageNum=1,Ve()}function Ue(){Se.value={pageNum:1,pageSize:10,courseName:void 0,courseType:void 0,creditsRange:void 0},je()}function Oe(e){(function(e){return i(this,null,function*(){try{if(!me.value||0===me.value.length)return!1;const l=me.value.filter(e=>2!==e.selectionStatus);if(0===l.length)return!1;const t=e.courseTime||e.class_time;if(!t)return!1;for(const o of l)try{const a=o.courseTime||o.class_time;if(!a)continue;const l=yield h({courseTime1:a,courseTime2:t});if(l&&200===l.code&&!0===l.data)return we.value=n(r({},e),{courseName:e.courseName||e.course_name,courseTime:t}),_e.value=n(r({},o),{courseName:o.courseName||o.course_name,courseTime:a}),fe.value=!0,!0}catch(a){I.error("检查课程时间冲突失败: "+(a.message||"系统异常，请联系管理员"))}return!1}catch(a){return I.error("检查课程冲突失败: "+(a.message||"系统异常，请联系管理员")),!1}})})(e).then(a=>{a||(Me()?I.warning("已达到选课数量或学分上限，无法继续选课"):Ne.value?(be.value=e,ge.value=!0):I.warning("当前不在选课时间范围内，无法进行选课操作"))}).catch(e=>{I.error("处理选课操作失败，请重试")})}function Pe(){be.value&&f(be.value.id).then(e=>{I.success("选课成功"),ge.value=!1,Ve(),"selected"===ve.value&&ke()}).catch(e=>{I.error(e.message||"选课失败，请重试")})}function ze(){ye.value&&g(ye.value.id).then(e=>{I.success("退选成功"),he.value=!1,ke()}).catch(e=>{I.error(e.message||"退选失败，请重试")})}function Me(){const e=me.value.filter(e=>2!==e.selectionStatus);if(e.length>=Ce.value.maxCourses)return!0;return e.reduce((e,a)=>e+(a.credits||0),0)>=Ce.value.maxCredits}function Re(e){return 0===e.selectionStatus||1===e.selectionStatus}function Ie(){"available"===ve.value?Ve():"selected"===ve.value&&ke()}return T(()=>i(this,null,function*(){try{yield void v().then(e=>{if(e&&200===e.code&&e.data){const a=e.data;Ce.value.maxCourses=a.maxCourses||10,Ce.value.maxCredits=a.maxCredits||30,Ce.value.startTime=a.startTime||"暂未设置",Ce.value.endTime=a.endTime||"暂未设置",Ce.value.isSelectionTime=void 0===a.isSelectionTime||a.isSelectionTime,Ce.value.currentSemester=a.currentSemester||"当前学期"}else I.warning("获取选课设置失败: "+(e?e.msg:"未知错误"))}).catch(e=>{I.error("获取选课设置失败: "+(e.message||"服务器错误"))}),Promise.all([Ve(),ke()]).catch(e=>{I.error("数据加载失败，请刷新页面重试")})}catch(e){I.error("初始化选课设置失败，某些功能可能不可用")}})),(e,a)=>{const r=D,n=E,i=F,d=L,p=Q,m=A,v=_,f=G,g=K,h=W,b=X,y=w,T=B,qe=H,De=J,Ee=Y,Fe=Z,Le=$;return C(),N("div",ee,[S(Ee,{class:"box-card"},{header:x(()=>a[15]||(a[15]=[V("div",{class:"card-header"},[V("span",null,"在线选课")],-1)])),default:x(()=>[a[63]||(a[63]=k()),S(De,{modelValue:ve.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ve.value=e),onTabClick:Ie},{default:x(()=>[S(T,{label:"可选课程",name:"available"},{default:x(()=>[j(S(m,{model:Se.value,ref:"queryForm",inline:!0},{default:x(()=>[S(n,{label:"课程名称",prop:"courseName"},{default:x(()=>[S(r,{modelValue:Se.value.courseName,"onUpdate:modelValue":a[0]||(a[0]=e=>Se.value.courseName=e),placeholder:"请输入课程名称",clearable:"",onKeyup:O(je,["enter"])},null,8,["modelValue"])]),_:1}),a[23]||(a[23]=k()),S(n,{label:"课程类型",prop:"courseType"},{default:x(()=>[S(d,{modelValue:Se.value.courseType,"onUpdate:modelValue":a[1]||(a[1]=e=>Se.value.courseType=e),placeholder:"请选择课程类型",clearable:""},{default:x(()=>[(C(!0),N(P,null,z(Te.value,e=>(C(),M(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[24]||(a[24]=k()),S(n,{label:"学分",prop:"creditsRange"},{default:x(()=>[S(d,{modelValue:Se.value.creditsRange,"onUpdate:modelValue":a[2]||(a[2]=e=>Se.value.creditsRange=e),placeholder:"请选择学分范围",clearable:""},{default:x(()=>[S(i,{label:"1学分",value:"1"}),a[16]||(a[16]=k()),S(i,{label:"2学分",value:"2"}),a[17]||(a[17]=k()),S(i,{label:"3学分",value:"3"}),a[18]||(a[18]=k()),S(i,{label:"4学分",value:"4"}),a[19]||(a[19]=k()),S(i,{label:"5学分及以上",value:"5+"})]),_:1},8,["modelValue"])]),_:1}),a[25]||(a[25]=k()),S(n,null,{default:x(()=>[S(p,{type:"primary",icon:"Search",onClick:je},{default:x(()=>a[20]||(a[20]=[k("搜索")])),_:1}),a[22]||(a[22]=k()),S(p,{icon:"Refresh",onClick:Ue},{default:x(()=>a[21]||(a[21]=[k("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[U,o.value]]),a[47]||(a[47]=k()),S(f,{gutter:10,class:"mb8"},{default:x(()=>[S(v,{showSearch:o.value,"onUpdate:showSearch":a[3]||(a[3]=e=>o.value=e),onQueryTable:Ve},null,8,["showSearch"])]),_:1}),a[48]||(a[48]=k()),S(g,{title:"选课提示",type:"info",closable:!1,"show-icon":""},{default:x(()=>[V("div",ae,[V("p",null,[a[26]||(a[26]=k("1. 当前已选 ")),V("strong",le,q(Ce.value.selectedCount),1),a[27]||(a[27]=k(" 门课程，共 ")),V("strong",te,q(Ce.value.selectedCredits),1),a[28]||(a[28]=k(" 学分"))]),a[32]||(a[32]=k()),V("p",null,[a[29]||(a[29]=k("2. 本学期最多可选 ")),V("strong",null,q(Ce.value.maxCourses),1),a[30]||(a[30]=k(" 门课程，最多可选 ")),V("strong",null,q(Ce.value.maxCredits),1),a[31]||(a[31]=k(" 学分"))]),a[33]||(a[33]=k()),V("p",null,"3. 选课时间："+q(Ce.value.startTime)+" 至 "+q(Ce.value.endTime),1)])]),_:1}),a[49]||(a[49]=k()),j((C(),M(b,{data:c.value,style:{"margin-top":"15px"}},{default:x(()=>[S(h,{type:"expand"},{default:x(e=>[S(m,{"label-position":"left",inline:"",class:"course-detail-table"},{default:x(()=>[S(n,{label:"课程简介"},{default:x(()=>[V("span",null,q(e.row.description||"暂无课程简介"),1)]),_:2},1024),a[34]||(a[34]=k()),S(n,{label:"考核方式"},{default:x(()=>[V("span",null,q(e.row.assessmentMethod||"暂无考核方式信息"),1)]),_:2},1024)]),_:2},1024)]),_:1}),a[36]||(a[36]=k()),S(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120","show-overflow-tooltip":!0}),a[37]||(a[37]=k()),S(h,{label:"课程编码",align:"center",prop:"courseCode",width:"120"}),a[38]||(a[38]=k()),S(h,{label:"课程类型",align:"center",prop:"courseType",width:"100"}),a[39]||(a[39]=k()),S(h,{label:"学分",align:"center",prop:"credits",width:"80"}),a[40]||(a[40]=k()),S(h,{label:"授课教师",align:"center",prop:"teacherName",width:"100"}),a[41]||(a[41]=k()),S(h,{label:"上课地点",align:"center",prop:"location",width:"120","show-overflow-tooltip":!0}),a[42]||(a[42]=k()),S(h,{label:"上课时间",align:"center",prop:"courseTime","min-width":"120","show-overflow-tooltip":!0}),a[43]||(a[43]=k()),S(h,{label:"限选人数",align:"center",prop:"maxStudents",width:"90"}),a[44]||(a[44]=k()),S(h,{label:"已选人数",align:"center",width:"90"},{default:x(e=>[k(q(e.row.selected_count||e.row.selectedCount||0),1)]),_:1}),a[45]||(a[45]=k()),S(h,{label:"考核方式",align:"center",width:"120","show-overflow-tooltip":!0},{default:x(e=>[k(q(e.row.assessmentMethod||e.row.assessment_method||"笔试+平时考核"),1)]),_:1}),a[46]||(a[46]=k()),S(h,{label:"操作",align:"center",width:"120","class-name":"small-padding fixed-width"},{default:x(e=>[S(p,{type:"primary",disabled:!Ne.value||Me()||e.row.selected_count>=e.row.capacity,onClick:a=>Oe(e.row)},{default:x(()=>a[35]||(a[35]=[k("选课")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[Le,l.value]]),a[50]||(a[50]=k()),j(S(y,{total:s.value,page:Se.value.pageNum,"onUpdate:page":a[4]||(a[4]=e=>Se.value.pageNum=e),limit:Se.value.pageSize,"onUpdate:limit":a[5]||(a[5]=e=>Se.value.pageSize=e),onPagination:Ve},null,8,["total","page","limit"]),[[U,s.value>0]])]),_:1}),a[62]||(a[62]=k()),S(T,{label:"已选课程",name:"selected"},{default:x(()=>[j((C(),M(b,{data:me.value},{default:x(()=>[S(h,{label:"课程名称",align:"center",prop:"courseName","min-width":"120","show-overflow-tooltip":!0}),a[52]||(a[52]=k()),S(h,{label:"课程编码",align:"center",prop:"courseCode",width:"120"}),a[53]||(a[53]=k()),S(h,{label:"课程类型",align:"center",prop:"courseType",width:"100"}),a[54]||(a[54]=k()),S(h,{label:"学分",align:"center",prop:"credits",width:"80"}),a[55]||(a[55]=k()),S(h,{label:"授课教师",align:"center",prop:"teacherName",width:"100"}),a[56]||(a[56]=k()),S(h,{label:"上课地点",align:"center",prop:"location",width:"120","show-overflow-tooltip":!0}),a[57]||(a[57]=k()),S(h,{label:"上课时间",align:"center",prop:"courseTime","min-width":"120","show-overflow-tooltip":!0}),a[58]||(a[58]=k()),S(h,{label:"考核方式",align:"center",width:"120","show-overflow-tooltip":!0},{default:x(e=>[k(q(e.row.assessmentMethod||e.row.assessment_method||"笔试+平时考核"),1)]),_:1}),a[59]||(a[59]=k()),S(h,{label:"选课状态",align:"center",prop:"selectionStatus",width:"100"},{default:x(e=>[S(qe,{type:0===e.row.selectionStatus?"warning":1===e.row.selectionStatus?"success":"info"},{default:x(()=>[k(q(0===e.row.selectionStatus?"待审核":1===e.row.selectionStatus?"已确认":"已退选"),1)]),_:2},1032,["type"])]),_:1}),a[60]||(a[60]=k()),S(h,{label:"操作",align:"center",width:"180","class-name":"small-padding fixed-width"},{default:x(e=>[S(p,{type:"danger",disabled:!Re(e.row)||!Ne.value,onClick:a=>{var l;Re(l=e.row)?Ne.value?(ye.value=l,he.value=!0):I.warning("当前不在选课时间范围内，无法进行退选操作"):I.warning("该课程状态不允许退选")}},{default:x(()=>a[51]||(a[51]=[k("退选")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[Le,t.value]]),a[61]||(a[61]=k()),j(S(y,{total:u.value,page:xe.value.pageNum,"onUpdate:page":a[6]||(a[6]=e=>xe.value.pageNum=e),limit:xe.value.pageSize,"onUpdate:limit":a[7]||(a[7]=e=>xe.value.pageSize=e),onPagination:ke},null,8,["total","page","limit"]),[[U,u.value>0]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[101]||(a[101]=k()),S(Fe,{title:"选课冲突提示",modelValue:fe.value,"onUpdate:modelValue":a[10]||(a[10]=e=>fe.value=e),width:"500px"},{footer:x(()=>[V("div",ue,[S(p,{type:"primary",onClick:a[9]||(a[9]=e=>fe.value=!1)},{default:x(()=>a[70]||(a[70]=[k("我知道了")])),_:1})])]),default:x(()=>[V("div",oe,[S(g,{title:"选课冲突",type:"error",description:"以下课程与您已选课程存在时间冲突，无法选择：",closable:!1,"show-icon":""}),a[69]||(a[69]=k()),we.value?(C(),N("div",se,[V("p",null,[a[64]||(a[64]=V("strong",null,"冲突课程：",-1)),k(q(we.value.courseName||we.value.course_name),1)]),a[67]||(a[67]=k()),V("p",null,[a[65]||(a[65]=V("strong",null,"上课时间：",-1)),k(q(we.value.courseTime||we.value.class_time),1)]),a[68]||(a[68]=k()),V("p",null,[a[66]||(a[66]=V("strong",null,"冲突原因：",-1)),k("与已选课程《"+q(_e.value.courseName||_e.value.course_name)+"》在时间上存在冲突",1)])])):R("",!0)]),a[71]||(a[71]=k())]),_:1},8,["modelValue"]),a[102]||(a[102]=k()),S(Fe,{title:"选课确认",modelValue:ge.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ge.value=e),width:"500px"},{footer:x(()=>[V("div",ie,[S(p,{onClick:a[11]||(a[11]=e=>ge.value=!1)},{default:x(()=>a[85]||(a[85]=[k("取消")])),_:1}),a[87]||(a[87]=k()),S(p,{type:"primary",onClick:Pe},{default:x(()=>a[86]||(a[86]=[k("确认选课")])),_:1})])]),default:x(()=>[V("div",re,[a[83]||(a[83]=V("p",null,"您确定要选择以下课程吗？",-1)),a[84]||(a[84]=k()),be.value?(C(),N("div",ne,[V("p",null,[a[72]||(a[72]=V("strong",null,"课程名称：",-1)),k(q(be.value.courseName),1)]),a[78]||(a[78]=k()),V("p",null,[a[73]||(a[73]=V("strong",null,"课程编码：",-1)),k(q(be.value.courseCode),1)]),a[79]||(a[79]=k()),V("p",null,[a[74]||(a[74]=V("strong",null,"学分：",-1)),k(q(be.value.credits),1)]),a[80]||(a[80]=k()),V("p",null,[a[75]||(a[75]=V("strong",null,"上课时间：",-1)),k(q(be.value.courseTime),1)]),a[81]||(a[81]=k()),V("p",null,[a[76]||(a[76]=V("strong",null,"上课地点：",-1)),k(q(be.value.location),1)]),a[82]||(a[82]=k()),V("p",null,[a[77]||(a[77]=V("strong",null,"授课教师：",-1)),k(q(be.value.teacherName),1)])])):R("",!0)]),a[88]||(a[88]=k())]),_:1},8,["modelValue"]),a[103]||(a[103]=k()),S(Fe,{title:"退选确认",modelValue:he.value,"onUpdate:modelValue":a[14]||(a[14]=e=>he.value=e),width:"500px"},{footer:x(()=>[V("div",pe,[S(p,{onClick:a[13]||(a[13]=e=>he.value=!1)},{default:x(()=>a[97]||(a[97]=[k("取消")])),_:1}),a[99]||(a[99]=k()),S(p,{type:"danger",onClick:ze},{default:x(()=>a[98]||(a[98]=[k("确认退选")])),_:1})])]),default:x(()=>[V("div",ce,[S(g,{title:"退选提醒",type:"warning",description:"退选后如果再次选择该课程，将重新进入审核状态，且可能因课程已满而无法选择。",closable:!1,"show-icon":""}),a[96]||(a[96]=k()),ye.value?(C(),N("div",de,[V("p",null,[a[89]||(a[89]=V("strong",null,"课程名称：",-1)),k(q(ye.value.courseName),1)]),a[93]||(a[93]=k()),V("p",null,[a[90]||(a[90]=V("strong",null,"课程编码：",-1)),k(q(ye.value.courseCode),1)]),a[94]||(a[94]=k()),V("p",null,[a[91]||(a[91]=V("strong",null,"学分：",-1)),k(q(ye.value.credits),1)]),a[95]||(a[95]=k()),V("p",null,[a[92]||(a[92]=V("strong",null,"上课时间：",-1)),k(q(ye.value.courseTime),1)])])):R("",!0)]),a[100]||(a[100]=k())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-4167c4f6"]]);export{me as default};
