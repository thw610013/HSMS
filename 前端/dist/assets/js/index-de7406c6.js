var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,u=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{s as r}from"./index-22381d63.js";import{_ as i}from"./index-50714a02.js";import{_ as n}from"./index-473e483c.js";import{r as v,c as s,f as c,m,E as p,z as f,ab as h,l as b,q as g,D as y,A as _,G as j,X as w,F as V,W as I,y as k}from"./vue-core-9ee4ed8b.js";import{g as x,a as U}from"./major-bad1c4ee.js";import{a9 as C,O as N,P as O,ab as S,ac as P,ag as q,aj as z,ak as D,ad as T,ah as A,an as E,ap as F,al as B,as as K,af as $}from"./element-plus-e2333c73.js";import"./icons-c547ea56.js";import"./utils-e59f4bae.js";const G={class:"app-container"},Q={class:"dialog-footer"},R={__name:"index",setup(e){const R=v(!1),W=v([]),X=s((()=>1!==W.value.length)),H=s((()=>0===W.value.length)),J=v(!0),L=v(0),M=v([]),Y=v(""),Z=v(!1),ee=v([]),ae=v(["2020","2021","2022","2023","2024","2025"]),le=v([]),oe=v(!1),de=v({pageNum:1,pageSize:10,name:void 0,code:void 0,majorId:void 0,grade:void 0}),te=v({id:void 0,name:void 0,code:void 0,majorId:void 0,grade:void 0,advisorId:void 0}),ue={name:[{required:!0,message:"班级名称不能为空",trigger:"blur"}],code:[{required:!0,message:"班级编码不能为空",trigger:"blur"}],majorId:[{required:!0,message:"所属专业不能为空",trigger:"change"}],grade:[{required:!0,message:"年级不能为空",trigger:"change"}]},re=v(null);function ie(){var e;R.value=!0,(e=de.value,r({url:"/student/class/list",method:"get",params:e})).then((e=>{M.value=e.data.records,L.value=e.data.total,R.value=!1})).catch((()=>{R.value=!1}))}function ne(e){""!==e?(oe.value=!0,function(e){return r({url:"/student/class/list/teachers",method:"get",params:e})}({name:e}).then((e=>{try{200===e.code&&e.data?le.value=(e.data||[]).filter((e=>e&&"object"==typeof e&&(void 0!==e.value||void 0!==e.id)&&(void 0!==e.label||void 0!==e.name))).map((e=>({value:e.value||e.id,label:e.label||e.name}))):le.value=[]}catch(a){le.value=[]}finally{oe.value=!1}})).catch((e=>{le.value=[],oe.value=!1}))):ye()}function ve(){de.value.pageNum=1,ie()}function se(){de.value={pageNum:1,pageSize:10,name:void 0,code:void 0,majorId:void 0,grade:void 0},ve()}function ce(e){W.value=e.map((e=>e.id))}function me(){be(),Y.value="添加班级",Z.value=!0}function pe(e){be();(function(e){return r({url:`/student/class/${e}`,method:"get"})})(e.id||W.value[0]).then((e=>{try{if(200===e.code&&e.data){if(te.value=e.data,te.value.advisorId&&te.value.advisorName){le.value&&Array.isArray(le.value)||(le.value=[]);let e=!1;for(const a of le.value)if(a&&"object"==typeof a&&a.value===te.value.advisorId){e=!0;break}e||le.value.push({value:te.value.advisorId,label:te.value.advisorName})}Y.value="修改班级",Z.value=!0}else N.error(e.msg||"获取班级详情失败")}catch(a){N.error("处理班级详情数据失败")}})).catch((e=>{N.error("获取班级详情失败，请稍后重试")}))}function fe(){var e;null==(e=re.value)||e.validate((e=>{if(e)try{const e=(n=((e,a)=>{for(var l in a||(a={}))d.call(a,l)&&u(e,l,a[l]);if(o)for(var l of o(a))t.call(a,l)&&u(e,l,a[l]);return e})({},te.value),v={id:te.value.id?Number(te.value.id):void 0,majorId:te.value.majorId?Number(te.value.majorId):void 0,advisorId:te.value.advisorId?Number(te.value.advisorId):null},a(n,l(v)));e.id?(i=e,r({url:"/student/class",method:"put",data:i})).then((e=>{200===e.code?(N.success("修改成功"),Z.value=!1,ie()):N.error(e.msg||"修改失败")})).catch((e=>{N.error("修改失败，请稍后重试")})):function(e){return r({url:"/student/class",method:"post",data:e})}(e).then((e=>{200===e.code?(N.success("新增成功"),Z.value=!1,ie()):N.error(e.msg||"新增失败")})).catch((e=>{N.error("新增失败，请稍后重试")}))}catch(s){N.error("表单提交失败，请稍后重试")}var i,n,v}))}function he(e){const a=e.id||W.value;O.confirm("确认删除选中的班级信息?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var e;(e=a,r({url:`/student/class/${e}`,method:"delete"})).then((()=>{N.success("删除成功"),ie()}))}))}function be(){var e;te.value={id:void 0,name:void 0,code:void 0,majorId:void 0,grade:void 0,advisorId:void 0},null==(e=re.value)||e.resetFields()}function ge(){Z.value=!1,be()}function ye(){oe.value=!0,le.value=[],r({url:"/student/class/all/teachers",method:"get"}).then((e=>{try{200===e.code&&e.data&&(le.value=e.data.filter((e=>e&&(e.value||e.id))).map((e=>({value:e.value||e.id,label:e.label||e.name}))))}catch(a){}finally{oe.value=!1}})).catch((e=>{oe.value=!1}))}return c((()=>{ie(),ee.value=[],x().then((e=>{try{200===e.code&&e.data&&e.data.length>0?ee.value=e.data.filter((e=>e&&"object"==typeof e&&void 0!==e.value&&void 0!==e.label)).map((e=>({value:e.value,label:e.label}))):U().then((e=>{200===e.code&&e.data?ee.value=e.data.filter((e=>e&&"object"==typeof e&&void 0!==e.id&&void 0!==e.name)).map((e=>({value:e.id,label:e.name}))):ee.value=[]})).catch((e=>{ee.value=[]}))}catch(a){ee.value=[]}})).catch((e=>{U().then((e=>{try{200===e.code&&e.data?ee.value=e.data.filter((e=>e&&"object"==typeof e&&void 0!==e.id&&void 0!==e.name)).map((e=>({value:e.id,label:e.name}))):ee.value=[]}catch(a){ee.value=[]}})).catch((()=>{ee.value=[]}))})),ye(),setTimeout((()=>{ee.value=[...ee.value]}),1e3)})),(e,a)=>{const l=S,o=P,d=$,t=q,u=z,r=D,v=T,s=n,c=A,x=E,U=F,N=i,O=B,W=C,be=h("hasPermi"),ye=K;return b(),m("div",G,[p(W,{class:"box-card"},{header:f((()=>a[13]||(a[13]=[g("div",{class:"card-header"},[g("span",null,"班级管理")],-1)]))),default:f((()=>[a[46]||(a[46]=y()),_(p(r,{model:de.value,ref:"queryForm",inline:!0},{default:f((()=>[p(o,{label:"班级名称",prop:"name"},{default:f((()=>[p(l,{modelValue:de.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>de.value.name=e),placeholder:"请输入班级名称",clearable:"",style:{width:"240px"},onKeyup:w(ve,["enter"])},null,8,["modelValue"])])),_:1}),a[17]||(a[17]=y()),p(o,{label:"班级编码",prop:"code"},{default:f((()=>[p(l,{modelValue:de.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>de.value.code=e),placeholder:"请输入班级编码",clearable:"",style:{width:"240px"},onKeyup:w(ve,["enter"])},null,8,["modelValue"])])),_:1}),a[18]||(a[18]=y()),p(o,{label:"所属专业",prop:"majorId"},{default:f((()=>[p(t,{modelValue:de.value.majorId,"onUpdate:modelValue":a[2]||(a[2]=e=>de.value.majorId=e),placeholder:"请选择所属专业",clearable:"",style:{width:"240px"}},{default:f((()=>[(b(!0),m(V,null,I(ee.value,((e,a)=>(b(),k(d,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),a[19]||(a[19]=y()),p(o,{label:"年级",prop:"grade"},{default:f((()=>[p(t,{modelValue:de.value.grade,"onUpdate:modelValue":a[3]||(a[3]=e=>de.value.grade=e),placeholder:"请选择年级",clearable:"",style:{width:"240px"}},{default:f((()=>[(b(!0),m(V,null,I(ae.value,((e,a)=>(b(),k(d,{key:a,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),a[20]||(a[20]=y()),p(o,null,{default:f((()=>[p(u,{type:"primary",icon:"Search",onClick:ve},{default:f((()=>a[14]||(a[14]=[y("搜索")]))),_:1}),a[16]||(a[16]=y()),p(u,{icon:"Refresh",onClick:se},{default:f((()=>a[15]||(a[15]=[y("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),[[j,J.value]]),a[47]||(a[47]=y()),p(c,{gutter:10,class:"mb8"},{default:f((()=>[p(v,{span:1.5},{default:f((()=>[_((b(),k(u,{type:"primary",plain:"",icon:"Plus",onClick:me},{default:f((()=>a[21]||(a[21]=[y("新增")]))),_:1})),[[be,["education:class:add"]]])])),_:1}),a[24]||(a[24]=y()),p(v,{span:1.5},{default:f((()=>[_((b(),k(u,{type:"success",plain:"",icon:"Edit",disabled:X.value,onClick:pe},{default:f((()=>a[22]||(a[22]=[y("修改")]))),_:1},8,["disabled"])),[[be,["education:class:edit"]]])])),_:1}),a[25]||(a[25]=y()),p(v,{span:1.5},{default:f((()=>[_((b(),k(u,{type:"danger",plain:"",icon:"Delete",disabled:H.value,onClick:he},{default:f((()=>a[23]||(a[23]=[y("删除")]))),_:1},8,["disabled"])),[[be,["education:class:remove"]]])])),_:1}),a[26]||(a[26]=y()),p(s,{showSearch:J.value,"onUpdate:showSearch":a[4]||(a[4]=e=>J.value=e),onQueryTable:ie},null,8,["showSearch"])])),_:1}),a[48]||(a[48]=y()),_((b(),k(U,{data:M.value,onSelectionChange:ce},{default:f((()=>[p(x,{type:"selection",width:"55",align:"center"}),a[30]||(a[30]=y()),p(x,{label:"班级ID",align:"center",prop:"id",width:"80"}),a[31]||(a[31]=y()),p(x,{label:"班级名称",align:"center",prop:"name","show-overflow-tooltip":!0}),a[32]||(a[32]=y()),p(x,{label:"班级编码",align:"center",prop:"code","show-overflow-tooltip":!0}),a[33]||(a[33]=y()),p(x,{label:"所属专业",align:"center",prop:"majorName","show-overflow-tooltip":!0}),a[34]||(a[34]=y()),p(x,{label:"年级",align:"center",prop:"grade"}),a[35]||(a[35]=y()),p(x,{label:"班主任",align:"center",prop:"advisorName","show-overflow-tooltip":!0}),a[36]||(a[36]=y()),p(x,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),a[37]||(a[37]=y()),p(x,{label:"操作",align:"center",width:"180","class-name":"small-padding fixed-width"},{default:f((e=>[_((b(),k(u,{type:"primary",link:"",icon:"Edit",onClick:a=>pe(e.row)},{default:f((()=>a[27]||(a[27]=[y("修改")]))),_:2},1032,["onClick"])),[[be,["education:class:edit"]]]),a[29]||(a[29]=y()),_((b(),k(u,{type:"primary",link:"",icon:"Delete",onClick:a=>he(e.row)},{default:f((()=>a[28]||(a[28]=[y("删除")]))),_:2},1032,["onClick"])),[[be,["education:class:remove"]]])])),_:1})])),_:1},8,["data"])),[[ye,R.value]]),a[49]||(a[49]=y()),_(p(N,{total:L.value,page:de.value.pageNum,"onUpdate:page":a[5]||(a[5]=e=>de.value.pageNum=e),limit:de.value.pageSize,"onUpdate:limit":a[6]||(a[6]=e=>de.value.pageSize=e),onPagination:ie},null,8,["total","page","limit"]),[[j,L.value>0]]),a[50]||(a[50]=y()),p(O,{title:Y.value,modelValue:Z.value,"onUpdate:modelValue":a[12]||(a[12]=e=>Z.value=e),width:"600px","append-to-body":""},{footer:f((()=>[g("div",Q,[p(u,{type:"primary",onClick:fe},{default:f((()=>a[42]||(a[42]=[y("确 定")]))),_:1}),a[44]||(a[44]=y()),p(u,{onClick:ge},{default:f((()=>a[43]||(a[43]=[y("取 消")]))),_:1})])])),default:f((()=>[p(r,{ref_key:"classForm",ref:re,model:te.value,rules:ue,"label-width":"100px"},{default:f((()=>[p(o,{label:"班级名称",prop:"name"},{default:f((()=>[p(l,{modelValue:te.value.name,"onUpdate:modelValue":a[7]||(a[7]=e=>te.value.name=e),placeholder:"请输入班级名称"},null,8,["modelValue"])])),_:1}),a[38]||(a[38]=y()),p(o,{label:"班级编码",prop:"code"},{default:f((()=>[p(l,{modelValue:te.value.code,"onUpdate:modelValue":a[8]||(a[8]=e=>te.value.code=e),placeholder:"请输入班级编码"},null,8,["modelValue"])])),_:1}),a[39]||(a[39]=y()),p(o,{label:"所属专业",prop:"majorId"},{default:f((()=>[p(t,{modelValue:te.value.majorId,"onUpdate:modelValue":a[9]||(a[9]=e=>te.value.majorId=e),placeholder:"请选择所属专业",style:{width:"100%"}},{default:f((()=>[(b(!0),m(V,null,I(ee.value,((e,a)=>(b(),k(d,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),a[40]||(a[40]=y()),p(o,{label:"年级",prop:"grade"},{default:f((()=>[p(t,{modelValue:te.value.grade,"onUpdate:modelValue":a[10]||(a[10]=e=>te.value.grade=e),placeholder:"请选择年级",style:{width:"100%"}},{default:f((()=>[(b(!0),m(V,null,I(ae.value,((e,a)=>(b(),k(d,{key:a,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),a[41]||(a[41]=y()),p(o,{label:"班主任",prop:"advisorId"},{default:f((()=>[p(t,{modelValue:te.value.advisorId,"onUpdate:modelValue":a[11]||(a[11]=e=>te.value.advisorId=e),filterable:"",remote:"",placeholder:"请输入教师姓名搜索","remote-method":ne,loading:oe.value,style:{width:"100%"},clearable:""},{default:f((()=>[(b(!0),m(V,null,I(le.value,((e,a)=>(b(),k(d,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1})])),_:1},8,["model"]),a[45]||(a[45]=y())])),_:1},8,["title","modelValue"])])),_:1})])}}};export{R as default};
