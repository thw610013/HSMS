var e=(e,a,l)=>new Promise((t,s)=>{var r=e=>{try{n(l.next(e))}catch(a){s(a)}},o=e=>{try{n(l.throw(e))}catch(a){s(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);n((l=l.apply(e,a)).next())});import{s as a,_ as l}from"./index-1c6f2b30.js";import{M as t,R as s,T as r}from"./icons-02de347c.js";import{E as o}from"./utils-80dc1c42.js";import{l as n}from"./manage-30bc6a53.js";import{O as d,Q as c,P as u,af as i,ab as v,R as p,ai as m,aj as f,ak as h,ac as b,ag as g,am as x,ao as _,as as y,ae as S}from"./element-plus-33c96ec5.js";import{r as w,M as R,f as C,I as F,l as I,m as k,E as A,z as j,F as E,W as L,D as V,u as W,q as U,A as T,y as B}from"./vue-core-d6f028e5.js";const D={class:"app-container"},O={class:"card-body"},P={class:"statistic-value"},z={class:"card-body"},M={class:"statistic-value"},N={class:"card-body"},q={class:"statistic-value"},Q={class:"card-body"},$={class:"statistic-value"},G={class:"report-actions"},H=l({__name:"stats",setup(l){const H=w([]),J=w([]),K=w([]);let X=null,Y=null;const Z=R({semester:"",courseId:void 0,classId:void 0}),ee=w(!1),ae=w({}),le=w([]);C(()=>{te(),se(),re(),oe(),ne()}),F(()=>{X&&(X.dispose(),X=null),Y&&(Y.dispose(),Y=null)});const te=()=>e(this,null,function*(){try{const e=yield n();if(200===e.code){const a={value:"all",label:"全部学期"};H.value=[a,...e.data],Z.semester="all"}}catch(e){d.error("获取学期选项失败")}}),se=()=>e(this,null,function*(){try{const e=yield a({url:"/grade/course-options",method:"get"});200===e.code&&(J.value=e.data)}catch(e){d.error("获取课程选项失败")}}),re=()=>e(this,null,function*(){try{const e=yield a({url:"/grade/class-options",method:"get"});200===e.code&&(K.value=e.data)}catch(e){d.error("获取班级选项失败")}}),oe=()=>{X=o(document.getElementById("scoreDistributionChart")),Y=o(document.getElementById("classAverageChart")),window.addEventListener("resize",()=>{X&&X.resize(),Y&&Y.resize()})},ne=()=>e(this,null,function*(){ee.value=!0;try{const l=yield(e=Z,a({url:"/grade/stats",method:"get",params:e}));if(200===l.code){ae.value=l.data.overview||{},ae.value.totalWithScore&&ae.value.totalWithScore>0?(ae.value.passRate=ae.value.passCount/ae.value.totalWithScore,ae.value.excellentRate=ae.value.excellentCount/ae.value.totalWithScore):(ae.value.passRate=0,ae.value.excellentRate=0);const e=l.data.classStats||[];le.value=e.map(e=>(e.totalStudents&&e.totalStudents>0?(e.passRate=e.passCount/e.totalStudents,e.excellentRate=e.excellentCount/e.totalStudents):(e.passRate=0,e.excellentRate=0),e)),de(l.data.scoreDistribution||[]),ce(l.data.classStats||[])}else d.error(l.msg||"获取统计数据失败")}catch(l){d.error("获取统计数据失败")}finally{ee.value=!1}var e}),de=e=>{const a=[{range:"0-59",label:"<60",color:"#F56C6C"},{range:"60-69",label:"60-69",color:"#E6A23C"},{range:"70-79",label:"70-79",color:"#409EFF"},{range:"80-89",label:"80-89",color:"#67C23A"},{range:"90-100",label:"90-100",color:"#31C27C"}],l=a.map(a=>{const l=e.find(e=>e.scoreRange===a.range);return{value:l?l.count:0,itemStyle:{color:a.color}}}),t={title:{text:"成绩分布",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a.map(e=>e.label),axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"学生数"},series:[{name:"成绩分布",type:"bar",barWidth:"60%",data:l}]};X.setOption(t)},ce=e=>{const a={title:{text:"班级平均分对比",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(e=>e.className),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"平均分",min:function(e){return Math.floor(Math.max(0,e.min-5))}},series:[{name:"平均分",type:"bar",barWidth:"60%",data:e.map(e=>e.averageScore),itemStyle:{color:"#409EFF"},label:{show:!0,position:"top",formatter:"{c}"}}]};Y.setOption(a)},ue=()=>{ne()},ie=()=>{Z.courseId=void 0,Z.classId=void 0,Z.semester="all",ne()},ve=()=>{u.confirm("是否确认导出成绩统计报告?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e;(e=Z,a({url:"/grade/export-report",method:"get",params:e,responseType:"blob"})).then(e=>{const a=new Blob([e.data],{type:"application/vnd.ms-excel"}),l=`成绩统计报告_${(new Date).getTime()}.xlsx`,t=document.createElement("a");t.href=URL.createObjectURL(a),t.download=l,t.click(),URL.revokeObjectURL(t.href),d.success("导出成功")}).catch(e=>{d.error("导出失败")})})};return(e,a)=>{const l=S,o=i,n=v,d=p,u=m,w=f,R=h,C=b,F=g,X=x,Y=_,te=y;return I(),k("div",D,[A(R,{class:"search-card"},{default:j(()=>[A(w,{model:Z,ref:"searchForm",inline:!0},{default:j(()=>[A(n,{label:"学期",prop:"semester"},{default:j(()=>[A(o,{modelValue:Z.semester,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.semester=e),placeholder:"选择学期",clearable:""},{default:j(()=>[(I(!0),k(E,null,L(H.value,e=>(I(),B(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[6]||(a[6]=V()),A(n,{label:"课程",prop:"courseId"},{default:j(()=>[A(o,{modelValue:Z.courseId,"onUpdate:modelValue":a[1]||(a[1]=e=>Z.courseId=e),placeholder:"选择课程",clearable:"",filterable:""},{default:j(()=>[(I(!0),k(E,null,L(J.value,e=>(I(),B(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[7]||(a[7]=V()),A(n,{label:"班级",prop:"classId"},{default:j(()=>[A(o,{modelValue:Z.classId,"onUpdate:modelValue":a[2]||(a[2]=e=>Z.classId=e),placeholder:"选择班级",clearable:"",filterable:""},{default:j(()=>[(I(!0),k(E,null,L(K.value,e=>(I(),B(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[8]||(a[8]=V()),A(n,null,{default:j(()=>[A(u,{type:"primary",onClick:ue},{default:j(()=>[A(d,null,{default:j(()=>[A(W(t))]),_:1}),a[3]||(a[3]=V("查询\n          "))]),_:1}),a[5]||(a[5]=V()),A(u,{onClick:ie},{default:j(()=>[A(d,null,{default:j(()=>[A(W(s))]),_:1}),a[4]||(a[4]=V("重置\n          "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a[46]||(a[46]=V()),A(F,{gutter:20,class:"mt-2"},{default:j(()=>[A(C,{span:6},{default:j(()=>[A(R,null,{header:j(()=>a[9]||(a[9]=[U("div",{class:"card-header"},[U("span",null,"总人数")],-1)])),default:j(()=>[a[12]||(a[12]=V()),U("div",O,[U("div",P,c(ae.value.totalStudents||0),1),a[10]||(a[10]=V()),a[11]||(a[11]=U("div",{class:"statistic-label"},"参与课程学生总数",-1))])]),_:1})]),_:1}),a[25]||(a[25]=V()),A(C,{span:6},{default:j(()=>[A(R,null,{header:j(()=>a[13]||(a[13]=[U("div",{class:"card-header"},[U("span",null,"平均分")],-1)])),default:j(()=>[a[16]||(a[16]=V()),U("div",z,[U("div",M,c(ae.value.averageScore?ae.value.averageScore.toFixed(2):"0.00"),1),a[14]||(a[14]=V()),a[15]||(a[15]=U("div",{class:"statistic-label"},"课程平均成绩",-1))])]),_:1})]),_:1}),a[26]||(a[26]=V()),A(C,{span:6},{default:j(()=>[A(R,null,{header:j(()=>a[17]||(a[17]=[U("div",{class:"card-header"},[U("span",null,"及格率")],-1)])),default:j(()=>[a[20]||(a[20]=V()),U("div",N,[U("div",q,c(ae.value.passRate?(100*ae.value.passRate).toFixed(2)+"%":"0.00%"),1),a[18]||(a[18]=V()),a[19]||(a[19]=U("div",{class:"statistic-label"},"60分以上占比",-1))])]),_:1})]),_:1}),a[27]||(a[27]=V()),A(C,{span:6},{default:j(()=>[A(R,null,{header:j(()=>a[21]||(a[21]=[U("div",{class:"card-header"},[U("span",null,"优秀率")],-1)])),default:j(()=>[a[24]||(a[24]=V()),U("div",Q,[U("div",$,c(ae.value.excellentRate?(100*ae.value.excellentRate).toFixed(2)+"%":"0.00%"),1),a[22]||(a[22]=V()),a[23]||(a[23]=U("div",{class:"statistic-label"},"90分以上占比",-1))])]),_:1})]),_:1})]),_:1}),a[47]||(a[47]=V()),A(F,{gutter:20,class:"mt-2"},{default:j(()=>[A(C,{span:12},{default:j(()=>[A(R,null,{header:j(()=>a[28]||(a[28]=[U("div",{class:"card-header"},[U("span",null,"成绩分布")],-1)])),default:j(()=>[a[29]||(a[29]=V()),a[30]||(a[30]=U("div",{class:"chart-container"},[U("div",{id:"scoreDistributionChart",style:{width:"100%",height:"400px"}})],-1))]),_:1})]),_:1}),a[34]||(a[34]=V()),A(C,{span:12},{default:j(()=>[A(R,null,{header:j(()=>a[31]||(a[31]=[U("div",{class:"card-header"},[U("span",null,"班级平均分对比")],-1)])),default:j(()=>[a[32]||(a[32]=V()),a[33]||(a[33]=U("div",{class:"chart-container"},[U("div",{id:"classAverageChart",style:{width:"100%",height:"400px"}})],-1))]),_:1})]),_:1})]),_:1}),a[48]||(a[48]=V()),A(F,{gutter:20,class:"mt-2"},{default:j(()=>[A(C,{span:24},{default:j(()=>[A(R,null,{header:j(()=>a[35]||(a[35]=[U("div",{class:"card-header"},[U("span",null,"班级成绩分析")],-1)])),default:j(()=>[a[42]||(a[42]=V()),T((I(),B(Y,{data:le.value,stripe:"",border:"",style:{width:"100%"}},{default:j(()=>[A(X,{prop:"className",label:"班级",align:"center"}),a[36]||(a[36]=V()),A(X,{prop:"totalStudents",label:"学生人数",align:"center"}),a[37]||(a[37]=V()),A(X,{prop:"averageScore",label:"平均分",align:"center"},{default:j(e=>[V(c(null!==e.row.averageScore?e.row.averageScore.toFixed(2):"--"),1)]),_:1}),a[38]||(a[38]=V()),A(X,{prop:"maxScore",label:"最高分",align:"center"},{default:j(e=>[V(c(null!==e.row.maxScore?e.row.maxScore.toFixed(1):"--"),1)]),_:1}),a[39]||(a[39]=V()),A(X,{prop:"minScore",label:"最低分",align:"center"},{default:j(e=>[V(c(null!==e.row.minScore?e.row.minScore.toFixed(1):"--"),1)]),_:1}),a[40]||(a[40]=V()),A(X,{label:"及格率",align:"center"},{default:j(e=>{return[V(c((a=e.row,null!==a.passRate?(100*a.passRate).toFixed(2)+"%":"--")),1)];var a}),_:1}),a[41]||(a[41]=V()),A(X,{label:"优秀率",align:"center"},{default:j(e=>{return[V(c((a=e.row,null!==a.excellentRate?(100*a.excellentRate).toFixed(2)+"%":"--")),1)];var a}),_:1})]),_:1},8,["data"])),[[te,ee.value]])]),_:1})]),_:1})]),_:1}),a[49]||(a[49]=V()),A(F,{gutter:20,class:"mt-2"},{default:j(()=>[A(C,{span:24},{default:j(()=>[A(R,null,{header:j(()=>a[43]||(a[43]=[U("div",{class:"card-header"},[U("span",null,"生成报告")],-1)])),default:j(()=>[a[45]||(a[45]=V()),U("div",G,[A(u,{type:"primary",onClick:ve},{default:j(()=>[A(d,null,{default:j(()=>[A(W(r))]),_:1}),a[44]||(a[44]=V("导出成绩统计报告\n            "))]),_:1})])]),_:1})]),_:1})]),_:1})])}}},[["__scopeId","data-v-f5a7c9bc"]]);export{H as default};
