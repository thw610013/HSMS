var e=(e,a,l)=>new Promise((t,n)=>{var o=e=>{try{r(l.next(e))}catch(a){n(a)}},u=e=>{try{r(l.throw(e))}catch(a){n(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,u);r((l=l.apply(e,a)).next())});import{_ as a,u as l,n as t,o as n}from"./index-1c6f2b30.js";import{ah as o,ag as u,c as r,r as d,M as s,f as i,l as c,m as p,E as m,z as f,q as g,D as v,C as h,u as _,A as y,y as b}from"./vue-core-d6f028e5.js";import{D as w,M as N,R as k,S as C,T as V,O as I}from"./icons-02de347c.js";import{O as x,Q as z,R as U,ai as j,aa as R,ab as S,aj as A,am as q,an as O,aE as F,ao as D,ap as E,ak as P,ad as B,aq as M,as as Q}from"./element-plus-33c96ec5.js";import"./utils-80dc1c42.js";const T={class:"course-students-container"},$={class:"card-header"},G={class:"header-left"},H={key:0,class:"course-info"},J={class:"operation-container"},K={key:0},L={key:1,class:"no-score"},W={key:1,class:"no-grade"},X={class:"pagination-container"},Y={class:"dialog-footer"},Z=a({__name:"students",setup(a){const Z=o(),ee=u(),ae=r(()=>ee.params.courseId),le=r(()=>ee.params.id),te=l(),ne=d(null),oe=d(null),ue=d(!1),re=d([]),de=d(0),se=d(!1),ie=d(!1),ce=s({courseId:null,courseOfferingId:null,studentNo:"",studentName:"",pageNum:1,pageSize:10}),pe=s({visible:!1,title:"录入成绩"}),me=s({id:null,studentId:null,studentName:"",studentNo:"",score:null,comment:""}),fe={score:[{required:!0,message:"请输入成绩",trigger:"blur"}]},ge=d(null),ve=d(!1);function he(){ne.value&&ae.value?(ue.value=!0,t(ne.value,ae.value,ce).then(e=>{re.value=e.data.list||[],de.value=e.data.total||0,e.data.courseInfo&&(oe.value=e.data.courseInfo)}).catch(e=>{x.error("获取课程学生列表失败")}).finally(()=>{ue.value=!1})):x.warning("参数不完整，无法获取学生列表")}function _e(){ce.pageNum=1,he()}function ye(){ce.studentNo="",ce.studentName="",_e()}function be(e){ce.pageSize=e,he()}function we(e){ce.pageNum=e,he()}function Ne(){Z.go(-1)}function ke(){var e;null==(e=ge.value)||e.validate(e=>{if(!e)return;ve.value=!0;const a={studentId:me.studentId,score:me.score,comment:me.comment};n(ne.value,ae.value,a).then(()=>{x.success("成绩提交成功"),pe.visible=!1,he()}).catch(e=>{x.error("成绩提交失败")}).finally(()=>{ve.value=!1})})}function Ce(){x.info("导入成绩功能待实现")}function Ve(){x.info("导出学生名单功能待实现")}function Ie(){x.info("下载成绩模板功能待实现")}return i(()=>e(this,null,function*(){yield function(){return e(this,null,function*(){try{const e=te.userInfo;e&&e.teacherId?ne.value=e.teacherId:x.warning("获取教师信息失败，请重新登录")}catch(e){x.error("获取教师信息失败")}})}(),ce.courseId=ae.value,ce.courseOfferingId=le.value,he()})),(e,a)=>{const l=U,t=j,n=R,o=S,u=A,r=q,d=O,s=F,i=D,x=E,ee=P,te=B,ne=M,he=Q;return c(),p("div",T,[m(ee,{class:"box-card"},{header:f(()=>[g("div",$,[g("div",G,[a[10]||(a[10]=g("span",{class:"header-title"},"课程学生名单",-1)),a[11]||(a[11]=v()),oe.value?(c(),p("span",H,z(oe.value.courseName)+" - "+z(oe.value.semester),1)):h("",!0)]),a[13]||(a[13]=v()),m(t,{onClick:Ne,link:""},{default:f(()=>[m(l,null,{default:f(()=>[m(_(w))]),_:1}),a[12]||(a[12]=v("返回\n          "))]),_:1})])]),default:f(()=>[a[35]||(a[35]=v()),m(u,{model:ce,ref:"queryForm",inline:!0,class:"search-form"},{default:f(()=>[m(o,{label:"学号",prop:"studentNo"},{default:f(()=>[m(n,{modelValue:ce.studentNo,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.studentNo=e),placeholder:"请输入学号",clearable:""},null,8,["modelValue"])]),_:1}),a[17]||(a[17]=v()),m(o,{label:"姓名",prop:"studentName"},{default:f(()=>[m(n,{modelValue:ce.studentName,"onUpdate:modelValue":a[1]||(a[1]=e=>ce.studentName=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1}),a[18]||(a[18]=v()),m(o,null,{default:f(()=>[m(t,{type:"primary",onClick:_e},{default:f(()=>[m(l,null,{default:f(()=>[m(_(N))]),_:1}),a[14]||(a[14]=v("查询\n          "))]),_:1}),a[16]||(a[16]=v()),m(t,{onClick:ye},{default:f(()=>[m(l,null,{default:f(()=>[m(_(k))]),_:1}),a[15]||(a[15]=v("重置\n          "))]),_:1})]),_:1})]),_:1},8,["model"]),a[36]||(a[36]=v()),g("div",J,[m(t,{type:"primary",onClick:Ce,loading:se.value},{default:f(()=>[m(l,null,{default:f(()=>[m(_(C))]),_:1}),a[19]||(a[19]=v("导入成绩\n        "))]),_:1},8,["loading"]),a[22]||(a[22]=v()),m(t,{type:"primary",onClick:Ve,loading:ie.value},{default:f(()=>[m(l,null,{default:f(()=>[m(_(V))]),_:1}),a[20]||(a[20]=v("导出学生名单\n        "))]),_:1},8,["loading"]),a[23]||(a[23]=v()),m(t,{type:"primary",onClick:Ie},{default:f(()=>[m(l,null,{default:f(()=>[m(_(I))]),_:1}),a[21]||(a[21]=v("下载成绩模板\n        "))]),_:1})]),a[37]||(a[37]=v()),y((c(),b(i,{data:re.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:f(()=>[m(r,{type:"index",label:"#",width:"60"}),a[27]||(a[27]=v()),m(r,{prop:"studentNo",label:"学号",width:"120"}),a[28]||(a[28]=v()),m(r,{prop:"studentName",label:"姓名",width:"120"}),a[29]||(a[29]=v()),m(r,{prop:"gender",label:"性别",width:"80",align:"center"},{default:f(e=>[v(z(0===e.row.gender?"男":"女"),1)]),_:1}),a[30]||(a[30]=v()),m(r,{prop:"className",label:"班级",width:"180"}),a[31]||(a[31]=v()),m(r,{prop:"score",label:"成绩",width:"100",align:"center"},{default:f(e=>[null!==e.row.score&&void 0!==e.row.score?(c(),p("span",K,z(e.row.score),1)):(c(),p("span",L,"未录入"))]),_:1}),a[32]||(a[32]=v()),m(r,{prop:"grade",label:"等级",width:"100",align:"center"},{default:f(e=>{return[e.row.grade?(c(),b(d,{key:0,type:(a=e.row.grade,{"A+":"success",A:"success","B+":"success",B:"warning","C+":"warning",C:"warning",D:"danger",F:"danger"}[a]||"info")},{default:f(()=>[v(z(e.row.grade),1)]),_:2},1032,["type"])):(c(),p("span",W,"-"))];var a}),_:1}),a[33]||(a[33]=v()),m(r,{prop:"attendanceRate",label:"出勤率",width:"100",align:"center"},{default:f(e=>{return[m(s,{percentage:e.row.attendanceRate||0,color:(a=e.row.attendanceRate,null==a?"#909399":a>=90?"#67C23A":a>=80?"#E6A23C":"#F56C6C"),format:e=>`${e}%`},null,8,["percentage","color","format"])];var a}),_:1}),a[34]||(a[34]=v()),m(r,{label:"操作","min-width":"150",fixed:"right"},{default:f(e=>[m(t,{type:"primary",link:"",onClick:a=>{return l=e.row,pe.title="编辑成绩",pe.visible=!0,me.id=l.id,me.studentId=l.studentId,me.studentName=l.studentName,me.studentNo=l.studentNo,me.score=l.score,void(me.comment=l.comment||"");var l}},{default:f(()=>a[24]||(a[24]=[v("\n              编辑成绩\n            ")])),_:2},1032,["onClick"]),a[26]||(a[26]=v()),m(t,{type:"primary",link:"",onClick:a=>{return l=e.row,void Z.push({name:"AttendanceRecord",query:{courseId:ae.value,courseOfferingId:le.value,studentId:l.studentId}});var l}},{default:f(()=>a[25]||(a[25]=[v("\n              考勤记录\n            ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[he,ue.value]]),a[38]||(a[38]=v()),g("div",X,[m(x,{"current-page":ce.pageNum,"onUpdate:currentPage":a[2]||(a[2]=e=>ce.pageNum=e),"page-size":ce.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>ce.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:de.value,onSizeChange:be,onCurrentChange:we},null,8,["current-page","page-size","total"])])]),_:1}),a[46]||(a[46]=v()),m(ne,{modelValue:pe.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>pe.visible=e),title:pe.title,width:"500px","append-to-body":""},{footer:f(()=>[g("div",Y,[m(t,{onClick:a[8]||(a[8]=e=>pe.visible=!1)},{default:f(()=>a[42]||(a[42]=[v("取消")])),_:1}),a[44]||(a[44]=v()),m(t,{type:"primary",onClick:ke,loading:ve.value},{default:f(()=>a[43]||(a[43]=[v("确定")])),_:1},8,["loading"])])]),default:f(()=>[m(u,{ref_key:"gradeFormRef",ref:ge,model:me,rules:fe,"label-width":"80px"},{default:f(()=>[m(o,{label:"学生",prop:"studentName"},{default:f(()=>[m(n,{modelValue:me.studentName,"onUpdate:modelValue":a[4]||(a[4]=e=>me.studentName=e),disabled:""},null,8,["modelValue"])]),_:1}),a[39]||(a[39]=v()),m(o,{label:"学号",prop:"studentNo"},{default:f(()=>[m(n,{modelValue:me.studentNo,"onUpdate:modelValue":a[5]||(a[5]=e=>me.studentNo=e),disabled:""},null,8,["modelValue"])]),_:1}),a[40]||(a[40]=v()),m(o,{label:"成绩",prop:"score"},{default:f(()=>[m(te,{modelValue:me.score,"onUpdate:modelValue":a[6]||(a[6]=e=>me.score=e),min:0,max:100,precision:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a[41]||(a[41]=v()),m(o,{label:"备注",prop:"comment"},{default:f(()=>[m(n,{modelValue:me.comment,"onUpdate:modelValue":a[7]||(a[7]=e=>me.comment=e),type:"textarea",rows:"3",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a[45]||(a[45]=v())]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-2c518a4c"]]);export{Z as default};
