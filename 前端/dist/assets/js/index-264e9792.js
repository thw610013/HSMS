var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,r=(e,r)=>{for(var o in r||(r={}))a.call(r,o)&&s(e,o,r[o]);if(t)for(var o of t(r))l.call(r,o)&&s(e,o,r[o]);return e};import{_ as o,u as n,x as u,y as i,z as c}from"./index-1c6f2b30.js";import{_ as d}from"./index-db7beee4.js";import{_ as m}from"./index-292e5414.js";import{r as p,f as v,l as f,m as h,E as g,z as _,q as w,D as b,A as x,G as y,X as S,F as k,W as C,y as z,C as A,n as N}from"./vue-core-d6f028e5.js";import{E as L}from"./utils-80dc1c42.js";import{Q as E,p as T,O as j,aa as O,ab as F,ae as V,af as I,ai as P,aj as G,ac as U,ag as B,ak as D,am as H,an as M,aE as R,ao as q,aq as W,as as Q}from"./element-plus-33c96ec5.js";import"./icons-02de347c.js";const K={class:"app-container"},X={class:"statistic-number"},J={class:"statistic-number"},Y={class:"statistic-number"},Z={class:"statistic-number"},$={key:0},ee={id:"printGradeReport"},te={class:"print-header"},ae={class:"student-info"},le={class:"print-table"},se={class:"summary-info"},re={class:"school-signature"},oe={class:"dialog-footer"},ne=o({__name:"index",setup(e){const t=n();p(t.userId);const a=p(t.userId),l=p(!1),s=p(!0),o=p(0),ne=p([]),ue=p([]),ie=p(!1),ce=p({studentId:"",studentName:"",majorName:"",className:""}),de=p({totalCourses:0,averageScore:0,totalCredits:0,gpa:0}),me=p([{value:"2024-2025-1",label:"2024-2025学年第一学期"},{value:"2024-2025-2",label:"2024-2025学年第二学期"},{value:"2023-2024-1",label:"2023-2024学年第一学期"},{value:"2023-2024-2",label:"2023-2024学年第二学期"}]),pe=p({pageNum:1,pageSize:10,courseName:void 0,semester:void 0,status:void 0});function ve(){l.value=!0,u(a.value,pe.value).then(e=>{if(e&&e.data){let t=[];e.data.records?t=e.data.records||[]:e.data.rows?t=e.data.rows||[]:e.data.list?t=e.data.list||[]:Array.isArray(e.data)&&(t=e.data),void 0!==e.data.total?o.value=parseInt(e.data.total||0):o.value=t.length,ne.value=t.map(e=>{const t=r({},e);return t.course_name||(t.courseName?t.course_name=t.courseName:t.name&&(t.course_name=t.name)),t.course_code||(t.courseCode?t.course_code=t.courseCode:t.code&&(t.course_code=t.code)),!t.credits&&t.credit&&(t.credits=t.credit),t.teacher_name||(t.teacherName?t.teacher_name=t.teacherName:t.teacher&&(t.teacher_name=t.teacher)),!t.examTime&&t.exam_time&&(t.examTime=t.exam_time),t.ranking||0===t.ranking||null===t.ranking||t.rank&&(t.ranking=t.rank),!t.totalStudents&&t.total_students&&(t.totalStudents=t.total_students),t.status_text||(t.statusText?t.status_text=t.statusText:0===t.status?t.status_text="待评分":1===t.status?t.status_text="已评分":2===t.status?t.status_text="已取消":t.status_text="未知"),t}),ne.value.sort((e,t)=>{var a,l;return e.semester!==t.semester?(null==(a=t.semester)?void 0:a.localeCompare(e.semester||""))||0:(null==(l=e.course_name||"")?void 0:l.localeCompare(t.course_name||""))||0}),ne.value&&ne.value.length>0&&N(()=>{(function(){const e=document.getElementById("gradeChart");if(!e)return;const t=L(e),a=[],l=[],s=[];if(!ne.value||0===ne.value.length){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const r=[...ne.value].sort((e,t)=>e.semester&&t.semester?e.semester.localeCompare(t.semester):0),o={};if(r.forEach(e=>{if(e.semester&&(o[e.semester]||(o[e.semester]={scores:[],gps:[],credits:[]}),null!==e.score&&void 0!==e.score)){const t=parseFloat(e.score);o[e.semester].scores.push(t),o[e.semester].gps.push(parseFloat(fe(t))),o[e.semester].credits.push(parseFloat(e.credits||0))}}),Object.keys(o).forEach(e=>{a.push(e);const t=o[e].scores,r=o[e].gps,n=o[e].credits;if(0===t.length)return l.push(0),void s.push(0);const u=t.reduce((e,t,a)=>e+t*n[a],0),i=n.reduce((e,t)=>e+t,0),c=i>0?(u/i).toFixed(2):0,d=r.reduce((e,t,a)=>e+t*n[a],0),m=i>0?(d/i).toFixed(2):0;l.push(c),s.push(m)}),0===a.length){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const n={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["平均分","GPA"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a},yAxis:[{type:"value",name:"分数",min:0,max:100,interval:10,axisLabel:{formatter:"{value}"}},{type:"value",name:"GPA",min:0,max:4,interval:.5,axisLabel:{formatter:"{value}"}}],series:[{name:"平均分",type:"bar",data:l,itemStyle:{color:"#3498db"}},{name:"GPA",type:"line",yAxisIndex:1,data:s,symbolSize:8,itemStyle:{color:"#e74c3c"}}]};t.setOption(n),window.addEventListener("resize",()=>{t.resize()})})(),function(){const e=document.getElementById("distributionChart");if(!e)return;const t=L(e);if(!ne.value||0===ne.value.length){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const a=[{name:"90-100分",range:[90,100],count:0,color:"#67C23A"},{name:"80-89分",range:[80,89],count:0,color:"#409EFF"},{name:"70-79分",range:[70,79],count:0,color:"#E6A23C"},{name:"60-69分",range:[60,69],count:0,color:"#F56C6C"},{name:"0-59分",range:[0,59],count:0,color:"#909399"}];let l=0;if(ne.value.forEach(e=>{if(null!==e.score&&void 0!==e.score){l++;const t=parseFloat(e.score);for(const e of a)if(t>=e.range[0]&&t<=e.range[1]){e.count++;break}}}),0===l){const e={title:{text:"暂无成绩数据",left:"center",top:"center",textStyle:{color:"#999",fontSize:20}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{show:!1},yAxis:{show:!1}};return t.setOption(e),void window.addEventListener("resize",()=>{t.resize()})}const s={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center"},series:[{name:"成绩分布",type:"pie",radius:["50%","70%"],center:["40%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c}门"},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:a.map(e=>({value:e.count,name:e.name,itemStyle:{color:e.color}}))}]};t.setOption(s),window.addEventListener("resize",()=>{t.resize()})}()})}else ne.value=[],o.value=0;l.value=!1}).catch(e=>{ne.value=[],o.value=0,l.value=!1}),i(a.value).then(e=>{de.value=e.data||{},de.value.totalCourses||(de.value.totalCourses=0),de.value.averageScore||(de.value.averageScore=0),de.value.totalCredits||(de.value.totalCredits=0),de.value.gpa||(de.value.gpa=0)}).catch(e=>{de.value={totalCourses:0,averageScore:0,totalCredits:0,gpa:0}})}function fe(e){return e>=90?"4.0":e>=85?"3.7":e>=80?"3.3":e>=75?"3.0":e>=70?"2.7":e>=65?"2.3":e>=60?"2.0":"0.0"}function he(e){return e>=90?"A":e>=85?"A-":e>=80?"B+":e>=75?"B":e>=70?"B-":e>=65?"C+":e>=60?"C":"F"}function ge(e){return""}function _e(e,t){if(!e||!t||0===t)return"#409eff";const a=100-e/t*100;return a>=90?"#67c23a":a>=60?"#409eff":a>=30?"#e6a23c":"#f56c6c"}function we(){l.value=!0,u(a.value,{pageSize:9999}).then(e=>{if(e&&e.data){let t=[];e.data.records?t=e.data.records||[]:e.data.rows?t=e.data.rows||[]:e.data.list?t=e.data.list||[]:Array.isArray(e.data)&&(t=e.data),ue.value=t.map(e=>{const t=r({},e);return t.course_name||(t.courseName?t.course_name=t.courseName:t.name&&(t.course_name=t.name)),t.course_code||(t.courseCode?t.course_code=t.courseCode:t.code&&(t.course_code=t.code)),!t.credits&&t.credit&&(t.credits=t.credit),t.teacher_name||(t.teacherName?t.teacher_name=t.teacherName:t.teacher&&(t.teacher_name=t.teacher)),!t.examTime&&t.exam_time&&(t.examTime=t.exam_time),t.ranking||0===t.ranking||null===t.ranking||t.rank&&(t.ranking=t.rank),!t.totalStudents&&t.total_students&&(t.totalStudents=t.total_students),t.status_text||(t.statusText?t.status_text=t.statusText:0===t.status?t.status_text="待评分":1===t.status?t.status_text="已评分":2===t.status?t.status_text="已取消":t.status_text="未知"),t}),ie.value=!0}else j.warning("没有可打印的成绩数据");l.value=!1}).catch(e=>{l.value=!1,j.error("获取成绩数据失败")})}function be(){const e=document.getElementById("printGradeReport").innerHTML,t=document.body.innerHTML;document.body.innerHTML=e,window.print(),document.body.innerHTML=t,ie.value=!1,setTimeout(()=>{location.reload()},100)}function xe(){pe.value.pageNum=1,ve()}function ye(){pe.value={pageNum:1,pageSize:10,courseName:void 0,semester:void 0,status:void 0},xe()}return v(()=>{ve(),c(a.value).then(e=>{ce.value=e.data})}),(e,t)=>{const a=O,r=F,n=V,u=I,i=P,c=G,p=U,v=m,N=B,L=D,j=H,Se=M,ke=R,Ce=q,ze=d,Ae=W,Ne=Q;return f(),h("div",K,[g(L,{class:"box-card"},{header:_(()=>t[8]||(t[8]=[w("div",{class:"card-header"},[w("span",null,"我的成绩")],-1)])),default:_(()=>[t[40]||(t[40]=b()),x(g(c,{model:pe.value,ref:"queryForm",inline:!0},{default:_(()=>[g(r,{label:"课程名称",prop:"courseName"},{default:_(()=>[g(a,{modelValue:pe.value.courseName,"onUpdate:modelValue":t[0]||(t[0]=e=>pe.value.courseName=e),placeholder:"请输入课程名称",clearable:"",onKeyup:S(xe,["enter"])},null,8,["modelValue"])]),_:1}),t[13]||(t[13]=b()),g(r,{label:"学期",prop:"semester"},{default:_(()=>[g(u,{modelValue:pe.value.semester,"onUpdate:modelValue":t[1]||(t[1]=e=>pe.value.semester=e),placeholder:"请选择学期",clearable:""},{default:_(()=>[(f(!0),h(k,null,C(me.value,e=>(f(),z(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t[14]||(t[14]=b()),g(r,{label:"成绩状态",prop:"status"},{default:_(()=>[g(u,{modelValue:pe.value.status,"onUpdate:modelValue":t[2]||(t[2]=e=>pe.value.status=e),placeholder:"请选择成绩状态",clearable:""},{default:_(()=>[g(n,{label:"已公布",value:1}),t[9]||(t[9]=b()),g(n,{label:"未公布",value:0})]),_:1},8,["modelValue"])]),_:1}),t[15]||(t[15]=b()),g(r,null,{default:_(()=>[g(i,{type:"primary",icon:"Search",onClick:xe},{default:_(()=>t[10]||(t[10]=[b("搜索")])),_:1}),t[12]||(t[12]=b()),g(i,{icon:"Refresh",onClick:ye},{default:_(()=>t[11]||(t[11]=[b("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[y,s.value]]),t[41]||(t[41]=b()),g(N,{gutter:10,class:"mb8"},{default:_(()=>[g(p,{span:1.5},{default:_(()=>[g(i,{type:"success",plain:"",icon:"Printer",onClick:we},{default:_(()=>t[16]||(t[16]=[b("打印成绩单")])),_:1})]),_:1}),t[17]||(t[17]=b()),g(v,{showSearch:s.value,"onUpdate:showSearch":t[3]||(t[3]=e=>s.value=e),onQueryTable:ve},null,8,["showSearch"])]),_:1}),t[42]||(t[42]=b()),g(N,{gutter:20,class:"mb20"},{default:_(()=>[g(p,{span:6},{default:_(()=>[g(L,{shadow:"hover",class:"statistic-card"},{default:_(()=>[t[18]||(t[18]=w("div",{class:"statistic-title"},"总课程数",-1)),t[19]||(t[19]=b()),w("div",X,E(de.value.totalCourses),1)]),_:1})]),_:1}),t[26]||(t[26]=b()),g(p,{span:6},{default:_(()=>[g(L,{shadow:"hover",class:"statistic-card"},{default:_(()=>[t[20]||(t[20]=w("div",{class:"statistic-title"},"平均分",-1)),t[21]||(t[21]=b()),w("div",J,E(de.value.averageScore),1)]),_:1})]),_:1}),t[27]||(t[27]=b()),g(p,{span:6},{default:_(()=>[g(L,{shadow:"hover",class:"statistic-card"},{default:_(()=>[t[22]||(t[22]=w("div",{class:"statistic-title"},"获得学分",-1)),t[23]||(t[23]=b()),w("div",Y,E(de.value.totalCredits),1)]),_:1})]),_:1}),t[28]||(t[28]=b()),g(p,{span:6},{default:_(()=>[g(L,{shadow:"hover",class:"statistic-card"},{default:_(()=>[t[24]||(t[24]=w("div",{class:"statistic-title"},"GPA",-1)),t[25]||(t[25]=b()),w("div",Z,E(de.value.gpa),1)]),_:1})]),_:1})]),_:1}),t[43]||(t[43]=b()),x((f(),z(Ce,{data:ne.value,style:{width:"100%"}},{default:_(()=>[g(j,{label:"学期",align:"center",prop:"semester",width:"140"}),t[31]||(t[31]=b()),g(j,{label:"课程名称",align:"center",prop:"course_name","min-width":"140","show-overflow-tooltip":!0}),t[32]||(t[32]=b()),g(j,{label:"课程编码",align:"center",prop:"course_code",width:"120"}),t[33]||(t[33]=b()),g(j,{label:"学分",align:"center",width:"80"},{default:_(e=>[b(E(e.row.credits||e.row.credit||"-"),1)]),_:1}),t[34]||(t[34]=b()),g(j,{label:"教师",align:"center",prop:"teacher_name",width:"100"}),t[35]||(t[35]=b()),g(j,{label:"总评成绩",align:"center",prop:"score",width:"100"},{default:_(e=>{return[null!==e.row.score&&void 0!==e.row.score?(f(),h("span",{key:0,class:T((t=e.row.score,null==t?"score-pending":t>=90?"score-excellent":t>=80?"score-good":t>=70?"score-normal":t>=60?"score-pass":"score-fail"))},E(e.row.score),3)):(f(),z(Se,{key:1,type:"info",size:"small"},{default:_(()=>[b(E(e.row.status_text||"待评分"),1)]),_:2},1024))];var t}),_:1}),t[36]||(t[36]=b()),g(j,{label:"绩点",align:"center",width:"80"},{default:_(e=>[null!==e.row.score&&void 0!==e.row.score?(f(),h(k,{key:0},[b(E(fe(e.row.score)),1)],64)):(f(),h(k,{key:1},[b("\n              -\n            ")],64))]),_:1}),t[37]||(t[37]=b()),g(j,{label:"等级",align:"center",width:"100"},{default:_(e=>{return[null!==e.row.score&&void 0!==e.row.score?(f(),z(Se,{key:0,type:(a=e.row.score,null==a?"info":a>=90?"success":a>=80?"primary":a>=70?"":a>=60?"warning":"danger"),"disable-transitions":""},{default:_(()=>[b(E(he(e.row.score)),1)]),_:2},1032,["type"])):(f(),z(Se,{key:1,type:"info","disable-transitions":""},{default:_(()=>t[29]||(t[29]=[b("未评分")])),_:1}))];var a}),_:1}),t[38]||(t[38]=b()),g(j,{label:"考试时间",align:"center",width:"160"},{default:_(e=>[e.row.examTime?(f(),h(k,{key:0},[b(E(e.row.examTime),1)],64)):(f(),h(k,{key:1},[b("\n              -\n            ")],64))]),_:1}),t[39]||(t[39]=b()),g(j,{label:"排名",align:"center",width:"120"},{default:_(e=>{return[null!==e.row.score&&void 0!==e.row.score&&e.row.ranking?(f(),h(k,{key:0},[b(E(e.row.ranking),1),e.row.totalStudents?(f(),h("span",$,"/"+E(e.row.totalStudents),1)):A("",!0),t[30]||(t[30]=b()),g(ke,{percentage:(a=e.row.ranking,l=e.row.totalStudents||100,a&&l&&0!==l?100-a/l*100:0),format:ge,color:_e(e.row.ranking,e.row.totalStudents||100),style:{width:"80px",display:"inline-block","margin-left":"10px"}},null,8,["percentage","color"])],64)):(f(),h(k,{key:1},[b("-")],64))];var a,l}),_:1})]),_:1},8,["data"])),[[Ne,l.value]]),t[44]||(t[44]=b()),x(g(ze,{total:o.value,page:pe.value.pageNum,"onUpdate:page":t[4]||(t[4]=e=>pe.value.pageNum=e),limit:pe.value.pageSize,"onUpdate:limit":t[5]||(t[5]=e=>pe.value.pageSize=e),onPagination:ve},null,8,["total","page","limit"]),[[y,o.value>0]])]),_:1}),t[86]||(t[86]=b()),g(L,{class:"box-card",style:{"margin-top":"20px"}},{header:_(()=>t[45]||(t[45]=[w("div",{class:"card-header"},[w("span",null,"成绩趋势分析")],-1)])),default:_(()=>[t[46]||(t[46]=b()),t[47]||(t[47]=w("div",{id:"gradeChart",style:{width:"100%",height:"400px"}},null,-1))]),_:1}),t[87]||(t[87]=b()),g(L,{class:"box-card",style:{"margin-top":"20px"}},{header:_(()=>t[48]||(t[48]=[w("div",{class:"card-header"},[w("span",null,"成绩分布统计")],-1)])),default:_(()=>[t[49]||(t[49]=b()),t[50]||(t[50]=w("div",{id:"distributionChart",style:{width:"100%",height:"400px"}},null,-1))]),_:1}),t[88]||(t[88]=b()),g(Ae,{title:"成绩单预览",modelValue:ie.value,"onUpdate:modelValue":t[7]||(t[7]=e=>ie.value=e),width:"800px"},{footer:_(()=>[w("div",oe,[g(i,{onClick:t[6]||(t[6]=e=>ie.value=!1)},{default:_(()=>t[82]||(t[82]=[b("取消")])),_:1}),t[84]||(t[84]=b()),g(i,{type:"primary",onClick:be},{default:_(()=>t[83]||(t[83]=[b("打印")])),_:1})])]),default:_(()=>[w("div",ee,[w("div",te,[t[58]||(t[58]=w("h2",null,"学生成绩单",-1)),t[59]||(t[59]=b()),w("div",ae,[w("p",null,[t[51]||(t[51]=w("span",null,"学号：",-1)),b(E(ce.value.studentId),1)]),t[55]||(t[55]=b()),w("p",null,[t[52]||(t[52]=w("span",null,"姓名：",-1)),b(E(ce.value.studentName),1)]),t[56]||(t[56]=b()),w("p",null,[t[53]||(t[53]=w("span",null,"专业：",-1)),b(E(ce.value.majorName),1)]),t[57]||(t[57]=b()),w("p",null,[t[54]||(t[54]=w("span",null,"班级：",-1)),b(E(ce.value.className),1)])])]),t[79]||(t[79]=b()),w("table",le,[t[66]||(t[66]=w("thead",null,[w("tr",null,[w("th",null,"学期"),b(),w("th",null,"课程名称"),b(),w("th",null,"课程编码"),b(),w("th",null,"学分"),b(),w("th",null,"成绩"),b(),w("th",null,"绩点"),b(),w("th",null,"等级")])],-1)),t[67]||(t[67]=b()),w("tbody",null,[(f(!0),h(k,null,C(ue.value,(e,a)=>(f(),h("tr",{key:a},[w("td",null,E(e.semester),1),t[60]||(t[60]=b()),w("td",null,E(e.course_name||e.courseName||e.name),1),t[61]||(t[61]=b()),w("td",null,E(e.course_code||e.courseCode||e.code),1),t[62]||(t[62]=b()),w("td",null,E(e.credits||e.credit),1),t[63]||(t[63]=b()),w("td",null,E(1===e.status?e.score:"未公布"),1),t[64]||(t[64]=b()),w("td",null,E(1===e.status?fe(e.score):"-"),1),t[65]||(t[65]=b()),w("td",null,E(1===e.status?he(e.score):"-"),1)]))),128))])]),t[80]||(t[80]=b()),w("div",se,[w("p",null,[t[68]||(t[68]=w("span",null,"总修学分：",-1)),b(E(de.value.totalCredits),1)]),t[73]||(t[73]=b()),w("p",null,[t[69]||(t[69]=w("span",null,"课程数：",-1)),b(E(de.value.totalCourses),1)]),t[74]||(t[74]=b()),w("p",null,[t[70]||(t[70]=w("span",null,"平均分：",-1)),b(E(de.value.averageScore),1)]),t[75]||(t[75]=b()),w("p",null,[t[71]||(t[71]=w("span",null,"GPA：",-1)),b(E(de.value.gpa),1)]),t[76]||(t[76]=b()),w("p",null,[t[72]||(t[72]=w("span",null,"打印时间：",-1)),b(E((new Date).toLocaleString()),1)])]),t[81]||(t[81]=b()),w("div",re,[t[77]||(t[77]=w("p",null,"学校（盖章）",-1)),t[78]||(t[78]=b()),w("p",null,E((new Date).toLocaleDateString()),1)])]),t[85]||(t[85]=b())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-ac9b35d7"]]);export{ne as default};
