var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,t=(a,l,d)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[l]=d,s=(e,a,l)=>new Promise(((d,t)=>{var s=e=>{try{r(l.next(e))}catch(a){t(a)}},u=e=>{try{r(l.throw(e))}catch(a){t(a)}},r=e=>e.done?d(e.value):Promise.resolve(e.value).then(s,u);r((l=l.apply(e,a)).next())}));import{_ as u,G as r,H as o,I as n,w as i,J as m}from"./index-22381d63.js";import{r as p,M as c,f,m as g,E as v,z as b,ah as h,ag as _,l as y,q as V,D as w,u as D,A as I,y as U,F as j,W as N}from"./vue-core-9ee4ed8b.js";import{D as P}from"./icons-c547ea56.js";import{O as Y,a9 as k,R as C,aj as O,ab as x,ac as A,ad as M,au as $,a4 as q,af as E,ag as F,av as R,ah as z,aw as G,ax as H,ak as J,as as S}from"./element-plus-e2333c73.js";import"./utils-e59f4bae.js";const W={class:"student-edit-container"},X={class:"card-header"},B={class:"empty-data-tip"},K={key:0},L={key:1},Q={class:"form-footer"},T=u({__name:"edit",setup(e){const u=h(),T=_(),Z=p(Number(T.params.id)),ee=p(null),ae=p("basic"),le=p(!0),de=p(!1),te=c({id:null,studentNo:"",name:"",gender:0,classId:null,admissionDate:null,graduationDate:null,idCard:"",birthday:null,address:"",email:"",phone:"",status:0}),se={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],classId:[{required:!0,message:"请选择班级",trigger:"change"}],admissionDate:[{required:!0,message:"请选择入学日期",trigger:"change"}],idCard:[{pattern:/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,message:"身份证号格式不正确",trigger:"blur"}],email:[{pattern:/^[\w.-]+@[\w.-]+\.\w+$/,message:"邮箱格式不正确",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}]},ue=p([]),re=p([]),oe=p([]),ne=()=>{le.value=!0,r(Z.value).then((e=>{if(e.data){const s=((e,s)=>{for(var u in s||(s={}))l.call(s,u)&&t(e,u,s[u]);if(a)for(var u of a(s))d.call(s,u)&&t(e,u,s[u]);return e})({},e.data);s.classId&&(s.classId=Number(s.classId)),void 0!==s.gender&&(s.gender=Number(s.gender)),void 0!==s.status&&(s.status=Number(s.status)),Object.assign(te,s)}else Y.warning("获取的学生数据为空");le.value=!1})).catch((e=>{Y.error("获取学生详情失败"),le.value=!1}))};f((()=>{Promise.all([o().then((e=>(Array.isArray(e.data)?ue.value=e.data:(ue.value=[],Y.warning("班级列表数据格式不正确")),Promise.resolve(e.data)))).catch((e=>(ue.value=[],Y.warning("获取班级列表失败，请刷新页面重试"),Promise.resolve([])))),n().then((e=>(Array.isArray(e.data)?re.value=e.data:(re.value=[],Y.warning("专业列表数据格式不正确")),Promise.resolve(e.data)))).catch((e=>(re.value=[],Y.warning("获取专业列表失败，请刷新页面重试"),Promise.resolve([])))),i().then((e=>(Array.isArray(e.data)?oe.value=e.data:(oe.value=[],Y.warning("院系列表数据格式不正确")),Promise.resolve(e.data)))).catch((e=>(oe.value=[],Y.warning("获取院系列表失败，请刷新页面重试"),Promise.resolve([]))))]).then((()=>{ne()})).catch((e=>{ne()}))}));const ie=()=>s(this,null,(function*(){ee.value&&(0!==ue.value.length?(null!==te.classId&&(te.classId=Number(te.classId)),null!==te.gender&&(te.gender=Number(te.gender)),null!==te.status&&(te.status=Number(te.status)),yield ee.value.validate(((e,a)=>s(this,null,(function*(){var l,d;if(e)try{de.value=!0;yield m(te);Y.success("学生信息更新成功"),u.push("/student/list")}catch(t){Y.error((null==(d=null==(l=t.response)?void 0:l.data)?void 0:d.message)||"更新学生失败")}finally{de.value=!1}else{const e=Object.keys(a),l=["studentNo","name","gender","classId","admissionDate","graduationDate","idCard","birthday","address","status"],d=["email","phone"];e.some((e=>l.includes(e)))?ae.value="basic":e.some((e=>d.includes(e)))&&(ae.value="account");let t="表单填写有误，请检查以下字段：";for(const s in a)a[s]&&a[s][0]&&a[s][0].message&&(t+=`\n- ${a[s][0].message}`);Y.error(t),de.value=!1}}))))):Y.warning("班级数据未加载，无法提交表单。请刷新页面重试"))})),me=()=>{u.go(-1)};return(e,a)=>{const l=C,d=O,t=x,s=A,u=M,r=$,o=q,n=E,i=F,m=R,p=z,c=G,f=H,h=J,_=k,Y=S;return y(),g("div",W,[v(_,{class:"box-card"},{header:b((()=>[V("div",X,[a[14]||(a[14]=V("span",null,"编辑学生",-1)),a[15]||(a[15]=w()),v(d,{onClick:me,link:""},{default:b((()=>[v(l,null,{default:b((()=>[v(D(P))])),_:1}),a[13]||(a[13]=w("返回\r\n          "))])),_:1})])])),default:b((()=>[a[38]||(a[38]=w()),I((y(),U(h,{ref_key:"studentFormRef",ref:ee,model:te,rules:se,"label-width":"100px",class:"student-form"},{default:b((()=>[v(f,{modelValue:ae.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ae.value=e)},{default:b((()=>[v(c,{label:"基本信息",name:"basic"},{default:b((()=>[v(p,{gutter:20},{default:b((()=>[v(u,{span:12},{default:b((()=>[v(s,{label:"学号",prop:"studentNo"},{default:b((()=>[v(t,{modelValue:te.studentNo,"onUpdate:modelValue":a[0]||(a[0]=e=>te.studentNo=e),placeholder:"请输入学号",disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),a[23]||(a[23]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"姓名",prop:"name"},{default:b((()=>[v(t,{modelValue:te.name,"onUpdate:modelValue":a[1]||(a[1]=e=>te.name=e),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1})])),_:1}),a[24]||(a[24]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"性别",prop:"gender"},{default:b((()=>[v(o,{modelValue:te.gender,"onUpdate:modelValue":a[2]||(a[2]=e=>te.gender=e)},{default:b((()=>[v(r,{label:0},{default:b((()=>a[16]||(a[16]=[w("男")]))),_:1}),a[18]||(a[18]=w()),v(r,{label:1},{default:b((()=>a[17]||(a[17]=[w("女")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),a[25]||(a[25]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"班级",prop:"classId"},{default:b((()=>[v(i,{modelValue:te.classId,"onUpdate:modelValue":a[3]||(a[3]=e=>te.classId=e),placeholder:"请选择班级",style:{width:"100%"}},{empty:b((()=>[V("div",B,[0===ue.value.length?(y(),g("span",K,"暂无班级数据")):(y(),g("span",L,"加载班级数据中..."))])])),default:b((()=>[(y(!0),g(j,null,N(ue.value,(e=>(y(),U(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128)),a[19]||(a[19]=w())])),_:1},8,["modelValue"])])),_:1})])),_:1}),a[26]||(a[26]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"入学日期",prop:"admissionDate"},{default:b((()=>[v(m,{modelValue:te.admissionDate,"onUpdate:modelValue":a[4]||(a[4]=e=>te.admissionDate=e),type:"date",placeholder:"选择入学日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),a[27]||(a[27]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"预计毕业",prop:"graduationDate"},{default:b((()=>[v(m,{modelValue:te.graduationDate,"onUpdate:modelValue":a[5]||(a[5]=e=>te.graduationDate=e),type:"date",placeholder:"选择毕业日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),a[28]||(a[28]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"身份证号",prop:"idCard"},{default:b((()=>[v(t,{modelValue:te.idCard,"onUpdate:modelValue":a[6]||(a[6]=e=>te.idCard=e),placeholder:"请输入身份证号"},null,8,["modelValue"])])),_:1})])),_:1}),a[29]||(a[29]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"出生日期",prop:"birthday"},{default:b((()=>[v(m,{modelValue:te.birthday,"onUpdate:modelValue":a[7]||(a[7]=e=>te.birthday=e),type:"date",placeholder:"选择出生日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),a[30]||(a[30]=w()),v(u,{span:24},{default:b((()=>[v(s,{label:"家庭住址",prop:"address"},{default:b((()=>[v(t,{modelValue:te.address,"onUpdate:modelValue":a[8]||(a[8]=e=>te.address=e),placeholder:"请输入家庭住址"},null,8,["modelValue"])])),_:1})])),_:1}),a[31]||(a[31]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"状态",prop:"status"},{default:b((()=>[v(i,{modelValue:te.status,"onUpdate:modelValue":a[9]||(a[9]=e=>te.status=e),placeholder:"请选择状态",style:{width:"100%"}},{default:b((()=>[v(n,{label:"在读",value:0}),a[20]||(a[20]=w()),v(n,{label:"毕业",value:1}),a[21]||(a[21]=w()),v(n,{label:"休学",value:2}),a[22]||(a[22]=w()),v(n,{label:"退学",value:3})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),a[33]||(a[33]=w()),v(c,{label:"账号信息",name:"account"},{default:b((()=>[v(p,{gutter:20},{default:b((()=>[v(u,{span:12},{default:b((()=>[v(s,{label:"邮箱",prop:"email"},{default:b((()=>[v(t,{modelValue:te.email,"onUpdate:modelValue":a[10]||(a[10]=e=>te.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1})])),_:1}),a[32]||(a[32]=w()),v(u,{span:12},{default:b((()=>[v(s,{label:"手机号码",prop:"phone"},{default:b((()=>[v(t,{modelValue:te.phone,"onUpdate:modelValue":a[11]||(a[11]=e=>te.phone=e),placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),a[37]||(a[37]=w()),V("div",Q,[v(d,{onClick:me},{default:b((()=>a[34]||(a[34]=[w("取消")]))),_:1}),a[36]||(a[36]=w()),v(d,{type:"primary",onClick:ie,loading:de.value},{default:b((()=>a[35]||(a[35]=[w("提交")]))),_:1},8,["loading"])])])),_:1},8,["model"])),[[Y,le.value]])])),_:1})])}}},[["__scopeId","data-v-b85bbbf6"]]);export{T as default};
