var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,o=(e,o)=>{for(var s in o||(o={}))a.call(o,s)&&r(e,s,o[s]);if(l)for(var s of l(o))t.call(o,s)&&r(e,s,o[s]);return e};import{s,_ as d}from"./index-1c6f2b30.js";/* empty css                */import{M as u,R as i,B as n}from"./icons-02de347c.js";import{O as c,Q as p,P as m,aa as h,ab as f,ae as y,af as g,R as b,ai as v,aj as _,ak as k,am as V,a2 as w,ao as N,ap as K,ad as S,au as C,a4 as j,aq as x,aJ as z,as as U}from"./element-plus-33c96ec5.js";import{r as I,M as q,f as O,l as P,m as T,E as $,z as B,D as R,u as E,q as D,A as F,y as M}from"./vue-core-d6f028e5.js";import"./utils-80dc1c42.js";const A={class:"role-container"},H={class:"card-header"},J={class:"header-buttons"},Q={class:"pagination-container"},G={class:"dialog-footer"},L={class:"role-info"},W={class:"dialog-footer"},X=d({__name:"index",setup(e){const l=I([]),a=I(0),t=I(!1),r=q({pageNum:1,pageSize:10,roleName:"",roleKey:"",status:null}),d=I(null),X=q({visible:!1,title:"",type:""}),Y=q({roleId:void 0,roleName:"",roleKey:"",roleSort:0,status:0,remark:""}),Z={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleKey:[{required:!0,message:"请输入权限标识",trigger:"blur"}],roleSort:[{required:!0,message:"请输入显示顺序",trigger:"blur"}]},ee=I(null),le=I([]),ae=q({visible:!1,role:{},checkedKeys:[]});O(()=>{te()});const te=()=>{t.value=!0,function(e){const l=o({},e);return void 0!==e.pageNum&&(l.current=e.pageNum,delete l.pageNum),void 0!==e.pageSize&&(l.size=e.pageSize,delete l.pageSize),s({url:"/system/role/list",method:"get",params:l})}(r).then(e=>{l.value=e.data.records||[],a.value=e.data.total||0}).catch(e=>{c.error("获取角色列表失败")}).finally(()=>{t.value=!1})},re=()=>{r.pageNum=1,te()},oe=()=>{r.roleName="",r.roleKey="",r.status=null,re()},se=e=>{r.pageNum=e,te()},de=e=>{r.pageSize=e,te()},ue=()=>{me(),X.visible=!0,X.title="新增角色",X.type="add"},ie=e=>{var l;me(),X.visible=!0,X.title="编辑角色",X.type="update",(l=e.id,s({url:`/system/role/${l}`,method:"get"})).then(e=>{const l=e.data;Y.roleId=l.id,Y.roleName=l.roleName,Y.roleKey=l.roleKey,Y.roleSort=l.roleSort,Y.status=l.status,Y.remark=l.remark}).catch(e=>{c.error("获取角色详情失败")})},ne=e=>{m.confirm(`确定要删除角色 ${e.roleName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var l;(l=e.id,s({url:`/system/role/${l}`,method:"delete"})).then(()=>{c.success("删除成功"),te()}).catch(e=>{c.error("删除角色失败")})}).catch(()=>{})},ce=e=>{(function(e){return s({url:"/system/role/status",method:"put",data:{id:e.roleId,status:e.status}})})({roleId:e.id,status:e.status}).then(()=>{c.success(`已${0===e.status?"启用":"禁用"}角色`)}).catch(l=>{c.error("修改角色状态失败"),e.status=0===e.status?1:0})},pe=()=>{d.value.validate(e=>{if(!e)return;const l=o({},Y);var a;l.roleSort=Number(l.roleSort),l.status=Number(l.status),"update"===X.type&&(l.id=l.roleId,delete l.roleId),"add"===X.type?(a=l,s({url:"/system/role",method:"post",data:a})).then(()=>{c.success("添加成功"),X.visible=!1,te()}).catch(e=>{c.error("添加角色失败")}):function(e){return s({url:"/system/role",method:"put",data:e})}(l).then(()=>{c.success("修改成功"),X.visible=!1,te()}).catch(e=>{c.error("修改角色失败")})})},me=()=>{Y.roleId=void 0,Y.roleName="",Y.roleKey="",Y.roleSort=0,Y.status=0,Y.remark=""},he=e=>{ae.role=e,ae.visible=!0,ae.checkedKeys=[],s({url:"/system/role/permissions/all",method:"get"}).then(l=>{const a=l.data||[],t=[],r={};var o;a.forEach(e=>{const l=e.split(":"),a=l[0];if(r[a]||(r[a]={id:a,name:fe(a),children:[]},t.push(r[a])),l.length>2){const t=l[0]+":"+l[1];let o=r[a].children.find(e=>e.id===t);o||(o={id:t,name:ye(l[1]),children:[]},r[a].children.push(o)),o.children.push({id:e,name:ge(l[2])})}else r[a].children.push({id:e,name:ge(l[1])})}),le.value=t,(o=e.id,s({url:`/system/role/permissions/${o}`,method:"get"})).then(e=>{const l=e.data||[];ae.checkedKeys=l,setTimeout(()=>{ee.value&&ee.value.setCheckedKeys(l)},100)}).catch(e=>{c.error("获取角色权限失败")})}).catch(e=>{c.error("获取权限选项失败")})},fe=e=>({system:"系统管理",education:"教育管理",course:"课程管理",attendance:"考勤管理",grade:"成绩管理",monitor:"系统监控",tool:"系统工具",job:"定时任务",common:"通用功能",log:"日志管理"}[e]||e),ye=e=>({user:"用户管理",role:"角色管理",menu:"菜单管理",permission:"权限管理",dept:"部门管理",department:"院系管理",major:"专业管理",class:"班级管理",student:"学生管理",teacher:"教师管理",course:"课程管理",offering:"课程开设",selection:"选课管理",score:"成绩管理",record:"考勤记录",stats:"统计分析",setting:"系统设置",dict:"字典管理",config:"参数配置",notice:"通知公告",log:"日志管理",online:"在线用户",job:"定时任务",druid:"数据监控",server:"服务监控"}[e]||e),ge=e=>({list:"列表",query:"查询",add:"新增",create:"创建",edit:"编辑",update:"更新",delete:"删除",remove:"删除",export:"导出",import:"导入",upload:"上传",download:"下载",resetPwd:"重置密码",operate:"操作",stats:"统计",view:"查看",detail:"详情",start:"启动",stop:"停止",run:"执行",all:"所有"}[e]||e),be=()=>{if(!ee.value)return void c.error("权限树未初始化");if(!ae.role||!ae.role.id)return void c.error("角色信息不完整");const e=ee.value.getCheckedKeys(),l=ee.value.getHalfCheckedKeys(),a=[...new Set([...e,...l])].filter(e=>"string"==typeof e&&e.includes(":")),r={roleId:ae.role.id,menuIds:a};t.value=!0,function(e){return s({url:"/system/role/permissions",method:"put",data:e})}(r).then(e=>{200===e.code?(c({type:"success",message:"权限分配成功",duration:1500}),ae.visible=!1):c.error(e.message||"权限分配失败")}).catch(e=>{c.error("权限分配失败: "+(e.message||"未知错误"))}).finally(()=>{t.value=!1})};return(e,o)=>{const s=h,c=f,m=y,I=g,q=b,O=v,te=_,me=k,fe=V,ye=w,ge=N,ve=K,_e=S,ke=C,Ve=j,we=x,Ne=z,Ke=U;return P(),T("div",A,[$(me,{class:"search-card",shadow:"hover"},{default:B(()=>[$(te,{model:r,ref:"queryForm",inline:!0},{default:B(()=>[$(c,{label:"角色名称",prop:"roleName"},{default:B(()=>[$(s,{modelValue:r.roleName,"onUpdate:modelValue":o[0]||(o[0]=e=>r.roleName=e),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1}),o[18]||(o[18]=R()),$(c,{label:"权限标识",prop:"roleKey"},{default:B(()=>[$(s,{modelValue:r.roleKey,"onUpdate:modelValue":o[1]||(o[1]=e=>r.roleKey=e),placeholder:"请输入权限标识",clearable:""},null,8,["modelValue"])]),_:1}),o[19]||(o[19]=R()),$(c,{label:"状态",prop:"status"},{default:B(()=>[$(I,{modelValue:r.status,"onUpdate:modelValue":o[2]||(o[2]=e=>r.status=e),placeholder:"请选择状态",clearable:""},{default:B(()=>[$(m,{label:"正常",value:0}),o[14]||(o[14]=R()),$(m,{label:"禁用",value:1})]),_:1},8,["modelValue"])]),_:1}),o[20]||(o[20]=R()),$(c,null,{default:B(()=>[$(O,{type:"primary",onClick:re},{default:B(()=>[$(q,null,{default:B(()=>[$(E(u))]),_:1}),o[15]||(o[15]=R("查询\r\n          "))]),_:1}),o[17]||(o[17]=R()),$(O,{onClick:oe},{default:B(()=>[$(q,null,{default:B(()=>[$(E(i))]),_:1}),o[16]||(o[16]=R("重置\r\n          "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o[55]||(o[55]=R()),$(me,{class:"table-card",shadow:"hover"},{header:B(()=>[D("div",H,[o[22]||(o[22]=D("span",{class:"header-title"},"角色列表",-1)),o[23]||(o[23]=R()),D("div",J,[$(O,{type:"primary",onClick:ue},{default:B(()=>[$(q,null,{default:B(()=>[$(E(n))]),_:1}),o[21]||(o[21]=R("新增\r\n            "))]),_:1})])])]),default:B(()=>[o[36]||(o[36]=R()),F((P(),M(ge,{data:l.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:B(()=>[$(fe,{prop:"id",label:"角色ID",width:"80"}),o[29]||(o[29]=R()),$(fe,{prop:"roleName",label:"角色名称",width:"150"}),o[30]||(o[30]=R()),$(fe,{prop:"roleKey",label:"权限标识",width:"150"}),o[31]||(o[31]=R()),$(fe,{prop:"roleSort",label:"显示顺序",width:"100",align:"center"}),o[32]||(o[32]=R()),$(fe,{prop:"status",label:"状态",width:"80",align:"center"},{default:B(e=>[$(ye,{modelValue:e.row.status,"onUpdate:modelValue":l=>e.row.status=l,"active-value":0,"inactive-value":1,onChange:l=>ce(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o[33]||(o[33]=R()),$(fe,{prop:"remark",label:"备注","min-width":"180"}),o[34]||(o[34]=R()),$(fe,{prop:"createTime",label:"创建时间",width:"160"}),o[35]||(o[35]=R()),$(fe,{label:"操作",fixed:"right",width:"220"},{default:B(e=>[$(O,{type:"primary",link:"",onClick:l=>ie(e.row)},{default:B(()=>o[24]||(o[24]=[R("\r\n              编辑\r\n            ")])),_:2},1032,["onClick"]),o[27]||(o[27]=R()),$(O,{type:"primary",link:"",onClick:l=>he(e.row)},{default:B(()=>o[25]||(o[25]=[R("\r\n              权限\r\n            ")])),_:2},1032,["onClick"]),o[28]||(o[28]=R()),$(O,{type:"danger",link:"",onClick:l=>ne(e.row)},{default:B(()=>o[26]||(o[26]=[R("\r\n              删除\r\n            ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ke,t.value]]),o[37]||(o[37]=R()),D("div",Q,[$(ve,{"current-page":r.pageNum,"onUpdate:currentPage":o[3]||(o[3]=e=>r.pageNum=e),"page-size":r.pageSize,"onUpdate:pageSize":o[4]||(o[4]=e=>r.pageSize=e),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:a.value,onSizeChange:de,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),_:1}),o[56]||(o[56]=R()),$(we,{title:X.title,modelValue:X.visible,"onUpdate:modelValue":o[11]||(o[11]=e=>X.visible=e),width:"600px","append-to-body":"","destroy-on-close":""},{footer:B(()=>[D("div",G,[$(O,{onClick:o[10]||(o[10]=e=>X.visible=!1)},{default:B(()=>o[45]||(o[45]=[R("取消")])),_:1}),o[47]||(o[47]=R()),$(O,{type:"primary",onClick:pe},{default:B(()=>o[46]||(o[46]=[R("确定")])),_:1})])]),default:B(()=>[$(te,{ref_key:"roleFormRef",ref:d,model:Y,rules:Z,"label-width":"100px"},{default:B(()=>[$(c,{label:"角色名称",prop:"roleName"},{default:B(()=>[$(s,{modelValue:Y.roleName,"onUpdate:modelValue":o[5]||(o[5]=e=>Y.roleName=e),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),o[41]||(o[41]=R()),$(c,{label:"权限标识",prop:"roleKey"},{default:B(()=>[$(s,{modelValue:Y.roleKey,"onUpdate:modelValue":o[6]||(o[6]=e=>Y.roleKey=e),placeholder:"请输入权限标识"},null,8,["modelValue"])]),_:1}),o[42]||(o[42]=R()),$(c,{label:"显示顺序",prop:"roleSort"},{default:B(()=>[$(_e,{modelValue:Y.roleSort,"onUpdate:modelValue":o[7]||(o[7]=e=>Y.roleSort=e),min:0,"controls-position":"right"},null,8,["modelValue"])]),_:1}),o[43]||(o[43]=R()),$(c,{label:"状态",prop:"status"},{default:B(()=>[$(Ve,{modelValue:Y.status,"onUpdate:modelValue":o[8]||(o[8]=e=>Y.status=e)},{default:B(()=>[$(ke,{label:0},{default:B(()=>o[38]||(o[38]=[R("正常")])),_:1}),o[40]||(o[40]=R()),$(ke,{label:1},{default:B(()=>o[39]||(o[39]=[R("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o[44]||(o[44]=R()),$(c,{label:"备注",prop:"remark"},{default:B(()=>[$(s,{modelValue:Y.remark,"onUpdate:modelValue":o[9]||(o[9]=e=>Y.remark=e),type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),o[48]||(o[48]=R())]),_:1},8,["title","modelValue"]),o[57]||(o[57]=R()),$(we,{title:"分配权限",modelValue:ae.visible,"onUpdate:modelValue":o[13]||(o[13]=e=>ae.visible=e),width:"700px","append-to-body":"","destroy-on-close":""},{footer:B(()=>[D("div",W,[$(O,{onClick:o[12]||(o[12]=e=>ae.visible=!1)},{default:B(()=>o[50]||(o[50]=[R("取消")])),_:1}),o[52]||(o[52]=R()),$(O,{type:"primary",onClick:be},{default:B(()=>o[51]||(o[51]=[R("确定")])),_:1})])]),default:B(()=>[D("div",L,[D("span",null,"角色名称："+p(ae.role.roleName),1),o[49]||(o[49]=R()),D("span",null,"权限标识："+p(ae.role.roleKey),1)]),o[53]||(o[53]=R()),$(te,null,{default:B(()=>[$(c,{label:"权限列表"},{default:B(()=>[$(Ne,{ref_key:"permTreeRef",ref:ee,data:le.value,props:{label:"name",children:"children"},"show-checkbox":"","node-key":"id","default-checked-keys":ae.checkedKeys,"check-strictly":!1,"default-expand-all":"","highlight-current":""},null,8,["data","default-checked-keys"])]),_:1})]),_:1}),o[54]||(o[54]=R())]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-ae2b39bc"]]);export{X as default};
