var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,u=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{s as r}from"./index-1c6f2b30.js";import{_ as i}from"./index-db7beee4.js";import{_ as n}from"./index-292e5414.js";import{r as v,c as s,f as c,l as m,m as p,E as f,z as h,q as b,D as g,A as y,G as _,X as j,F as w,W as V,y as I,ab as k}from"./vue-core-d6f028e5.js";import{g as x,a as U}from"./major-fd7b9df7.js";import{O as C,P as N,aa as O,ab as S,af as P,ai as q,aj as z,ac as D,ag as T,am as E,ao as F,aq as A,ak as B,as as K,ae as $}from"./element-plus-33c96ec5.js";import"./icons-02de347c.js";import"./utils-80dc1c42.js";const G={class:"app-container"},Q={class:"dialog-footer"},R={__name:"index",setup(e){const R=v(!1),W=v([]),X=s(()=>1!==W.value.length),H=s(()=>0===W.value.length),J=v(!0),L=v(0),M=v([]),Y=v(""),Z=v(!1),ee=v([]),ae=v(["2020","2021","2022","2023","2024","2025"]),le=v([]),oe=v(!1),te=v({pageNum:1,pageSize:10,name:void 0,code:void 0,majorId:void 0,grade:void 0}),de=v({id:void 0,name:void 0,code:void 0,majorId:void 0,grade:void 0,advisorId:void 0}),ue={name:[{required:!0,message:"班级名称不能为空",trigger:"blur"}],code:[{required:!0,message:"班级编码不能为空",trigger:"blur"}],majorId:[{required:!0,message:"所属专业不能为空",trigger:"change"}],grade:[{required:!0,message:"年级不能为空",trigger:"change"}]},re=v(null);function ie(){var e;R.value=!0,(e=te.value,r({url:"/student/class/list",method:"get",params:e})).then(e=>{M.value=e.data.records,L.value=e.data.total,R.value=!1}).catch(()=>{R.value=!1})}function ne(e){""!==e?(oe.value=!0,function(e){return r({url:"/student/class/list/teachers",method:"get",params:e})}({name:e}).then(e=>{try{200===e.code&&e.data?le.value=(e.data||[]).filter(e=>e&&"object"==typeof e&&(void 0!==e.value||void 0!==e.id)&&(void 0!==e.label||void 0!==e.name)).map(e=>({value:e.value||e.id,label:e.label||e.name})):le.value=[]}catch(a){le.value=[]}finally{oe.value=!1}}).catch(e=>{le.value=[],oe.value=!1})):ye()}function ve(){te.value.pageNum=1,ie()}function se(){te.value={pageNum:1,pageSize:10,name:void 0,code:void 0,majorId:void 0,grade:void 0},ve()}function ce(e){W.value=e.map(e=>e.id)}function me(){be(),Y.value="添加班级",Z.value=!0}function pe(e){be();(function(e){return r({url:`/student/class/${e}`,method:"get"})})(e.id||W.value[0]).then(e=>{try{if(200===e.code&&e.data){if(de.value=e.data,de.value.advisorId&&de.value.advisorName){le.value&&Array.isArray(le.value)||(le.value=[]);let e=!1;for(const a of le.value)if(a&&"object"==typeof a&&a.value===de.value.advisorId){e=!0;break}e||le.value.push({value:de.value.advisorId,label:de.value.advisorName})}Y.value="修改班级",Z.value=!0}else C.error(e.msg||"获取班级详情失败")}catch(a){C.error("处理班级详情数据失败")}}).catch(e=>{C.error("获取班级详情失败，请稍后重试")})}function fe(){var e;null==(e=re.value)||e.validate(e=>{if(e)try{const e=(n=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&u(e,l,a[l]);if(o)for(var l of o(a))d.call(a,l)&&u(e,l,a[l]);return e})({},de.value),v={id:de.value.id?Number(de.value.id):void 0,majorId:de.value.majorId?Number(de.value.majorId):void 0,advisorId:de.value.advisorId?Number(de.value.advisorId):null},a(n,l(v)));e.id?(i=e,r({url:"/student/class",method:"put",data:i})).then(e=>{200===e.code?(C.success("修改成功"),Z.value=!1,ie()):C.error(e.msg||"修改失败")}).catch(e=>{C.error("修改失败，请稍后重试")}):function(e){return r({url:"/student/class",method:"post",data:e})}(e).then(e=>{200===e.code?(C.success("新增成功"),Z.value=!1,ie()):C.error(e.msg||"新增失败")}).catch(e=>{C.error("新增失败，请稍后重试")})}catch(s){C.error("表单提交失败，请稍后重试")}var i,n,v})}function he(e){const a=e.id||W.value;N.confirm("确认删除选中的班级信息?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e;(e=a,r({url:`/student/class/${e}`,method:"delete"})).then(()=>{C.success("删除成功"),ie()})})}function be(){var e;de.value={id:void 0,name:void 0,code:void 0,majorId:void 0,grade:void 0,advisorId:void 0},null==(e=re.value)||e.resetFields()}function ge(){Z.value=!1,be()}function ye(){oe.value=!0,le.value=[],r({url:"/student/class/all/teachers",method:"get"}).then(e=>{try{200===e.code&&e.data&&(le.value=e.data.filter(e=>e&&(e.value||e.id)).map(e=>({value:e.value||e.id,label:e.label||e.name})))}catch(a){}finally{oe.value=!1}}).catch(e=>{oe.value=!1})}return c(()=>{ie(),ee.value=[],x().then(e=>{try{200===e.code&&e.data&&e.data.length>0?ee.value=e.data.filter(e=>e&&"object"==typeof e&&void 0!==e.value&&void 0!==e.label).map(e=>({value:e.value,label:e.label})):U().then(e=>{200===e.code&&e.data?ee.value=e.data.filter(e=>e&&"object"==typeof e&&void 0!==e.id&&void 0!==e.name).map(e=>({value:e.id,label:e.name})):ee.value=[]}).catch(e=>{ee.value=[]})}catch(a){ee.value=[]}}).catch(e=>{U().then(e=>{try{200===e.code&&e.data?ee.value=e.data.filter(e=>e&&"object"==typeof e&&void 0!==e.id&&void 0!==e.name).map(e=>({value:e.id,label:e.name})):ee.value=[]}catch(a){ee.value=[]}}).catch(()=>{ee.value=[]})}),ye(),setTimeout(()=>{ee.value=[...ee.value]},1e3)}),(e,a)=>{const l=O,o=S,t=$,d=P,u=q,r=z,v=D,s=n,c=T,x=E,U=F,C=i,N=A,W=B,be=k("hasPermi"),ye=K;return m(),p("div",G,[f(W,{class:"box-card"},{header:h(()=>a[13]||(a[13]=[b("div",{class:"card-header"},[b("span",null,"班级管理")],-1)])),default:h(()=>[a[46]||(a[46]=g()),y(f(r,{model:te.value,ref:"queryForm",inline:!0},{default:h(()=>[f(o,{label:"班级名称",prop:"name"},{default:h(()=>[f(l,{modelValue:te.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>te.value.name=e),placeholder:"请输入班级名称",clearable:"",style:{width:"240px"},onKeyup:j(ve,["enter"])},null,8,["modelValue"])]),_:1}),a[17]||(a[17]=g()),f(o,{label:"班级编码",prop:"code"},{default:h(()=>[f(l,{modelValue:te.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>te.value.code=e),placeholder:"请输入班级编码",clearable:"",style:{width:"240px"},onKeyup:j(ve,["enter"])},null,8,["modelValue"])]),_:1}),a[18]||(a[18]=g()),f(o,{label:"所属专业",prop:"majorId"},{default:h(()=>[f(d,{modelValue:te.value.majorId,"onUpdate:modelValue":a[2]||(a[2]=e=>te.value.majorId=e),placeholder:"请选择所属专业",clearable:"",style:{width:"240px"}},{default:h(()=>[(m(!0),p(w,null,V(ee.value,(e,a)=>(m(),I(t,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[19]||(a[19]=g()),f(o,{label:"年级",prop:"grade"},{default:h(()=>[f(d,{modelValue:te.value.grade,"onUpdate:modelValue":a[3]||(a[3]=e=>te.value.grade=e),placeholder:"请选择年级",clearable:"",style:{width:"240px"}},{default:h(()=>[(m(!0),p(w,null,V(ae.value,(e,a)=>(m(),I(t,{key:a,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[20]||(a[20]=g()),f(o,null,{default:h(()=>[f(u,{type:"primary",icon:"Search",onClick:ve},{default:h(()=>a[14]||(a[14]=[g("搜索")])),_:1}),a[16]||(a[16]=g()),f(u,{icon:"Refresh",onClick:se},{default:h(()=>a[15]||(a[15]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[_,J.value]]),a[47]||(a[47]=g()),f(c,{gutter:10,class:"mb8"},{default:h(()=>[f(v,{span:1.5},{default:h(()=>[y((m(),I(u,{type:"primary",plain:"",icon:"Plus",onClick:me},{default:h(()=>a[21]||(a[21]=[g("新增")])),_:1})),[[be,["education:class:add"]]])]),_:1}),a[24]||(a[24]=g()),f(v,{span:1.5},{default:h(()=>[y((m(),I(u,{type:"success",plain:"",icon:"Edit",disabled:X.value,onClick:pe},{default:h(()=>a[22]||(a[22]=[g("修改")])),_:1},8,["disabled"])),[[be,["education:class:edit"]]])]),_:1}),a[25]||(a[25]=g()),f(v,{span:1.5},{default:h(()=>[y((m(),I(u,{type:"danger",plain:"",icon:"Delete",disabled:H.value,onClick:he},{default:h(()=>a[23]||(a[23]=[g("删除")])),_:1},8,["disabled"])),[[be,["education:class:remove"]]])]),_:1}),a[26]||(a[26]=g()),f(s,{showSearch:J.value,"onUpdate:showSearch":a[4]||(a[4]=e=>J.value=e),onQueryTable:ie},null,8,["showSearch"])]),_:1}),a[48]||(a[48]=g()),y((m(),I(U,{data:M.value,onSelectionChange:ce},{default:h(()=>[f(x,{type:"selection",width:"55",align:"center"}),a[30]||(a[30]=g()),f(x,{label:"班级ID",align:"center",prop:"id",width:"80"}),a[31]||(a[31]=g()),f(x,{label:"班级名称",align:"center",prop:"name","show-overflow-tooltip":!0}),a[32]||(a[32]=g()),f(x,{label:"班级编码",align:"center",prop:"code","show-overflow-tooltip":!0}),a[33]||(a[33]=g()),f(x,{label:"所属专业",align:"center",prop:"majorName","show-overflow-tooltip":!0}),a[34]||(a[34]=g()),f(x,{label:"年级",align:"center",prop:"grade"}),a[35]||(a[35]=g()),f(x,{label:"班主任",align:"center",prop:"advisorName","show-overflow-tooltip":!0}),a[36]||(a[36]=g()),f(x,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),a[37]||(a[37]=g()),f(x,{label:"操作",align:"center",width:"180","class-name":"small-padding fixed-width"},{default:h(e=>[y((m(),I(u,{type:"primary",link:"",icon:"Edit",onClick:a=>pe(e.row)},{default:h(()=>a[27]||(a[27]=[g("修改")])),_:2},1032,["onClick"])),[[be,["education:class:edit"]]]),a[29]||(a[29]=g()),y((m(),I(u,{type:"primary",link:"",icon:"Delete",onClick:a=>he(e.row)},{default:h(()=>a[28]||(a[28]=[g("删除")])),_:2},1032,["onClick"])),[[be,["education:class:remove"]]])]),_:1})]),_:1},8,["data"])),[[ye,R.value]]),a[49]||(a[49]=g()),y(f(C,{total:L.value,page:te.value.pageNum,"onUpdate:page":a[5]||(a[5]=e=>te.value.pageNum=e),limit:te.value.pageSize,"onUpdate:limit":a[6]||(a[6]=e=>te.value.pageSize=e),onPagination:ie},null,8,["total","page","limit"]),[[_,L.value>0]]),a[50]||(a[50]=g()),f(N,{title:Y.value,modelValue:Z.value,"onUpdate:modelValue":a[12]||(a[12]=e=>Z.value=e),width:"600px","append-to-body":""},{footer:h(()=>[b("div",Q,[f(u,{type:"primary",onClick:fe},{default:h(()=>a[42]||(a[42]=[g("确 定")])),_:1}),a[44]||(a[44]=g()),f(u,{onClick:ge},{default:h(()=>a[43]||(a[43]=[g("取 消")])),_:1})])]),default:h(()=>[f(r,{ref_key:"classForm",ref:re,model:de.value,rules:ue,"label-width":"100px"},{default:h(()=>[f(o,{label:"班级名称",prop:"name"},{default:h(()=>[f(l,{modelValue:de.value.name,"onUpdate:modelValue":a[7]||(a[7]=e=>de.value.name=e),placeholder:"请输入班级名称"},null,8,["modelValue"])]),_:1}),a[38]||(a[38]=g()),f(o,{label:"班级编码",prop:"code"},{default:h(()=>[f(l,{modelValue:de.value.code,"onUpdate:modelValue":a[8]||(a[8]=e=>de.value.code=e),placeholder:"请输入班级编码"},null,8,["modelValue"])]),_:1}),a[39]||(a[39]=g()),f(o,{label:"所属专业",prop:"majorId"},{default:h(()=>[f(d,{modelValue:de.value.majorId,"onUpdate:modelValue":a[9]||(a[9]=e=>de.value.majorId=e),placeholder:"请选择所属专业",style:{width:"100%"}},{default:h(()=>[(m(!0),p(w,null,V(ee.value,(e,a)=>(m(),I(t,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[40]||(a[40]=g()),f(o,{label:"年级",prop:"grade"},{default:h(()=>[f(d,{modelValue:de.value.grade,"onUpdate:modelValue":a[10]||(a[10]=e=>de.value.grade=e),placeholder:"请选择年级",style:{width:"100%"}},{default:h(()=>[(m(!0),p(w,null,V(ae.value,(e,a)=>(m(),I(t,{key:a,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a[41]||(a[41]=g()),f(o,{label:"班主任",prop:"advisorId"},{default:h(()=>[f(d,{modelValue:de.value.advisorId,"onUpdate:modelValue":a[11]||(a[11]=e=>de.value.advisorId=e),filterable:"",remote:"",placeholder:"请输入教师姓名搜索","remote-method":ne,loading:oe.value,style:{width:"100%"},clearable:""},{default:h(()=>[(m(!0),p(w,null,V(le.value,(e,a)=>(m(),I(t,{key:a,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["model"]),a[45]||(a[45]=g())]),_:1},8,["title","modelValue"])]),_:1})])}}};export{R as default};
